<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Retina demonstration</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="retina_demo.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Retina demonstration</h1>
         <!--introduction-->
         <p>Demonstrates the use of wrapper class of the Gipsa/Listic Labs retina model.</p>
         <p>This retina model allows spatio-temporal image processing (applied on a webcam sequences).</p>
         <p>As a summary, these are the retina model properties:</p>
         <div>
            <ul>
               <li>It applies a spectral whithening (mid-frequency details enhancement)</li>
               <li>high frequency spatio-temporal noise reduction</li>
               <li>low frequency luminance to be reduced (luminance range compression)</li>
               <li>local logarithmic luminance compression allows details to be enhanced in   low light conditions</li>
            </ul>
         </div>
         <p>NOTE : this program generates the default retina parameters file <tt>RetinaDefaultParameters.xml</tt>. You can use this to fine tune parameters and load them if you save to file <tt>RetinaSpecificParameters.xml</tt></p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://github.com/opencv/opencv_contrib/blob/3.1.0/modules/bioinspired/samples/basicRetina.cpp">https://github.com/opencv/opencv_contrib/blob/3.1.0/modules/bioinspired/samples/basicRetina.cpp</a></li>
               <li><a href="https://github.com/opencv/opencv_contrib/blob/3.1.0/modules/bioinspired/samples/cpp/retinaDemo.cpp">https://github.com/opencv/opencv_contrib/blob/3.1.0/modules/bioinspired/samples/cpp/retinaDemo.cpp</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <h2 id="toc">Contents</h2>
         <div>
            <ul>
               <li><a href="#2">Webcam</a></li>
               <li><a href="#3">Instantiate</a></li>
               <li><a href="#4">retina parameters</a></li>
               <li><a href="#6">Prepare</a></li>
               <li><a href="#8">Run</a></li>
            </ul>
         </div>
         <h2 id="2">Webcam</h2>
         <p>setup webcam reader and grab a first frame to get its size</p><pre class="codeinput">cap = createVideoCapture([], <span class="string">'chess'</span>);
pause(1)
assert(cap.isOpened(), <span class="string">'Camera failed to initialize'</span>);
img = cap.read();
assert(~isempty(img), <span class="string">'Failed to capture frames'</span>);
sz = size(img);</pre><h2 id="3">Instantiate</h2>
         <p>allocate a retina instance with input size equal to the one of the loaded image</p><pre class="codeinput"><span class="keyword">if</span> true
    <span class="comment">% "classical" retina</span>
    retina = cv.Retina([sz(2) sz(1)]);
<span class="keyword">else</span>
    <span class="comment">% log sampling (favour foveal vision and subsamples peripheral vision)</span>
    retina = cv.Retina([sz(2) sz(1)], <span class="string">'UseRetinaLogSampling'</span>,true, <span class="keyword">...</span>
        <span class="string">'ReductionFactor'</span>,2, <span class="string">'SamplingStrength'</span>,10);
<span class="keyword">end</span></pre><h2 id="4">retina parameters</h2>
         <p>save current (here default) retina parameters to a xml file (you may use it only one time to get the file and modify it)</p><pre class="codeinput"><span class="comment">%retina.write('retinaParams.xml');</span></pre><p>load retina parameters from a xml file : here we load the default parameters that we just wrote to file</p><pre class="codeinput"><span class="comment">%retina.setup('retinaParams.xml');</span></pre><h2 id="6">Prepare</h2>
         <p>reset all retina buffers (open your eyes)</p><pre class="codeinput">retina.clearBuffers();</pre><p>prepare figure</p><pre class="codeinput">figure
subplot(223); hImg(3) = imshow(img); title(<span class="string">'retina magno out'</span>)
subplot(222); hImg(2) = imshow(img); title(<span class="string">'retina parvo out'</span>)
subplot(221); hImg(1) = imshow(img); title(<span class="string">'input frame'</span>)
colormap <span class="string">gray</span></pre><img src="retina_demo_01.png"><h2 id="8">Run</h2>
         <p>main processing loop</p><pre class="codeinput"><span class="keyword">while</span> all(ishghandle(hImg))
    <span class="comment">% grab a new frame and display it</span>
    img = cap.read();
    <span class="keyword">if</span> isempty(img), <span class="keyword">break</span>; <span class="keyword">end</span>

    <span class="comment">% run retina on the input image</span>
    retina.run(img);

    <span class="comment">% grab retina outputs</span>
    parvo = retina.getParvo();
    magno = retina.getMagno();

    <span class="comment">% draw retina outputs</span>
    set(hImg(1), <span class="string">'CData'</span>,img)
    set(hImg(2), <span class="string">'CData'</span>,parvo)
    set(hImg(3), <span class="string">'CData'</span>,magno)
    drawnow
<span class="keyword">end</span>

cap.release();</pre><img src="retina_demo_02.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Retina demonstration
% Demonstrates the use of wrapper class of the Gipsa/Listic Labs retina model.
%
% This retina model allows spatio-temporal image processing (applied on a
% webcam sequences).
%
% As a summary, these are the retina model properties:
%
% * It applies a spectral whithening (mid-frequency details enhancement)
% * high frequency spatio-temporal noise reduction
% * low frequency luminance to be reduced (luminance range compression)
% * local logarithmic luminance compression allows details to be enhanced in
%   low light conditions
%
% NOTE : this program generates the default retina parameters file
% |RetinaDefaultParameters.xml|. You can use this to fine tune parameters and
% load them if you save to file |RetinaSpecificParameters.xml|
%
% Sources:
%
% * <https://github.com/opencv/opencv_contrib/blob/3.1.0/modules/bioinspired/samples/basicRetina.cpp>
% * <https://github.com/opencv/opencv_contrib/blob/3.1.0/modules/bioinspired/samples/cpp/retinaDemo.cpp>
%

%% Webcam
% setup webcam reader and grab a first frame to get its size
cap = createVideoCapture([], 'chess');
pause(1)
assert(cap.isOpened(), 'Camera failed to initialize');
img = cap.read();
assert(~isempty(img), 'Failed to capture frames');
sz = size(img);

%% Instantiate
% allocate a retina instance with input size equal to the one of the loaded image
if true
    % "classical" retina
    retina = cv.Retina([sz(2) sz(1)]);
else
    % log sampling (favour foveal vision and subsamples peripheral vision)
    retina = cv.Retina([sz(2) sz(1)], 'UseRetinaLogSampling',true, ...
        'ReductionFactor',2, 'SamplingStrength',10);
end

%% retina parameters
% save current (here default) retina parameters to a xml file
% (you may use it only one time to get the file and modify it)
%retina.write('retinaParams.xml');

%%
% load retina parameters from a xml file :
% here we load the default parameters that we just wrote to file
%retina.setup('retinaParams.xml');

%% Prepare
% reset all retina buffers (open your eyes)
retina.clearBuffers();

%%
% prepare figure
figure
subplot(223); hImg(3) = imshow(img); title('retina magno out')
subplot(222); hImg(2) = imshow(img); title('retina parvo out')
subplot(221); hImg(1) = imshow(img); title('input frame')
colormap gray

%% Run
% main processing loop
while all(ishghandle(hImg))
    % grab a new frame and display it
    img = cap.read();
    if isempty(img), break; end

    % run retina on the input image
    retina.run(img);

    % grab retina outputs
    parvo = retina.getParvo();
    magno = retina.getMagno();

    % draw retina outputs
    set(hImg(1), 'CData',img)
    set(hImg(2), 'CData',parvo)
    set(hImg(3), 'CData',magno)
    drawnow
end

cap.release();

##### SOURCE END #####
-->
   </body>
</html>