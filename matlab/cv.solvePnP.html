<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   
      <link rel="stylesheet" href="helpwin.css" />
      <title>cv.solvePnP - mexopencv</title>
   <link rel="stylesheet" type="text/css" href="helpwin_custom.css" />
<meta name="generator" content="MATLAB 9.4.0.902940 (R2018a) Update 4" />
<meta name="description" content="cv.solvePnP - Finds an object pose from 3D-2D point correspondences" />
<link rel="stylesheet" type="text/css" href="matlab.min.css" />
</head>
   <body onload="PR.prettyPrint();">
      <!--Single-page help-->
      <table border="0" cellspacing="0" width="100%">
         <tbody><tr class="subheader">
            <td class="headertitle">cv.solvePnP - MATLAB File Help</td>
            <td class="subheader-right"></td>
         </tr>
      </tbody></table>
      <div class="title">cv.solvePnP</div>
      <div class="helpcontent"><p class=" h1line">Finds an object pose from 3D-2D point correspondences</p>
<pre class=" prettyprint lang-matlab"><code>[rvec, tvec, success] = <a href="cv.solvePnP.html">cv.solvePnP</a>(objectPoints, imagePoints, cameraMatrix)
[...] = <a href="cv.solvePnP.html">cv.solvePnP</a>(..., 'OptionName', optionValue, ...)
</code></pre>
<h2>Input</h2>
<ul>
<li><strong>objectPoints</strong> Array of object points in the object coordinate space,
1xNx3/Nx1x3 or Nx3 array, where <code>N</code> is the number of points, or cell
array of length <code>N</code> of 3-element vectors can be also passed here
<code>{[x,y,z], ...}</code>.</li>
<li><strong>imagePoints</strong> Array of corresponding image points, 1xNx2/Nx1x2 or Nx2
array, where <code>N</code> is the number of points, or cell array of length <code>N</code> of
2-element vectors can be also passed here <code>{[x,y], ...}</code>.</li>
<li><strong>cameraMatrix</strong> Input camera matrix <code>A = [fx 0 cx; 0 fy cy; 0 0 1]</code>.</li>
</ul>
<h2>Output</h2>
<ul>
<li><strong>rvec</strong> Output rotation vector (see <a href="cv.Rodrigues.html">cv.Rodrigues</a>) that, together with
<code>tvec</code>, brings points from the model coordinate system to the camera
coordinate system.</li>
<li><strong>tvec</strong> Output translation vector.</li>
<li><strong>success</strong> success logical flag.</li>
</ul>
<h2>Options</h2>
<ul>
<li><strong>DistCoeffs</strong> Input vector of distortion coefficients
<code>[k1,k2,p1,p2,k3,k4,k5,k6,s1,s2,s3,s4,taux,tauy]</code> of 4, 5, 8, 12 or 14
elements. If the vector is empty, the zero distortion coefficients are
assumed. default empty.</li>
<li><strong>Rvec</strong> Initial <code>rvec</code>. Not set by default.</li>
<li><strong>Tvec</strong> Initial <code>tvec</code>. Not set by default.</li>
<li><strong>UseExtrinsicGuess</strong> Parameter used for <code>Method='Iterative'</code>. If true,
the function uses the provided <code>rvec</code> and <code>tvec</code> values as initial
approximations of the rotation and translation vectors, respectively, and
further optimizes them. default false.</li>
<li><strong>Method</strong> Method for solving the PnP problem. One of the following:
<ul>
<li><strong>Iterative</strong> Iterative method is based on Levenberg-Marquardt
optimization. In this case the function finds such a pose that minimizes
reprojection error, that is the sum of squared distances between the
observed projections <code>imagePoints</code> and the projected (using
<a href="cv.projectPoints.html">cv.projectPoints</a>) <code>objectPoints</code>. This is the default.</li>
<li><strong>P3P</strong> Method is based on the paper [gao2003complete]. In this case the
function requires exactly four object and image points.</li>
<li><strong>AP3P</strong> Method is based on the paper [Ke17]. In this case the function
requires exactly four object and image points.</li>
<li><strong>EPnP</strong> Method has been introduced in the paper [morenoepnp] and
[lepetit2009epnp].</li>
<li><strong>DLS</strong> Method is based on the paper [hesch2011direct].</li>
<li><strong>UPnP</strong> Method is based on the paper [penate2013exhaustive]. In this
case the function also estimates the parameters <code>fx</code> and <code>fy</code> assuming
that both have the same value. Then the <code>cameraMatrix</code> is updated with
the estimated focal length.</li>
</ul>
</li>
</ul>
<p>The function estimates the object pose given a set of object points,
their corresponding image projections, as well as the camera matrix and
the distortion coefficients. See the figure below (more precisely, the
X-axis of the camera frame is pointing to the right, the Y-axis downward and
the Z-axis forward):</p>
<p><img src="https://docs.opencv.org/3.4.0/pnp.jpg" alt="image" /></p>
<p>Points expressed in the world frame <code>X_w</code> are projected into the image plane
<code>[u,v]</code> using the perspective projection model <code>Pi</code> and the camera intrinsic
parameters matrix <code>A</code>:</p>
<pre class=" prettyprint lang-matlab"><code>[u; v; 1] = A * Pi * M_w^c * [X_w; Y_w; Z_w; 1]

[u; v; 1] = [fx 0 cx; 0 fy cy; 0 0 1] *
            [1 0 0 0; 0 1 0 0; 0 0 1 0] *
            [r11 r12 r13 tx; r21 r22 r23 ty; r31 r32 r33 tz] *
            [X_w; Y_w; Z_w; 1]
</code></pre>
<p>The estimated pose is thus the rotation (<code>rvec</code>) and the translation (<code>tvec</code>)
vectors that allow to transform a 3D point expressed in the world frame into
the camera frame:</p>
<pre class=" prettyprint lang-matlab"><code>[X_c; Y_c; Z_c; 1] = M_w^c * [X_w; Y_w; Z_w; 1]

[X_c; Y_c; Z_c; 1] = [r11 r12 r13 tx; r21 r22 r23 ty; r31 r32 r33 tz] *
                     [X_w; Y_w; Z_w; 1]
</code></pre>
<h3>Notes</h3>
<ul>
<li>
<p>The methods <code>DLS</code> and <code>UPnP</code> cannot be used as the current implementations
are unstable and sometimes give completely wrong results. If you pass one
of these two flags, <code>EPnP</code> method will be used instead.</p>
</li>
<li>
<p>The minimum number of points is 4 in the general case. In the case of
<code>P3P</code> and <code>AP3P</code> methods, it is required to use exactly 4 points (the
first 3 points are used to estimate all the solutions of the P3P problem,
the last one is used to retain the best solution that minimizes the
reprojection error).</p>
</li>
<li>
<p>With <code>Iterative</code> method and <code>UseExtrinsicGuess=true</code>, the minimum number
of points is 3 (3 points are sufficient to compute a pose but there are up
to 4 solutions). The initial solution should be close to the global
solution to converge.</p>
</li>
</ul>
<h2>References</h2>
<p>[gao2003complete]:</p>
<blockquote>
<p>X.S. Gao, X.R. Hou, J. Tang, H.F. Chang; &quot;Complete Solution
Classification for the Perspective-Three-Point Problem&quot;,
IEEE Trans. on PAMI, vol. 25, No. 8, p. 930-943, August 2003.</p>
</blockquote>
<p>[Ke17]:</p>
<blockquote>
<p>T. Ke, S. Roumeliotis; &quot;An Efficient Algebraic Solution to the
Perspective-Three-Point Problem&quot;, IEEE Conference on Computer Vision and
Pattern Recognition (CVPR), 2017
<a href="https://arxiv.org/pdf/1701.08237.pdf" target="_blank">PDF</a></p>
</blockquote>
<p>[morenoepnp]:</p>
<blockquote>
<p>F. Moreno-Noguer, V. Lepetit and P. Fua;
&quot;EPnP: Efficient Perspective-n-Point Camera Pose Estimation&quot;.</p>
</blockquote>
<p>[lepetit2009epnp]:</p>
<blockquote>
<p>V. Lepetit, F. Moreno-Noguer, P. Fua;
&quot;EPnP: An accurate O(n) solution to the PnP problem&quot;.
IJCV, vol. 81, No. 2, p. 155-166, 2009</p>
</blockquote>
<p>[hesch2011direct]:</p>
<blockquote>
<p>Joel A. Hesch and Stergios I. Roumeliotis.
&quot;A Direct Least-Squares (DLS) Method for PnP&quot;.
IEEE International Conference on Computer Vision, p. 383-390, 2011.</p>
</blockquote>
<p>[penate2013exhaustive]:</p>
<blockquote>
<p>A. Penate-Sanchez, J. Andrade-Cetto, F. Moreno-Noguer; &quot;Exhaustive
Linearization for Robust Camera Pose and Focal Length Estimation&quot;.
IEEE Trans. on PAMI, vol. 35, No. 10, p. 2387-2400, 2013.</p>
</blockquote>
</div><!--after help --><!--seeAlso--><div class="footerlinktitle">See also</div><div class="footerlink"> <a href="cv.solvePnPRansac.html">cv.solvePnPRansac</a>, <a href="https://www.mathworks.com/help/vision/ref/estimateworldcamerapose.html" target="_blank">estimateWorldCameraPose</a>, <a href="https://www.mathworks.com/help/vision/ref/cameraposetoextrinsics.html" target="_blank">cameraPoseToExtrinsics</a>,
   <a href="https://www.mathworks.com/help/vision/ref/extrinsicstocamerapose.html" target="_blank">extrinsicsToCameraPose</a></div>
   
<script type="text/javascript" src="prettify.js"></script>
<script type="text/javascript" src="lang-matlab.min.js"></script>
</body></html>