<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Creating a video with OpenCV</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="video_write_demo.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Creating a video with OpenCV</h1>
         <!--introduction-->
         <p>This demo shows how to write video files.</p>
         <p>It explains:</p>
         <div>
            <ul>
               <li>How to create a video file with OpenCV</li>
               <li>What type of video files you can create with OpenCV</li>
               <li>How to extract a given color channel from a video</li>
            </ul>
         </div>
         <p>As a simple demonstration we will just extract one of the BGR color channels of an input video file or webcam feed into a
            new video.
         </p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://docs.opencv.org/3.2.0/d7/d9e/tutorial_video_write.html">https://docs.opencv.org/3.2.0/d7/d9e/tutorial_video_write.html</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/videoio/video-write/video-write.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/videoio/video-write/video-write.cpp</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/videowriter_basic.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/videowriter_basic.cpp</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <h2 id="toc">Contents</h2>
         <div>
            <ul>
               <li><a href="#3">The structure of a video</a></li>
               <li><a href="#4">The <tt>cv.VideoWriter</tt> class</a></li>
               <li><a href="#5">Code</a></li>
            </ul>
         </div>
         <p>Whenever you work with video feeds you may eventually want to save your image processing result in a form of a new video file.
            For simple video outputs you can use the OpenCV built-in <tt>cv.VideoWriter</tt> class, designed for this.
         </p>
         <h2 id="3">The structure of a video</h2>
         <p>For start, you should have an idea of just how a video file looks. Every video file in itself is a container. The type of
            the container is expressed in the files extension (for example <i>avi</i>, <i>mov</i> or <i>mkv</i>). This contains multiple elements like: video feeds, audio feeds or other tracks (like for example subtitles). How these
            feeds are stored is determined by the codec used for each one of them. In case of the audio tracks commonly used codecs are
            <i>mp3</i> or <i>aac</i>. For the video files the list is somehow longer and includes names such as <i>XVID</i>, <i>DIVX</i>, <i>H264</i> or <i>LAGS</i> (Lagarith Lossless Codec). The full list of codecs you may use on a system depends on just what one you have installed.
         </p>
         <p><img src="https://docs.opencv.org/3.2.0/videoFileStructure.png"></p>
         <p>As you can see things can get really complicated with videos. However, OpenCV is mainly a computer vision library, not a video
            stream, codec and write one. Therefore, the developers tried to keep this part as simple as possible. Due to this OpenCV for
            video containers supports only the <i>avi</i> extension, its first version. A direct limitation of this is that you cannot save a video file larger than 2 GB. Furthermore
            you can only create and expand a single video track inside the container. No audio or other track editing support here. Nevertheless,
            any video codec present on your system might work. If you encounter some of these limitations you will need to look into more
            specialized video writing libraries such as <i>FFMpeg</i> or codecs as <i>HuffYUV</i>, <i>CorePNG</i> and <i>LCL</i>. As an alternative, create the video track with OpenCV and expand it with sound tracks or convert it to other formats by
            using video manipulation programs such as <i>VirtualDub</i> or <i>AviSynth</i>.
         </p>
         <h2 id="4">The <tt>cv.VideoWriter</tt> class
         </h2>
         <p>To create a video file you just need to create an instance of the <tt>cv.VideoWriter</tt> class. You can specify its properties either via parameters in the constructor or later on via the <tt>cv.VideoWriter.open</tt> function. Either way, the parameters are the same:
         </p>
         <div>
            <ul>
               <li>The name of the output that contains the container type in its extension.   At the moment only <i>avi</i> is supported.
               </li>
               <li>The size of the frames for the output video.</li>
               <li>The frame per second <tt>FPS</tt> for the output video.
               </li>
               <li>An optional <tt>Color</tt> argument. By default is true and says that the output   will be a colorful one (so for write you will send three channel
                  images).   To create a gray scale video pass a false parameter here.
               </li>
               <li>The codec to use for the video track. Now all the video codecs have a   unique short name of maximum four characters. Hence,
                  the <i>XVID</i>, <i>DIVX</i> or   <i>H264</i> names. This is called a four character code. You may also ask this   from an input video by querying its <tt>FourCC</tt> property. Four characters are   four bytes, returned as a 32 bit integer. OpenCV internally works with   this integer type
                  and accept it in the <tt>FourCC</tt> option. It can also be   specified as one of predefined strings. If you pass for this argument the   value "minus one" then
                  a window will pop up at runtime that contains all   the codec installed on your system and ask you to select the one to use:
               </li>
            </ul>
         </div>
         <p><img src="https://docs.opencv.org/3.2.0/videoCompressSelect.png"></p>
         <p>Afterwards, you can use the <tt>cv.VideoWriter.isOpened</tt> function to find out if the open operation succeeded or not. The video file automatically closes when the <tt>cv.VideoWriter</tt> object is destroyed. After you open the object with success you can send the frames of the video in a sequential order by
            using the <tt>cv.VideoWriter.write</tt> function of the class.
         </p>
         <h2 id="5">Code</h2>
         <p>open webcam</p><pre class="codeinput">cap = createVideoCapture([], <span class="string">'chess'</span>);
assert(cap.isOpened(), <span class="string">'Could not initialize capturing'</span>);

frame = cap.read();
assert(~isempty(frame), <span class="string">'Failed to read frame'</span>);
hImg = imshow(frame);</pre><img src="video_write_demo_01.png"><p>acquire input size</p><pre class="codeinput">sz = [cap.get(<span class="string">'FrameWidth'</span>), cap.get(<span class="string">'FrameHeight'</span>)];
<span class="comment">%sz = [size(frame,2), size(frame,1)];</span></pre><p>open the output video</p><pre class="codeinput">fname = fullfile(tempdir(), <span class="string">'output.avi'</span>);
vid = cv.VideoWriter(fname, sz, <span class="string">'FourCC'</span>,<span class="string">'MJPG'</span>, <span class="string">'FPS'</span>,25, <span class="string">'Color'</span>,true);
assert(vid.isOpened(), <span class="string">'Could not open output video'</span>);</pre><p>select channel to save (extracting a color channel from an RGB image means setings the values of the other channels to zero)</p><pre class="codeinput">ch = 1;  <span class="comment">% 1=red, 2=green, 3=blue</span>
<span class="keyword">if</span> true
    idx = setdiff(1:3, ch);
<span class="keyword">else</span>
    idx = (1:3) ~= ch;
<span class="keyword">end</span></pre><p>main loop, reading frames from webcam and saving to video file (we only record a limited number of frames in this demo)</p><pre class="codeinput">counter = 0;
<span class="keyword">while</span> counter &lt; 25 &amp;&amp; ishghandle(hImg)
    <span class="comment">% read next frame</span>
    counter = counter + 1;
    frame = cap.read();
    <span class="keyword">if</span> isempty(frame), <span class="keyword">break</span>; <span class="keyword">end</span>

    <span class="comment">% extract only the specified channel</span>
    frame(:,:,idx) = 0;

    <span class="comment">% write to output video</span>
    vid.write(frame);

    <span class="comment">% show processed frame</span>
    set(hImg, <span class="string">'CData'</span>,frame);
    drawnow;
<span class="keyword">end</span></pre><img src="video_write_demo_02.png"><p>close webcam feed and output video</p><pre class="codeinput">cap.release();
vid.release();</pre><p>open video file in system media player</p><pre class="codeinput">disp([<span class="string">'Video saved in: '</span> fname])
<span class="keyword">if</span> ispc() &amp;&amp; ~mexopencv.isOctave()
    <span class="comment">%HACK: WINOPEN not implemented in Octave</span>
    winopen(fname);
<span class="keyword">end</span></pre><pre class="codeoutput">Video saved in: C:\Users\Amro\AppData\Local\Temp\output.avi
</pre><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Creating a video with OpenCV
% This demo shows how to write video files.
%
% It explains:
%
% * How to create a video file with OpenCV
% * What type of video files you can create with OpenCV
% * How to extract a given color channel from a video
%
% As a simple demonstration we will just extract one of the BGR color channels
% of an input video file or webcam feed into a new video.
%
% Sources:
%
% * <https://docs.opencv.org/3.2.0/d7/d9e/tutorial_video_write.html>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/videoio/video-write/video-write.cpp>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/videowriter_basic.cpp>
%

%%
%
% Whenever you work with video feeds you may eventually want to save your
% image processing result in a form of a new video file. For simple video
% outputs you can use the OpenCV built-in |cv.VideoWriter| class, designed for
% this.
%
%% The structure of a video
%
% For start, you should have an idea of just how a video file looks. Every
% video file in itself is a container. The type of the container is expressed
% in the files extension (for example _avi_, _mov_ or _mkv_). This contains
% multiple elements like: video feeds, audio feeds or other tracks (like for
% example subtitles). How these feeds are stored is determined by the codec
% used for each one of them. In case of the audio tracks commonly used codecs
% are _mp3_ or _aac_. For the video files the list is somehow longer and
% includes names such as _XVID_, _DIVX_, _H264_ or _LAGS_ (Lagarith Lossless
% Codec). The full list of codecs you may use on a system depends on just what
% one you have installed.
%
% <<https://docs.opencv.org/3.2.0/videoFileStructure.png>>
%
% As you can see things can get really complicated with videos. However,
% OpenCV is mainly a computer vision library, not a video stream, codec and
% write one. Therefore, the developers tried to keep this part as simple as
% possible. Due to this OpenCV for video containers supports only the _avi_
% extension, its first version. A direct limitation of this is that you cannot
% save a video file larger than 2 GB. Furthermore you can only create and
% expand a single video track inside the container. No audio or other track
% editing support here. Nevertheless, any video codec present on your system
% might work. If you encounter some of these limitations you will need to look
% into more specialized video writing libraries such as _FFMpeg_ or codecs as
% _HuffYUV_, _CorePNG_ and _LCL_. As an alternative, create the video track
% with OpenCV and expand it with sound tracks or convert it to other formats
% by using video manipulation programs such as _VirtualDub_ or _AviSynth_.
%
%% The |cv.VideoWriter| class
%
% To create a video file you just need to create an instance of the
% |cv.VideoWriter| class. You can specify its properties either via parameters
% in the constructor or later on via the |cv.VideoWriter.open| function.
% Either way, the parameters are the same:
%
% * The name of the output that contains the container type in its extension.
%   At the moment only _avi_ is supported.
% * The size of the frames for the output video.
% * The frame per second |FPS| for the output video.
% * An optional |Color| argument. By default is true and says that the output
%   will be a colorful one (so for write you will send three channel images).
%   To create a gray scale video pass a false parameter here.
% * The codec to use for the video track. Now all the video codecs have a
%   unique short name of maximum four characters. Hence, the _XVID_, _DIVX_ or
%   _H264_ names. This is called a four character code. You may also ask this
%   from an input video by querying its |FourCC| property. Four characters are
%   four bytes, returned as a 32 bit integer. OpenCV internally works with
%   this integer type and accept it in the |FourCC| option. It can also be
%   specified as one of predefined strings. If you pass for this argument the
%   value "minus one" then a window will pop up at runtime that contains all
%   the codec installed on your system and ask you to select the one to use:
%
% <<https://docs.opencv.org/3.2.0/videoCompressSelect.png>>
%
% Afterwards, you can use the |cv.VideoWriter.isOpened| function to find out
% if the open operation succeeded or not. The video file automatically closes
% when the |cv.VideoWriter| object is destroyed. After you open the object
% with success you can send the frames of the video in a sequential order by
% using the |cv.VideoWriter.write| function of the class.
%

%% Code

%%
% open webcam
cap = createVideoCapture([], 'chess');
assert(cap.isOpened(), 'Could not initialize capturing');

frame = cap.read();
assert(~isempty(frame), 'Failed to read frame');
hImg = imshow(frame);

%%
% acquire input size
sz = [cap.get('FrameWidth'), cap.get('FrameHeight')];
%sz = [size(frame,2), size(frame,1)];

%%
% open the output video
fname = fullfile(tempdir(), 'output.avi');
vid = cv.VideoWriter(fname, sz, 'FourCC','MJPG', 'FPS',25, 'Color',true);
assert(vid.isOpened(), 'Could not open output video');

%%
% select channel to save (extracting a color channel from an RGB image means
% setings the values of the other channels to zero)
ch = 1;  % 1=red, 2=green, 3=blue
if true
    idx = setdiff(1:3, ch);
else
    idx = (1:3) ~= ch;
end

%%
% main loop, reading frames from webcam and saving to video file
% (we only record a limited number of frames in this demo)
counter = 0;
while counter < 25 && ishghandle(hImg)
    % read next frame
    counter = counter + 1;
    frame = cap.read();
    if isempty(frame), break; end

    % extract only the specified channel
    frame(:,:,idx) = 0;

    % write to output video
    vid.write(frame);

    % show processed frame
    set(hImg, 'CData',frame);
    drawnow;
end

%%
% close webcam feed and output video
cap.release();
vid.release();

%%
% open video file in system media player
disp(['Video saved in: ' fname])
if ispc() && ~mexopencv.isOctave()
    %HACK: WINOPEN not implemented in Octave
    winopen(fname);
end

##### SOURCE END #####
-->
   </body>
</html>