<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Image Blending</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="linear_blending_demo_gui.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Image Blending</h1>
         <p>In this demo, we add two images using <tt>cv.addWeighted</tt> which defines a linear blend operator:
         </p>
         <p><img src="linear_blending_demo_gui_eq13533701783415785391.png" alt="$$g(x) = (1 - \alpha)f_{0}(x) + \alpha f_{1}(x)$$" class="equation" width="185" height="15"></p>
         <p>By varying <img src="linear_blending_demo_gui_eq14221827199139923399.png" alt="$\alpha$" class="equation" width="9" height="7"> from <img src="linear_blending_demo_gui_eq08249786390268139481.png" alt="$0 \rightarrow 1$" class="equation" width="36" height="11"> this operator can be used to perform a temporal <b>cross-dissolve</b> between two images or videos.
         </p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://docs.opencv.org/3.2.0/d5/dc4/tutorial_adding_images.html">https://docs.opencv.org/3.2.0/d5/dc4/tutorial_adding_images.html</a></li>
               <li><a href="https://docs.opencv.org/3.2.0/da/d6a/tutorial_trackbar.html">https://docs.opencv.org/3.2.0/da/d6a/tutorial_trackbar.html</a></li>
               <li><a href="https://docs.opencv.org/3.2.0/d0/d86/tutorial_py_image_arithmetics.html">https://docs.opencv.org/3.2.0/d0/d86/tutorial_py_image_arithmetics.html</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/core/AddingImages/AddingImages.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/core/AddingImages/AddingImages.cpp</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/HighGUI/AddingImagesTrackbar.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/HighGUI/AddingImagesTrackbar.cpp</a></li>
            </ul>
         </div><pre class="codeinput"><span class="keyword">function</span> varargout = linear_blending_demo_gui(im1, im2)
    <span class="comment">% load source images</span>
    <span class="keyword">if</span> nargin &lt; 1
        im1 = fullfile(mexopencv.root(),<span class="string">'test'</span>,<span class="string">'apple.jpg'</span>);
        img1 = cv.imread(im1, <span class="string">'Color'</span>,true);
        img1 = drawText(img1, <span class="string">'Apple'</span>, true, <span class="string">'Color'</span>,[255 0 0]);
    <span class="keyword">elseif</span> ischar(im1)
        img1 = cv.imread(im1, <span class="string">'Color'</span>,true);
    <span class="keyword">else</span>
        img1 = im1;
    <span class="keyword">end</span>
    <span class="keyword">if</span> nargin &lt; 2
        im2 = fullfile(mexopencv.root(),<span class="string">'test'</span>,<span class="string">'orange.jpg'</span>);
        img2 = cv.imread(im2, <span class="string">'Color'</span>,true);
        img2 = drawText(img2, <span class="string">'Orange'</span>, false, <span class="string">'Color'</span>,[255 128 0]);
    <span class="keyword">elseif</span> ischar(im2)
        img2 = cv.imread(im2, <span class="string">'Color'</span>,true);
    <span class="keyword">else</span>
        img2 = im2;
    <span class="keyword">end</span>
    assert(isequal(size(img1), size(img2)), <span class="string">'Different image sizes'</span>);

    <span class="comment">% create the UI</span>
    h = buildGUI(img1, img2);
    <span class="keyword">if</span> nargout &gt; 0, varargout{1} = h; <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> img = drawText(img, str, top, varargin)
    <span class="comment">%DRAWTEXT  Helper function to put text on image</span>

    opts = {<span class="string">'FontFace'</span>,<span class="string">'HersheyComplex'</span>, <span class="string">'FontScale'</span>,3, <span class="string">'Thickness'</span>,9};
    txtsz = cv.getTextSize(str, opts{:});
    x = (size(img,2) - txtsz(1)) / 2;
    <span class="keyword">if</span> top
        y = 2*txtsz(2);
    <span class="keyword">else</span>
        y = size(img,1) - txtsz(2);
    <span class="keyword">end</span>
    img = cv.putText(img, str, round([x y]), opts{:}, varargin{:});
<span class="keyword">end</span>

<span class="keyword">function</span> onChange(~,~,h)
    <span class="comment">%ONCHANGE  Event handler for UI controls</span>

    <span class="comment">% retrieve current values from UI controls</span>
    a = get(h.slid, <span class="string">'Value'</span>);
    set(h.txt, <span class="string">'String'</span>,sprintf(<span class="string">'Alpha: %.2f'</span>,a));

    <span class="comment">% image blending</span>
    out = cv.addWeighted(h.src1, a, h.src2, 1-a, 0.0);

    <span class="comment">% show result</span>
    set(h.img, <span class="string">'CData'</span>,out);
    drawnow;
<span class="keyword">end</span>

<span class="keyword">function</span> h = buildGUI(img1, img2)
    <span class="comment">%BUILDGUI  Creates the UI</span>

    <span class="comment">% parameters</span>
    a = 0.5;
    sz = size(img1);
    sz(2) = max(sz(2), 300);  <span class="comment">% minimum figure width</span>

    <span class="comment">% build the user interface (no resizing to keep it simple)</span>
    h = struct();
    h.src1 = img1;
    h.src2 = img2;
    h.fig = figure(<span class="string">'Name'</span>,<span class="string">'Linear Blend Demo'</span>, <span class="keyword">...</span>
        <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>, <span class="string">'Menubar'</span>,<span class="string">'none'</span>, <span class="string">'Resize'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[200 200 sz(2) sz(1)+29]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        <span class="comment">%HACK: not implemented in Octave</span>
        movegui(h.fig, <span class="string">'center'</span>);
    <span class="keyword">end</span>
    h.ax = axes(<span class="string">'Parent'</span>,h.fig, <span class="string">'Units'</span>,<span class="string">'pixels'</span>, <span class="string">'Position'</span>,[1 30 sz(2) sz(1)]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        h.img = imshow(img1, <span class="string">'Parent'</span>,h.ax);
    <span class="keyword">else</span>
        <span class="comment">%HACK: https://savannah.gnu.org/bugs/index.php?45473</span>
        axes(h.ax);
        h.img = imshow(img1);
    <span class="keyword">end</span>
    h.txt = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="string">'FontSize'</span>,11, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 5 100 20], <span class="string">'String'</span>,sprintf(<span class="string">'Alpha: %.2f'</span>,a));
    h.slid = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="string">'Value'</span>,a, <span class="keyword">...</span>
        <span class="string">'Min'</span>,0, <span class="string">'Max'</span>,1, <span class="string">'SliderStep'</span>,[0.01 0.1]./(1-0), <span class="keyword">...</span>
        <span class="string">'Position'</span>,[105 5 sz(2)-105-5 20]);

    <span class="comment">% hook event handlers, and trigger default start</span>
    set(h.slid, <span class="string">'Callback'</span>,{@onChange,h}, <span class="keyword">...</span>
        <span class="string">'Interruptible'</span>,<span class="string">'off'</span>, <span class="string">'BusyAction'</span>,<span class="string">'cancel'</span>);
    onChange([],[],h);
<span class="keyword">end</span></pre><img src="linear_blending_demo_gui_01.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div><script type="text/x-mathjax-config">
  // https://stackoverflow.com/a/14631703/97160
  MathJax.Extension.myImg2jax = {
    version: "1.0",
    PreProcess: function (element) {
      var images = element.getElementsByTagName("img");
      for (var i = images.length - 1; i >= 0; i--) {
        var img = images[i];
        if (img.className === "equation") {
          var match = img.alt.match(/^(\$\$?)([\s\S]*)\1$/m);
          if (!match) continue;
          var script = document.createElement("script");
          script.type = "math/tex";
          if (match[1] === "$$") {script.type += ";mode=display"}
          MathJax.HTML.setScript(script, match[2]);
          img.parentNode.replaceChild(script, img);
        }
      }
    }
  };
  MathJax.Hub.Register.PreProcessor(["PreProcess", MathJax.Extension.myImg2jax]);
  </script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML"></script>
      <!--
##### SOURCE BEGIN #####
%% Image Blending
%
% In this demo, we add two images using |cv.addWeighted| which defines a
% linear blend operator:
%
% $$g(x) = (1 - \alpha)f_{0}(x) + \alpha f_{1}(x)$$
%
% By varying $\alpha$ from $0 \rightarrow 1$ this operator can be used to
% perform a temporal *cross-dissolve* between two images or videos.
%
% Sources:
%
% * <https://docs.opencv.org/3.2.0/d5/dc4/tutorial_adding_images.html>
% * <https://docs.opencv.org/3.2.0/da/d6a/tutorial_trackbar.html>
% * <https://docs.opencv.org/3.2.0/d0/d86/tutorial_py_image_arithmetics.html>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/core/AddingImages/AddingImages.cpp>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/HighGUI/AddingImagesTrackbar.cpp>
%

function varargout = linear_blending_demo_gui(im1, im2)
    % load source images
    if nargin < 1
        im1 = fullfile(mexopencv.root(),'test','apple.jpg');
        img1 = cv.imread(im1, 'Color',true);
        img1 = drawText(img1, 'Apple', true, 'Color',[255 0 0]);
    elseif ischar(im1)
        img1 = cv.imread(im1, 'Color',true);
    else
        img1 = im1;
    end
    if nargin < 2
        im2 = fullfile(mexopencv.root(),'test','orange.jpg');
        img2 = cv.imread(im2, 'Color',true);
        img2 = drawText(img2, 'Orange', false, 'Color',[255 128 0]);
    elseif ischar(im2)
        img2 = cv.imread(im2, 'Color',true);
    else
        img2 = im2;
    end
    assert(isequal(size(img1), size(img2)), 'Different image sizes');

    % create the UI
    h = buildGUI(img1, img2);
    if nargout > 0, varargout{1} = h; end
end

function img = drawText(img, str, top, varargin)
    %DRAWTEXT  Helper function to put text on image

    opts = {'FontFace','HersheyComplex', 'FontScale',3, 'Thickness',9};
    txtsz = cv.getTextSize(str, opts{:});
    x = (size(img,2) - txtsz(1)) / 2;
    if top
        y = 2*txtsz(2);
    else
        y = size(img,1) - txtsz(2);
    end
    img = cv.putText(img, str, round([x y]), opts{:}, varargin{:});
end

function onChange(~,~,h)
    %ONCHANGE  Event handler for UI controls

    % retrieve current values from UI controls
    a = get(h.slid, 'Value');
    set(h.txt, 'String',sprintf('Alpha: %.2f',a));

    % image blending
    out = cv.addWeighted(h.src1, a, h.src2, 1-a, 0.0);

    % show result
    set(h.img, 'CData',out);
    drawnow;
end

function h = buildGUI(img1, img2)
    %BUILDGUI  Creates the UI

    % parameters
    a = 0.5;
    sz = size(img1);
    sz(2) = max(sz(2), 300);  % minimum figure width

    % build the user interface (no resizing to keep it simple)
    h = struct();
    h.src1 = img1;
    h.src2 = img2;
    h.fig = figure('Name','Linear Blend Demo', ...
        'NumberTitle','off', 'Menubar','none', 'Resize','off', ...
        'Position',[200 200 sz(2) sz(1)+29]);
    if ~mexopencv.isOctave()
        %HACK: not implemented in Octave
        movegui(h.fig, 'center');
    end
    h.ax = axes('Parent',h.fig, 'Units','pixels', 'Position',[1 30 sz(2) sz(1)]);
    if ~mexopencv.isOctave()
        h.img = imshow(img1, 'Parent',h.ax);
    else
        %HACK: https://savannah.gnu.org/bugs/index.php?45473
        axes(h.ax);
        h.img = imshow(img1);
    end
    h.txt = uicontrol('Parent',h.fig, 'Style','text', 'FontSize',11, ...
        'Position',[5 5 100 20], 'String',sprintf('Alpha: %.2f',a));
    h.slid = uicontrol('Parent',h.fig, 'Style','slider', 'Value',a, ...
        'Min',0, 'Max',1, 'SliderStep',[0.01 0.1]./(1-0), ...
        'Position',[105 5 sz(2)-105-5 20]);

    % hook event handlers, and trigger default start
    set(h.slid, 'Callback',{@onChange,h}, ...
        'Interruptible','off', 'BusyAction','cancel');
    onChange([],[],h);
end

##### SOURCE END #####
--></body>
</html>