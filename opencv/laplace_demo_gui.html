<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Laplacian Edge Detection</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="laplace_demo_gui.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Laplacian Edge Detection</h1>
         <p>This program demonstrates Laplace point/edge detection using OpenCV function <tt>cv.Laplacian</tt>. It captures from the camera by default.
         </p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://github.com/opencv/opencv/blob/3.1.0/samples/cpp/laplace.cpp">https://github.com/opencv/opencv/blob/3.1.0/samples/cpp/laplace.cpp</a></li>
            </ul>
         </div><pre class="codeinput"><span class="keyword">function</span> varargout = laplace_demo_gui()
    <span class="comment">% setup video capture</span>
    cap = createVideoCapture([], <span class="string">'lena'</span>);
    pause(1);
    assert(cap.isOpened(), <span class="string">'Could not initialize capturing'</span>);
    frame = cap.read();
    assert(~isempty(frame), <span class="string">'Could not read frame'</span>);

    <span class="comment">% create the UI</span>
    h = buildGUI(frame);
    <span class="keyword">if</span> nargout &gt; 0, varargout{1} = h; <span class="keyword">end</span>

    <span class="comment">% main loop</span>
    <span class="keyword">while</span> ishghandle(h.fig)
        <span class="comment">% grab frame</span>
        frame = cap.read();
        <span class="keyword">if</span> isempty(frame), <span class="keyword">break</span>; <span class="keyword">end</span>

        <span class="comment">% retrieve current values from UI controls</span>
        sigma = round(get(h.slid, <span class="string">'Value'</span>));
        smoothType = get(h.pop, <span class="string">'Value'</span>);

        <span class="comment">% smooth image</span>
        ksize = sigma*5;
        <span class="keyword">if</span> mod(ksize,2) == 0, ksize = ksize + 1; <span class="keyword">end</span>
        <span class="keyword">switch</span> smoothType
            <span class="keyword">case</span> 1
                frame = cv.GaussianBlur(frame, <span class="string">'KSize'</span>,[ksize ksize], <span class="keyword">...</span>
                    <span class="string">'SigmaX'</span>,sigma, <span class="string">'SigmaY'</span>,sigma);
            <span class="keyword">case</span> 2
                frame = cv.blur(frame, <span class="string">'KSize'</span>,[ksize ksize]);
            <span class="keyword">case</span> 3
                frame = cv.medianBlur(frame, <span class="string">'KSize'</span>,ksize);
        <span class="keyword">end</span>

        <span class="comment">% calculate laplacian</span>
        lap = cv.Laplacian(frame, <span class="string">'DDepth'</span>,<span class="string">'int16'</span>, <span class="string">'KSize'</span>,5);
        lap = cv.convertScaleAbs(lap, <span class="string">'Alpha'</span>,(sigma+1)*0.25);

        <span class="comment">% show result</span>
        set(h.img, <span class="string">'CData'</span>,lap);
        drawnow;
    <span class="keyword">end</span>
    cap.release();
<span class="keyword">end</span>

<span class="keyword">function</span> onChange(~,~,h)
    <span class="comment">%ONCHANGE  Event handler for UI controls</span>

    sigma = round(get(h.slid, <span class="string">'Value'</span>));
    set(h.txt, <span class="string">'String'</span>,sprintf(<span class="string">'Sigma: %2d'</span>,sigma));
<span class="keyword">end</span>

<span class="keyword">function</span> h = buildGUI(img)
    <span class="comment">%BUILDGUI  Creates the UI</span>

    <span class="comment">% parameters</span>
    sigma = 3;
    max_sig = 15;
    sz = size(img);
    sz(2) = max(sz(2), 250);  <span class="comment">% minimum figure width</span>

    <span class="comment">% build the user interface (no resizing to keep it simple)</span>
    h = struct();
    h.fig = figure(<span class="string">'Name'</span>,<span class="string">'Laplacian'</span>, <span class="keyword">...</span>
        <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>, <span class="string">'Menubar'</span>,<span class="string">'none'</span>, <span class="string">'Resize'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[200 200 sz(2) sz(1)+29]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        <span class="comment">%HACK: not implemented in Octave</span>
        movegui(h.fig, <span class="string">'center'</span>);
    <span class="keyword">end</span>
    h.ax = axes(<span class="string">'Parent'</span>,h.fig, <span class="keyword">...</span>
        <span class="string">'Units'</span>,<span class="string">'pixels'</span>, <span class="string">'Position'</span>,[1 30 sz(2) sz(1)]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        h.img = imshow(img, <span class="string">'Parent'</span>,h.ax);
    <span class="keyword">else</span>
        <span class="comment">%HACK: https://savannah.gnu.org/bugs/index.php?45473</span>
        axes(h.ax);
        h.img = imshow(img);
    <span class="keyword">end</span>
    h.pop = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'popupmenu'</span>, <span class="keyword">...</span>
       <span class="string">'Position'</span>,[5 5 70 20], <span class="string">'String'</span>,{<span class="string">'Gaussian'</span>, <span class="string">'Blur'</span>, <span class="string">'Median'</span>});
    h.txt = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="string">'FontSize'</span>,11, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[75 5 100 20], <span class="string">'String'</span>,sprintf(<span class="string">'Sigma: %2d'</span>,sigma));
    h.slid = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="string">'Value'</span>,sigma, <span class="keyword">...</span>
        <span class="string">'Min'</span>,0, <span class="string">'Max'</span>,max_sig, <span class="string">'SliderStep'</span>,[1 5]./(max_sig-0), <span class="keyword">...</span>
        <span class="string">'Position'</span>,[175 5 sz(2)-175-5 20]);

    <span class="comment">% hook event handlers, and trigger default start</span>
    set(h.slid, <span class="string">'Callback'</span>,{@onChange,h}, <span class="keyword">...</span>
        <span class="string">'Interruptible'</span>,<span class="string">'off'</span>, <span class="string">'BusyAction'</span>,<span class="string">'cancel'</span>);
    onChange([],[],h);
<span class="keyword">end</span></pre><img src="laplace_demo_gui_01.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Laplacian Edge Detection
% This program demonstrates Laplace point/edge detection using OpenCV
% function |cv.Laplacian|.
% It captures from the camera by default.
%
% Sources:
%
% * <https://github.com/opencv/opencv/blob/3.1.0/samples/cpp/laplace.cpp>
%

function varargout = laplace_demo_gui()
    % setup video capture
    cap = createVideoCapture([], 'lena');
    pause(1);
    assert(cap.isOpened(), 'Could not initialize capturing');
    frame = cap.read();
    assert(~isempty(frame), 'Could not read frame');

    % create the UI
    h = buildGUI(frame);
    if nargout > 0, varargout{1} = h; end

    % main loop
    while ishghandle(h.fig)
        % grab frame
        frame = cap.read();
        if isempty(frame), break; end

        % retrieve current values from UI controls
        sigma = round(get(h.slid, 'Value'));
        smoothType = get(h.pop, 'Value');

        % smooth image
        ksize = sigma*5;
        if mod(ksize,2) == 0, ksize = ksize + 1; end
        switch smoothType
            case 1
                frame = cv.GaussianBlur(frame, 'KSize',[ksize ksize], ...
                    'SigmaX',sigma, 'SigmaY',sigma);
            case 2
                frame = cv.blur(frame, 'KSize',[ksize ksize]);
            case 3
                frame = cv.medianBlur(frame, 'KSize',ksize);
        end

        % calculate laplacian
        lap = cv.Laplacian(frame, 'DDepth','int16', 'KSize',5);
        lap = cv.convertScaleAbs(lap, 'Alpha',(sigma+1)*0.25);

        % show result
        set(h.img, 'CData',lap);
        drawnow;
    end
    cap.release();
end

function onChange(~,~,h)
    %ONCHANGE  Event handler for UI controls

    sigma = round(get(h.slid, 'Value'));
    set(h.txt, 'String',sprintf('Sigma: %2d',sigma));
end

function h = buildGUI(img)
    %BUILDGUI  Creates the UI

    % parameters
    sigma = 3;
    max_sig = 15;
    sz = size(img);
    sz(2) = max(sz(2), 250);  % minimum figure width

    % build the user interface (no resizing to keep it simple)
    h = struct();
    h.fig = figure('Name','Laplacian', ...
        'NumberTitle','off', 'Menubar','none', 'Resize','off', ...
        'Position',[200 200 sz(2) sz(1)+29]);
    if ~mexopencv.isOctave()
        %HACK: not implemented in Octave
        movegui(h.fig, 'center');
    end
    h.ax = axes('Parent',h.fig, ...
        'Units','pixels', 'Position',[1 30 sz(2) sz(1)]);
    if ~mexopencv.isOctave()
        h.img = imshow(img, 'Parent',h.ax);
    else
        %HACK: https://savannah.gnu.org/bugs/index.php?45473
        axes(h.ax);
        h.img = imshow(img);
    end
    h.pop = uicontrol('Parent',h.fig, 'Style','popupmenu', ...
       'Position',[5 5 70 20], 'String',{'Gaussian', 'Blur', 'Median'});
    h.txt = uicontrol('Parent',h.fig, 'Style','text', 'FontSize',11, ...
        'Position',[75 5 100 20], 'String',sprintf('Sigma: %2d',sigma));
    h.slid = uicontrol('Parent',h.fig, 'Style','slider', 'Value',sigma, ...
        'Min',0, 'Max',max_sig, 'SliderStep',[1 5]./(max_sig-0), ...
        'Position',[175 5 sz(2)-175-5 20]);

    % hook event handlers, and trigger default start
    set(h.slid, 'Callback',{@onChange,h}, ...
        'Interruptible','off', 'BusyAction','cancel');
    onChange([],[],h);
end

##### SOURCE END #####
-->
   </body>
</html>