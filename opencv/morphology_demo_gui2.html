<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Advanced Morphology Transformations Demo</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="morphology_demo_gui2.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Advanced Morphology Transformations Demo</h1>
         <!--introduction-->
         <p>In this sample you will learn how to use the OpenCV function <a href="matlab:doc('cv.morphologyEx')">cv.morphologyEx</a> to apply Morphological Transformation such as:
         </p>
         <div>
            <ul>
               <li>Opening</li>
               <li>Closing</li>
               <li>Morphological Gradient</li>
               <li>Top Hat</li>
               <li>Black Hat</li>
            </ul>
         </div>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://docs.opencv.org/3.2.0/d3/dbe/tutorial_opening_closing_hats.html">https://docs.opencv.org/3.2.0/d3/dbe/tutorial_opening_closing_hats.html</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgProc/Morphology_2.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgProc/Morphology_2.cpp</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/morphology2.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/morphology2.cpp</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/python/morphology.py">https://github.com/opencv/opencv/blob/3.2.0/samples/python/morphology.py</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <h2 id="toc">Contents</h2>
         <div>
            <ul>
               <li><a href="#2">Theory</a></li>
               <li><a href="#3">1) Opening</a></li>
               <li><a href="#4">2) Closing</a></li>
               <li><a href="#5">3) Morphological Gradient</a></li>
               <li><a href="#6">4) Top Hat</a></li>
               <li><a href="#7">5) Black Hat</a></li>
               <li><a href="#8">References</a></li>
            </ul>
         </div>
         <h2 id="2">Theory</h2>
         <p>We previously covered two basic Morphology operations:</p>
         <div>
            <ul>
               <li>Erosion</li>
               <li>Dilation</li>
            </ul>
         </div>
         <p>Based on these two we can effectuate more sophisticated transformations to our images. Here we discuss briefly 5 operations
            offered by OpenCV.
         </p>
         <h2 id="3">1) Opening</h2>
         <p>It is obtained by the erosion of an image followed by a dilation.</p>
         <p><img src="morphology_demo_gui2_eq05748002955564752132.png" alt="$$dst = open( src, element) = dilate( erode( src, element ) )$$" class="equation" width="352" height="15"></p>
         <p>Useful for removing small objects (it is assumed that the objects are bright on a dark foreground). For instance, check out
            the example below. The image at the left is the original and the image at the right is the result after applying the opening
            transformation. We can observe that the small spaces in the corners of the letter tend to dissapear.
         </p>
         <p><img src="https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_Opening.png"></p>
         <p>For the sake of clarity, we have performed the opening operation (<tt>7x7</tt> rectangular structuring element) on the same original image but inverted such as the object in white is now the letter.
         </p>
         <p><img src="https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_Opening_2.png"></p>
         <p>(Left image: original image inverted, right image: resulting opening).</p>
         <h2 id="4">2) Closing</h2>
         <p>It is obtained by the dilation of an image followed by an erosion.</p>
         <p><img src="morphology_demo_gui2_eq01505959308847638699.png" alt="$$dst = close( src, element ) = erode( dilate( src, element ) )$$" class="equation" width="354" height="15"></p>
         <p>Useful to remove small holes (dark regions).</p>
         <p><img src="https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_Closing.png"></p>
         <p>On the inverted image, we have performed the closing operation (<tt>7x7</tt> rectangular structuring element):
         </p>
         <p><img src="https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_Closing_2.png"></p>
         <p>(Left image: original image inverted, right image: resulting closing).</p>
         <h2 id="5">3) Morphological Gradient</h2>
         <p>It is the difference between the dilation and the erosion of an image.</p>
         <p><img src="morphology_demo_gui2_eq05326918359754686341.png" alt="$$dst = morph_{grad}( src, element )&#xA;      = dilate( src, element ) - erode( src, element )$$" class="equation" width="484" height="16"></p>
         <p>It is useful for finding the outline of an object as can be seen below:</p>
         <p><img src="https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_Gradient.png"></p>
         <h2 id="6">4) Top Hat</h2>
         <p>It is the difference between an input image and its opening.</p>
         <p><img src="morphology_demo_gui2_eq08610246742025680223.png" alt="$$dst = tophat( src, element ) = src - open( src, element )$$" class="equation" width="348" height="15"></p>
         <p><img src="https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_TopHat.png"></p>
         <h2 id="7">5) Black Hat</h2>
         <p>It is the difference between the closing and its input image</p>
         <p><img src="morphology_demo_gui2_eq05735988128151618047.png" alt="$$dst = blackhat( src, element ) = close( src, element ) - src$$" class="equation" width="364" height="15"></p>
         <p><img src="https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_BlackHat.png"></p>
         <h2 id="8">References</h2>
         <div>
            <ul>
               <li>"Learning OpenCV" by Bradski and Kaehler.</li>
            </ul>
         </div><pre class="codeinput"><span class="keyword">function</span> varargout = morphology_demo_gui2(im)
    <span class="comment">% load source image</span>
    <span class="keyword">if</span> nargin &lt; 1
        src = imread(fullfile(mexopencv.root(),<span class="string">'test'</span>,<span class="string">'img001.jpg'</span>));
    <span class="keyword">elseif</span> ischar(im)
        src = imread(im);
    <span class="keyword">else</span>
        src = im;
    <span class="keyword">end</span>

    <span class="comment">% create the UI</span>
    h = buildGUI(src);
    <span class="keyword">if</span> nargout &gt; 0, varargout{1} = h; <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> onChange(~,~,h)
    <span class="comment">%ONCHANGE  Event handler for UI controls</span>

    <span class="comment">% retrieve current values from UI controls</span>
    ksize = round(get(h.slid, <span class="string">'Value'</span>));
    opIdx = get(h.pop(1), <span class="string">'Value'</span>);
    shapeIdx = get(h.pop(2), <span class="string">'Value'</span>);
    set(h.txt, <span class="string">'String'</span>,sprintf(<span class="string">'%2d'</span>,ksize));

    <span class="comment">% options (structuring element shape and morphological operation)</span>
    shapes = {<span class="string">'Rect'</span>, <span class="string">'Cross'</span>, <span class="string">'Ellipse'</span>};
    types = {<span class="string">'Erode'</span>, <span class="string">'Dilate'</span>, <span class="string">'Open'</span>, <span class="string">'Close'</span>, <span class="string">'Gradient'</span>, <span class="string">'Tophat'</span>, <span class="keyword">...</span>
        <span class="string">'Blackhat'</span>, <span class="string">''</span>};

    <span class="comment">% apply the specified morphology operation</span>
    elem = cv.getStructuringElement(<span class="string">'Shape'</span>,shapes{shapeIdx}, <span class="keyword">...</span>
        <span class="string">'KSize'</span>,[ksize ksize]*2+1, <span class="string">'Anchor'</span>,[ksize ksize]);
    <span class="keyword">if</span> ~isempty(types{opIdx})
        dst = cv.morphologyEx(h.src, types{opIdx}, <span class="string">'Element'</span>,elem);
    <span class="keyword">else</span>
        dst = h.src;
    <span class="keyword">end</span>

    <span class="comment">% show result</span>
    set(h.img, <span class="string">'CData'</span>,dst);
    drawnow;
<span class="keyword">end</span>

<span class="keyword">function</span> h = buildGUI(img)
    <span class="comment">%BUILDGUI  Creates the UI</span>

    <span class="comment">% parameters</span>
    ksize = 3;
    max_ksize = 21;
    sz = size(img);
    sz(2) = max(sz(2), 250);  <span class="comment">% minimum figure width</span>

    <span class="comment">% build the user interface (no resizing to keep it simple)</span>
    h = struct();
    h.src = img;
    h.fig = figure(<span class="string">'Name'</span>,<span class="string">'Morphology Transformations Demo'</span>, <span class="keyword">...</span>
        <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>, <span class="string">'Menubar'</span>,<span class="string">'none'</span>, <span class="string">'Resize'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[200 200 sz(2) sz(1)+29]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        <span class="comment">%HACK: not implemented in Octave</span>
        movegui(h.fig, <span class="string">'center'</span>);
    <span class="keyword">end</span>
    h.ax = axes(<span class="string">'Parent'</span>,h.fig, <span class="string">'Units'</span>,<span class="string">'pixels'</span>, <span class="string">'Position'</span>,[1 30 sz(2) sz(1)]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        h.img = imshow(img, <span class="string">'Parent'</span>,h.ax);
    <span class="keyword">else</span>
        <span class="comment">%HACK: https://savannah.gnu.org/bugs/index.php?45473</span>
        axes(h.ax);
        h.img = imshow(img);
    <span class="keyword">end</span>
    h.pop(1) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'popupmenu'</span>, <span class="keyword">...</span>
       <span class="string">'Position'</span>,[5 5 70 20], <span class="string">'Value'</span>,3, <span class="keyword">...</span>
       <span class="string">'String'</span>, {<span class="string">'Erosion'</span>,<span class="string">'Dilation'</span>,<span class="string">'Opening'</span>,<span class="string">'Closing'</span>,<span class="string">'Gradient'</span>,<span class="keyword">...</span>
            <span class="string">'Top Hat'</span>,<span class="string">'Black Hat'</span>,<span class="string">'-None-'</span>});
    h.pop(2) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'popupmenu'</span>, <span class="keyword">...</span>
       <span class="string">'Position'</span>,[75 5 70 20], <span class="string">'String'</span>,{<span class="string">'Rect'</span>,<span class="string">'Cross'</span>,<span class="string">'Ellipse'</span>});
    h.slid = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="string">'Value'</span>,ksize, <span class="keyword">...</span>
        <span class="string">'Min'</span>,1, <span class="string">'Max'</span>,max_ksize, <span class="string">'SliderStep'</span>,[1 5]./(max_ksize-1), <span class="keyword">...</span>
        <span class="string">'Position'</span>,[150 5 sz(2)-150-20-5 20]);
    h.txt = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="string">'FontSize'</span>,11, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[sz(2)-20-5 5 20 20], <span class="string">'String'</span>,num2str(ksize));

    <span class="comment">% hook event handlers, and trigger default start</span>
    set([h.slid, h.pop], <span class="string">'Callback'</span>,{@onChange,h}, <span class="keyword">...</span>
        <span class="string">'Interruptible'</span>,<span class="string">'off'</span>, <span class="string">'BusyAction'</span>,<span class="string">'cancel'</span>);
    onChange([],[],h);
<span class="keyword">end</span></pre><img src="morphology_demo_gui2_01.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div><script type="text/x-mathjax-config">
  // https://stackoverflow.com/a/14631703/97160
  MathJax.Extension.myImg2jax = {
    version: "1.0",
    PreProcess: function (element) {
      var images = element.getElementsByTagName("img");
      for (var i = images.length - 1; i >= 0; i--) {
        var img = images[i];
        if (img.className === "equation") {
          var match = img.alt.match(/^(\$\$?)([\s\S]*)\1$/m);
          if (!match) continue;
          var script = document.createElement("script");
          script.type = "math/tex";
          if (match[1] === "$$") {script.type += ";mode=display"}
          MathJax.HTML.setScript(script, match[2]);
          img.parentNode.replaceChild(script, img);
        }
      }
    }
  };
  MathJax.Hub.Register.PreProcessor(["PreProcess", MathJax.Extension.myImg2jax]);
  </script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML"></script>
      <!--
##### SOURCE BEGIN #####
%% Advanced Morphology Transformations Demo
%
% In this sample you will learn how to use the OpenCV function
% <matlab:doc('cv.morphologyEx') cv.morphologyEx> to apply
% Morphological Transformation such as:
%
% * Opening
% * Closing
% * Morphological Gradient
% * Top Hat
% * Black Hat
%
% Sources:
%
% * <https://docs.opencv.org/3.2.0/d3/dbe/tutorial_opening_closing_hats.html>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgProc/Morphology_2.cpp>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/morphology2.cpp>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/python/morphology.py>
%

%% Theory
%
% We previously covered two basic Morphology operations:
%
% * Erosion
% * Dilation
%
% Based on these two we can effectuate more sophisticated transformations to
% our images. Here we discuss briefly 5 operations offered by OpenCV.
%
%% 1) Opening
%
% It is obtained by the erosion of an image followed by a dilation.
%
% $$dst = open( src, element) = dilate( erode( src, element ) )$$
%
% Useful for removing small objects (it is assumed that the objects are bright
% on a dark foreground). For instance, check out the example below. The image
% at the left is the original and the image at the right is the result after
% applying the opening transformation. We can observe that the small spaces in
% the corners of the letter tend to dissapear.
%
% <<https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_Opening.png>>
%
% For the sake of clarity, we have performed the opening operation (|7x7|
% rectangular structuring element) on the same original image but inverted
% such as the object in white is now the letter.
%
% <<https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_Opening_2.png>>
%
% (Left image: original image inverted, right image: resulting opening).
%
%% 2) Closing
%
% It is obtained by the dilation of an image followed by an erosion.
%
% $$dst = close( src, element ) = erode( dilate( src, element ) )$$
%
% Useful to remove small holes (dark regions).
%
% <<https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_Closing.png>>
%
% On the inverted image, we have performed the closing operation (|7x7|
% rectangular structuring element):
%
% <<https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_Closing_2.png>>
%
% (Left image: original image inverted, right image: resulting closing).
%
%% 3) Morphological Gradient
%
% It is the difference between the dilation and the erosion of an image.
%
% $$dst = morph_{grad}( src, element )
%       = dilate( src, element ) - erode( src, element )$$
%
% It is useful for finding the outline of an object as can be seen below:
%
% <<https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_Gradient.png>>
%
%% 4) Top Hat
%
% It is the difference between an input image and its opening.
%
% $$dst = tophat( src, element ) = src - open( src, element )$$
%
% <<https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_TopHat.png>>
%
%% 5) Black Hat
%
% It is the difference between the closing and its input image
%
% $$dst = blackhat( src, element ) = close( src, element ) - src$$
%
% <<https://docs.opencv.org/3.2.0/Morphology_2_Tutorial_Theory_BlackHat.png>>
%
%% References
%
% * "Learning OpenCV" by Bradski and Kaehler.
%

function varargout = morphology_demo_gui2(im)
    % load source image
    if nargin < 1
        src = imread(fullfile(mexopencv.root(),'test','img001.jpg'));
    elseif ischar(im)
        src = imread(im);
    else
        src = im;
    end

    % create the UI
    h = buildGUI(src);
    if nargout > 0, varargout{1} = h; end
end

function onChange(~,~,h)
    %ONCHANGE  Event handler for UI controls

    % retrieve current values from UI controls
    ksize = round(get(h.slid, 'Value'));
    opIdx = get(h.pop(1), 'Value');
    shapeIdx = get(h.pop(2), 'Value');
    set(h.txt, 'String',sprintf('%2d',ksize));

    % options (structuring element shape and morphological operation)
    shapes = {'Rect', 'Cross', 'Ellipse'};
    types = {'Erode', 'Dilate', 'Open', 'Close', 'Gradient', 'Tophat', ...
        'Blackhat', ''};

    % apply the specified morphology operation
    elem = cv.getStructuringElement('Shape',shapes{shapeIdx}, ...
        'KSize',[ksize ksize]*2+1, 'Anchor',[ksize ksize]);
    if ~isempty(types{opIdx})
        dst = cv.morphologyEx(h.src, types{opIdx}, 'Element',elem);
    else
        dst = h.src;
    end

    % show result
    set(h.img, 'CData',dst);
    drawnow;
end

function h = buildGUI(img)
    %BUILDGUI  Creates the UI

    % parameters
    ksize = 3;
    max_ksize = 21;
    sz = size(img);
    sz(2) = max(sz(2), 250);  % minimum figure width

    % build the user interface (no resizing to keep it simple)
    h = struct();
    h.src = img;
    h.fig = figure('Name','Morphology Transformations Demo', ...
        'NumberTitle','off', 'Menubar','none', 'Resize','off', ...
        'Position',[200 200 sz(2) sz(1)+29]);
    if ~mexopencv.isOctave()
        %HACK: not implemented in Octave
        movegui(h.fig, 'center');
    end
    h.ax = axes('Parent',h.fig, 'Units','pixels', 'Position',[1 30 sz(2) sz(1)]);
    if ~mexopencv.isOctave()
        h.img = imshow(img, 'Parent',h.ax);
    else
        %HACK: https://savannah.gnu.org/bugs/index.php?45473
        axes(h.ax);
        h.img = imshow(img);
    end
    h.pop(1) = uicontrol('Parent',h.fig, 'Style','popupmenu', ...
       'Position',[5 5 70 20], 'Value',3, ...
       'String', {'Erosion','Dilation','Opening','Closing','Gradient',...
            'Top Hat','Black Hat','-None-'});
    h.pop(2) = uicontrol('Parent',h.fig, 'Style','popupmenu', ...
       'Position',[75 5 70 20], 'String',{'Rect','Cross','Ellipse'});
    h.slid = uicontrol('Parent',h.fig, 'Style','slider', 'Value',ksize, ...
        'Min',1, 'Max',max_ksize, 'SliderStep',[1 5]./(max_ksize-1), ...
        'Position',[150 5 sz(2)-150-20-5 20]);
    h.txt = uicontrol('Parent',h.fig, 'Style','text', 'FontSize',11, ...
        'Position',[sz(2)-20-5 5 20 20], 'String',num2str(ksize));

    % hook event handlers, and trigger default start
    set([h.slid, h.pop], 'Callback',{@onChange,h}, ...
        'Interruptible','off', 'BusyAction','cancel');
    onChange([],[],h);
end

##### SOURCE END #####
--></body>
</html>