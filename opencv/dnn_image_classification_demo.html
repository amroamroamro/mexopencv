<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>DNN Image Classification</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2018-02-20">
      <meta name="DC.source" content="dnn_image_classification_demo.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">DNN Image Classification</h1>
         <div>
            <ul>
               <li><a href="http://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks">AlexNet</a></li>
               <li><a href="https://arxiv.org/abs/1311.2901">ZFNet</a></li>
               <li><a href="https://arxiv.org/abs/1409.1556">VGGNet</a></li>
               <li><a href="https://arxiv.org/abs/1409.4842">GoogLeNet</a></li>
               <li><a href="https://arxiv.org/abs/1512.03385">ResNet</a></li>
               <li><a href="https://arxiv.org/abs/1602.07360">SqueezeNet</a></li>
               <li><a href="https://arxiv.org/abs/1704.04861">MobileNet</a></li>
            </ul>
         </div>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/caffe_googlenet.cpp">https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/caffe_googlenet.cpp</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/googlenet_python.py">https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/googlenet_python.py</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/tf_inception.cpp">https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/tf_inception.cpp</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/squeezenet_halide.cpp">https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/squeezenet_halide.cpp</a></li>
            </ul>
         </div><pre class="codeinput"><span class="keyword">function</span> dnn_image_classification_demo(im, name, crop)
    <span class="comment">% input image (BGR channel order)</span>
    <span class="keyword">if</span> nargin &lt; 1 || isempty(im)
        im = fullfile(mexopencv.root(), <span class="string">'test'</span>, <span class="string">'space_shuttle.jpg'</span>);
    <span class="keyword">end</span>
    img = cv.imread(im, <span class="string">'Color'</span>,true, <span class="string">'FlipChannels'</span>,false);

    <span class="comment">% import pretrained model</span>
    <span class="keyword">if</span> nargin &lt; 2, name = <span class="string">'GoogLeNet'</span>; <span class="keyword">end</span>
    fprintf(<span class="string">'Load model...   '</span>); tic;
    <span class="keyword">switch</span> lower(name)
        <span class="keyword">case</span> <span class="string">'alexnet'</span>
            <span class="comment">% ImageNet ILSVRC 2012</span>
            [net, labels, blobOpts] = AlexNet();
        <span class="keyword">case</span> <span class="string">'caffenet'</span>
            <span class="comment">% ImageNet ILSVRC 2012</span>
            [net, labels, blobOpts] = CaffeNet();
        <span class="keyword">case</span> <span class="string">'vggnet'</span>
            <span class="comment">% ImageNet ILSVRC 2012</span>
            [net, labels, blobOpts] = VGGNet();
        <span class="keyword">case</span> <span class="string">'inception'</span>
            <span class="comment">% ImageNet ILSVRC 2012</span>
            [net, labels, blobOpts] = Inception();
        <span class="keyword">case</span> <span class="string">'googlenet'</span>
            <span class="comment">% ImageNet ILSVRC 2012</span>
            [net, labels, blobOpts] = GoogLeNet();
        <span class="keyword">case</span> <span class="string">'resnet'</span>
            <span class="comment">% ImageNet ILSVRC 2012</span>
            [net, labels, blobOpts] = ResNet();
        <span class="keyword">case</span> <span class="string">'squeezenet'</span>
            <span class="comment">% ImageNet ILSVRC 2012</span>
            [net, labels, blobOpts] = SqueezeNet(<span class="string">'v1.1'</span>);
        <span class="keyword">otherwise</span>
            error(<span class="string">'Unrecognized model %s'</span>, name)
    <span class="keyword">end</span>
    toc;
    assert(~net.empty(), <span class="string">'Failed to read network %s'</span>, name);

    <span class="comment">% feed image to network</span>
    <span class="keyword">if</span> nargin &lt; 3, crop = true; <span class="keyword">end</span>
    blobOpts = [<span class="string">'Crop'</span>,crop, blobOpts];
    blob = cv.Net.blobFromImages(img, blobOpts{:});
    net.setInput(blob);

    <span class="comment">% run forward pass</span>
    fprintf(<span class="string">'Forward pass... '</span>); tic;
    prob = net.forward();  <span class="comment">% 1-by-nclasses-by-1-by-1</span>
    toc;

    <span class="comment">% prepare output image</span>
    out = flip(img, 3);  <span class="comment">% BGR to RGB</span>

    <span class="comment">% prediction: image classification and top-5 predictions</span>
    [~,ord] = sort(prob, <span class="string">'descend'</span>);
    disp(<span class="string">'Top-5 predictions:'</span>)
    <span class="keyword">for</span> i=1:5
        fprintf(<span class="string">'%6.2f%% = %s\n'</span>, prob(ord(i))*100, labels{ord(i)});
    <span class="keyword">end</span>
    imshow(out), title(<span class="string">'Image Classification'</span>)
    xlabel(labels{ord(1)})
<span class="keyword">end</span>

<span class="comment">% --- Helper functions ---</span>

<span class="keyword">function</span> dname = get_dnn_dir(dname)
    <span class="comment">%GET_DNN_DIR  Path to model files, and show where to get them if missing</span>

    dname = fullfile(mexopencv.root(), <span class="string">'test'</span>, <span class="string">'dnn'</span>, dname);
    b = isdir(dname);
    <span class="keyword">if</span> ~b
        <span class="comment">% display help of calling function</span>
        <span class="comment">% (assumed to be a local function in current file)</span>
        st = dbstack(1);
        help([mfilename() filemarker() st(1).name])
    <span class="keyword">end</span>
    assert(b, <span class="string">'Missing model: %s'</span>, dname);
<span class="keyword">end</span>

<span class="keyword">function</span> labels = readLabels(labelsFile, skipFirstWord)
    <span class="keyword">if</span> nargin &lt; 2, skipFirstWord = false; <span class="keyword">end</span>
    <span class="keyword">if</span> ~mexopencv.isOctave()
        fid = fopen(labelsFile, <span class="string">'rt'</span>);
        C = textscan(fid, <span class="string">'%s'</span>, <span class="string">'Delimiter'</span>,<span class="string">'\n'</span>);
        fclose(fid);
        labels = C{1};
    <span class="keyword">else</span>
        <span class="comment">%HACK: textscan is buggy and unreliable in Octave!</span>
        labels = textread(labelsFile, <span class="string">'%s'</span>, <span class="string">'Delimiter'</span>,<span class="string">'\n'</span>);
    <span class="keyword">end</span>
    <span class="keyword">if</span> skipFirstWord
        labels = regexprep(labels, <span class="string">'^\w+\s*'</span>, <span class="string">''</span>, <span class="string">'once'</span>);
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">% --- Pretrained models ---</span>
<span class="comment">% See also: https://github.com/opencv/opencv_extra/blob/3.3.1/testdata/dnn/download_models.py</span>

<span class="keyword">function</span> [net, labels, blobOpts] = AlexNet()
    <span class="comment">%ALEXNET  BAIR/BVLC AlexNet Model [Caffe]</span>
    <span class="comment">%</span>
    <span class="comment">% homepage = https://github.com/BVLC/caffe/tree/master/models/bvlc_alexnet</span>
    <span class="comment">%</span>
    <span class="comment">% ## Model</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/AlexNet/deploy.prototxt</span>
    <span class="comment">% url  = https://github.com/BVLC/caffe/raw/master/models/bvlc_alexnet/deploy.prototxt</span>
    <span class="comment">% hash = cb77655eb4db32c9c47699c6050926f9e0fc476a</span>
    <span class="comment">%</span>
    <span class="comment">% ## Weights</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/AlexNet/bvlc_alexnet.caffemodel</span>
    <span class="comment">% url  = http://dl.caffe.berkeleyvision.org/bvlc_alexnet.caffemodel</span>
    <span class="comment">% hash = 9116a64c0fbe4459d18f4bb6b56d647b63920377</span>
    <span class="comment">% size = 232 MB</span>
    <span class="comment">%</span>
    <span class="comment">% ## Classes</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/AlexNet/synset_words.txt</span>
    <span class="comment">% url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt</span>
    <span class="comment">%</span>

    dname = get_dnn_dir(<span class="string">'AlexNet'</span>);
    net = cv.Net(<span class="string">'Caffe'</span>, <span class="keyword">...</span>
        fullfile(dname, <span class="string">'deploy.prototxt'</span>), <span class="keyword">...</span>
        fullfile(dname, <span class="string">'bvlc_alexnet.caffemodel'</span>));
    labels = readLabels(fullfile(dname, <span class="string">'synset_words.txt'</span>), true);
    blobOpts = {<span class="string">'SwapRB'</span>,false, <span class="string">'Size'</span>,[227 227], <span class="string">'Mean'</span>,[104 117 123]};
<span class="keyword">end</span>

<span class="keyword">function</span> [net, labels, blobOpts] = CaffeNet()
    <span class="comment">%CAFFENET  BAIR/BVLC CaffeNet Model, a replication of AlexNet with some modification [Caffe]</span>
    <span class="comment">%</span>
    <span class="comment">% homepage = https://github.com/BVLC/caffe/tree/master/models/bvlc_reference_caffenet</span>
    <span class="comment">%</span>
    <span class="comment">% ## Model</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/CaffeNet/deploy.prototxt</span>
    <span class="comment">% url  = https://github.com/BVLC/caffe/raw/master/models/bvlc_reference_caffenet/deploy.prototxt</span>
    <span class="comment">% hash = 6a40fd8b77233afee8fd525ce59bb4ccaae78d58</span>
    <span class="comment">%</span>
    <span class="comment">% ## Weights</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/CaffeNet/bvlc_reference_caffenet.caffemodel</span>
    <span class="comment">% url  = http://dl.caffe.berkeleyvision.org/bvlc_reference_caffenet.caffemodel</span>
    <span class="comment">% hash = 4c8d77deb20ea792f84eb5e6d0a11ca0a8660a46</span>
    <span class="comment">% size = 232 MB</span>
    <span class="comment">%</span>
    <span class="comment">% ## Classes</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/CaffeNet/synset_words.txt</span>
    <span class="comment">% url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt</span>
    <span class="comment">%</span>

    dname = get_dnn_dir(<span class="string">'CaffeNet'</span>);
    net = cv.Net(<span class="string">'Caffe'</span>, <span class="keyword">...</span>
        fullfile(dname, <span class="string">'deploy.prototxt'</span>), <span class="keyword">...</span>
        fullfile(dname, <span class="string">'bvlc_reference_caffenet.caffemodel'</span>));
    labels = readLabels(fullfile(dname, <span class="string">'synset_words.txt'</span>), true);
    blobOpts = {<span class="string">'SwapRB'</span>,false, <span class="string">'Size'</span>,[227 227], <span class="string">'Mean'</span>,[104 117 123]};
<span class="keyword">end</span>

<span class="keyword">function</span> [net, labels, blobOpts] = VGGNet()
    <span class="comment">%VGGNET  VGG team ILSVRC-2014 16-layer model [Caffe]</span>
    <span class="comment">%</span>
    <span class="comment">% homepage = http://www.robots.ox.ac.uk/~vgg/research/very_deep/</span>
    <span class="comment">%</span>
    <span class="comment">% ## Model</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/VGGNet/VGG_ILSVRC_16_layers_deploy.prototxt</span>
    <span class="comment">% url  = https://gist.githubusercontent.com/ksimonyan/211839e770f7b538e2d8/raw/0067c9b32f60362c74f4c445a080beed06b07eb3/VGG_ILSVRC_16_layers_deploy.prototxt</span>
    <span class="comment">% hash = 2734e5500f1445bd7c9fee540c99f522485247bd</span>
    <span class="comment">%</span>
    <span class="comment">% ## Weights</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/VGGNet/VGG_ILSVRC_16_layers.caffemodel</span>
    <span class="comment">% url  = http://www.robots.ox.ac.uk/~vgg/software/very_deep/caffe/VGG_ILSVRC_16_layers.caffemodel</span>
    <span class="comment">% hash = 9363e1f6d65f7dba68c4f27a1e62105cdf6c4e24</span>
    <span class="comment">% size = 527 MB</span>
    <span class="comment">%</span>
    <span class="comment">% ## Classes</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/VGGNet/synset_words.txt</span>
    <span class="comment">% url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt</span>
    <span class="comment">%</span>

    dname = get_dnn_dir(<span class="string">'VGGNet'</span>);
    net = cv.Net(<span class="string">'Caffe'</span>, <span class="keyword">...</span>
        fullfile(dname, <span class="string">'VGG_ILSVRC_16_layers_deploy.prototxt'</span>), <span class="keyword">...</span>
        fullfile(dname, <span class="string">'VGG_ILSVRC_16_layers.caffemodel'</span>));
    labels = readLabels(fullfile(dname, <span class="string">'synset_words.txt'</span>), true);
    blobOpts = {<span class="string">'SwapRB'</span>,false, <span class="string">'Size'</span>,[224 224], <span class="string">'Mean'</span>,[103.939 116.779 123.68]};
<span class="keyword">end</span>

<span class="keyword">function</span> [net, labels, blobOpts] = Inception()
    <span class="comment">%INCEPTION  Google Inception V1 model [TensorFlow]</span>
    <span class="comment">%</span>
    <span class="comment">% homepage = https://github.com/tensorflow/tensorflow</span>
    <span class="comment">%</span>
    <span class="comment">% ## Model + Weights + Classes</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/Inception/tensorflow_inception_graph.pb</span>
    <span class="comment">% file = test/dnn/Inception/imagenet_comp_graph_label_strings.txt</span>
    <span class="comment">% url  = https://storage.googleapis.com/download.tensorflow.org/models/inception5h.zip</span>
    <span class="comment">% hash = e3b84c7e240ce8025b30d868f5e840b4bba9761d</span>
    <span class="comment">% size = 47.6 MB</span>
    <span class="comment">%</span>

    dname = get_dnn_dir(<span class="string">'Inception'</span>);
    net = cv.Net(<span class="string">'Tensorflow'</span>, <span class="keyword">...</span>
        fullfile(dname, <span class="string">'tensorflow_inception_graph.pb'</span>));
    labels = readLabels(fullfile(dname, <span class="string">'imagenet_comp_graph_label_strings.txt'</span>), false);
    blobOpts = {<span class="string">'SwapRB'</span>,true, <span class="string">'Size'</span>,[224 224], <span class="string">'Mean'</span>,[117 117 117]};
<span class="keyword">end</span>

<span class="keyword">function</span> [net, labels, blobOpts] = GoogLeNet()
    <span class="comment">%GOOGLENET  BAIR/BVLC GoogleNet Model, a Caffe implementation of Inception model [Caffe]</span>
    <span class="comment">%</span>
    <span class="comment">% homepage = https://github.com/BVLC/caffe/tree/master/models/bvlc_googlenet</span>
    <span class="comment">%</span>
    <span class="comment">% ## Model</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/GoogLeNet/deploy.prototxt</span>
    <span class="comment">% url  = https://github.com/BVLC/caffe/raw/master/models/bvlc_googlenet/deploy.prototxt</span>
    <span class="comment">% hash = 7060345c8012294baa60eeb5901d2d3fd89d75fc</span>
    <span class="comment">%</span>
    <span class="comment">% ## Weights</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/GoogLeNet/bvlc_googlenet.caffemodel</span>
    <span class="comment">% url  = http://dl.caffe.berkeleyvision.org/bvlc_googlenet.caffemodel</span>
    <span class="comment">% hash = 405fc5acd08a3bb12de8ee5e23a96bec22f08204</span>
    <span class="comment">% size = 51 MB</span>
    <span class="comment">%</span>
    <span class="comment">% ## Classes</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/GoogLeNet/synset_words.txt</span>
    <span class="comment">% url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt</span>
    <span class="comment">%</span>

    dname = get_dnn_dir(<span class="string">'GoogLeNet'</span>);
    net = cv.Net(<span class="string">'Caffe'</span>, <span class="keyword">...</span>
        fullfile(dname, <span class="string">'deploy.prototxt'</span>), <span class="keyword">...</span>
        fullfile(dname, <span class="string">'bvlc_googlenet.caffemodel'</span>));
    labels = readLabels(fullfile(dname, <span class="string">'synset_words.txt'</span>), true);
    blobOpts = {<span class="string">'SwapRB'</span>,false, <span class="string">'Size'</span>,[224 224], <span class="string">'Mean'</span>,[104 117 123]};
<span class="keyword">end</span>

<span class="keyword">function</span> [net, labels, blobOpts] = ResNet()
    <span class="comment">%RESNET  Deep Residual Networks, ResNet-50 [Caffe]</span>
    <span class="comment">%</span>
    <span class="comment">% homepage = https://github.com/KaimingHe/deep-residual-networks</span>
    <span class="comment">%</span>
    <span class="comment">% ## Model</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/ResNet/ResNet-50-deploy.prototxt</span>
    <span class="comment">% url  = https://onedrive.live.com/?authkey=%21AAFW2-FVoxeVRck&amp;id=4006CBB8476FF777%2117887&amp;cid=4006CBB8476FF777</span>
    <span class="comment">% hash = 5d6fd5aeadd8d4684843c5028b4e5672b9e51638</span>
    <span class="comment">%</span>
    <span class="comment">% ## Weights</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/ResNet/ResNet-50-model.caffemodel</span>
    <span class="comment">% url  = https://onedrive.live.com/?authkey=%21AAFW2-FVoxeVRck&amp;id=4006CBB8476FF777%2117887&amp;cid=4006CBB8476FF777</span>
    <span class="comment">% hash = b7c79ccc21ad0479cddc0dd78b1d20c4d722908d</span>
    <span class="comment">% size = 97.7 MB</span>
    <span class="comment">%</span>
    <span class="comment">% ## Classes</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/ResNet/synset_words.txt</span>
    <span class="comment">% url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt</span>
    <span class="comment">%</span>

    dname = get_dnn_dir(<span class="string">'ResNet'</span>);
    net = cv.Net(<span class="string">'Caffe'</span>, <span class="keyword">...</span>
        fullfile(dname, <span class="string">'ResNet-50-deploy.prototxt'</span>), <span class="keyword">...</span>
        fullfile(dname, <span class="string">'ResNet-50-model.caffemodel'</span>));
    labels = readLabels(fullfile(dname, <span class="string">'synset_words.txt'</span>), true);
    blobOpts = {<span class="string">'SwapRB'</span>,false, <span class="string">'Size'</span>,[224 224], <span class="string">'Mean'</span>,[104 117 123]};
    <span class="comment">%TODO: mean image from ResNet_mean.binaryproto</span>
<span class="keyword">end</span>

<span class="keyword">function</span> [net, labels, blobOpts] = SqueezeNet(v)
    <span class="comment">%SQUEEZENET  SqueezeNet [Caffe]</span>
    <span class="comment">%</span>
    <span class="comment">% homepage = https://github.com/DeepScale/SqueezeNet</span>
    <span class="comment">%</span>
    <span class="comment">% # SqueezeNet v1.0</span>
    <span class="comment">%</span>
    <span class="comment">% ## Model</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/SqueezeNet/v1.0/deploy.prototxt</span>
    <span class="comment">% url  = https://github.com/DeepScale/SqueezeNet/raw/master/SqueezeNet_v1.0/deploy.prototxt</span>
    <span class="comment">% hash = 733249be856b9cd28ce929cd7c41874cf817c3c6</span>
    <span class="comment">%</span>
    <span class="comment">% ## Weights</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/SqueezeNet/v1.0/squeezenet_v1.0.caffemodel</span>
    <span class="comment">% url  = https://github.com/DeepScale/SqueezeNet/raw/master/SqueezeNet_v1.0/squeezenet_v1.0.caffemodel</span>
    <span class="comment">% hash = 579d0beb658e43c45937bf8bb5e4034fea4e1f69</span>
    <span class="comment">% size = 4.76 MB</span>
    <span class="comment">%</span>
    <span class="comment">% # SqueezeNet v1.1</span>
    <span class="comment">%</span>
    <span class="comment">% ## Model</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/SqueezeNet/v1.1/deploy.prototxt</span>
    <span class="comment">% url  = https://github.com/DeepScale/SqueezeNet/raw/master/SqueezeNet_v1.1/deploy.prototxt</span>
    <span class="comment">% hash = c226bbaaa4d83e2a3d3727618091e897e5f2e3aa</span>
    <span class="comment">%</span>
    <span class="comment">% ## Weights</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/SqueezeNet/v1.1/squeezenet_v1.1.caffemodel</span>
    <span class="comment">% url  = https://github.com/DeepScale/SqueezeNet/raw/master/SqueezeNet_v1.1/squeezenet_v1.1.caffemodel</span>
    <span class="comment">% hash = 3397f026368a45ae236403ccc81cfcbe8ebe1bd0</span>
    <span class="comment">% size = 4.72 MB</span>
    <span class="comment">%</span>
    <span class="comment">% # Classes</span>
    <span class="comment">%</span>
    <span class="comment">% file = test/dnn/SqueezeNet/v1.x/synset_words.txt</span>
    <span class="comment">% url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt</span>
    <span class="comment">%</span>

    v = validatestring(v, {<span class="string">'v1.1'</span>, <span class="string">'v1.0'</span>});
    dname = get_dnn_dir(fullfile(<span class="string">'SqueezeNet'</span>, v));
    <span class="keyword">if</span> strcmp(v, <span class="string">'v1.1'</span>)
        net = cv.Net(<span class="string">'Caffe'</span>, <span class="keyword">...</span>
            fullfile(dname, <span class="string">'deploy.prototxt'</span>), <span class="keyword">...</span>
            fullfile(dname, <span class="string">'squeezenet_v1.1.caffemodel'</span>));
    <span class="keyword">else</span>
        net = cv.Net(<span class="string">'Caffe'</span>, <span class="keyword">...</span>
            fullfile(dname, <span class="string">'deploy.prototxt'</span>), <span class="keyword">...</span>
            fullfile(dname, <span class="string">'squeezenet_v1.0.caffemodel'</span>));
    <span class="keyword">end</span>
    labels = readLabels(fullfile(dname, <span class="string">'synset_words.txt'</span>), true);
    blobOpts = {<span class="string">'SwapRB'</span>,false, <span class="string">'Size'</span>,[227 227], <span class="string">'Mean'</span>,[104 117 123]};
<span class="keyword">end</span></pre><pre class="codeoutput">Load model...   Elapsed time is 0.197234 seconds.
Forward pass... Elapsed time is 0.113284 seconds.
Top-5 predictions:
 99.99% = space shuttle
  0.00% = airliner
  0.00% = submarine, pigboat, sub, U-boat
  0.00% = bullet train, bullet
  0.00% = missile
</pre><img src="dnn_image_classification_demo_01.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% DNN Image Classification
%
% * <http://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks AlexNet>
% * <https://arxiv.org/abs/1311.2901 ZFNet>
% * <https://arxiv.org/abs/1409.1556 VGGNet>
% * <https://arxiv.org/abs/1409.4842 GoogLeNet>
% * <https://arxiv.org/abs/1512.03385 ResNet>
% * <https://arxiv.org/abs/1602.07360 SqueezeNet>
% * <https://arxiv.org/abs/1704.04861 MobileNet>
%
% Sources:
%
% * <https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/caffe_googlenet.cpp>
% * <https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/googlenet_python.py>
% * <https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/tf_inception.cpp>
% * <https://github.com/opencv/opencv/blob/3.4.0/samples/dnn/squeezenet_halide.cpp>
%

function dnn_image_classification_demo(im, name, crop)
    % input image (BGR channel order)
    if nargin < 1 || isempty(im)
        im = fullfile(mexopencv.root(), 'test', 'space_shuttle.jpg');
    end
    img = cv.imread(im, 'Color',true, 'FlipChannels',false);

    % import pretrained model
    if nargin < 2, name = 'GoogLeNet'; end
    fprintf('Load model...   '); tic;
    switch lower(name)
        case 'alexnet'
            % ImageNet ILSVRC 2012
            [net, labels, blobOpts] = AlexNet();
        case 'caffenet'
            % ImageNet ILSVRC 2012
            [net, labels, blobOpts] = CaffeNet();
        case 'vggnet'
            % ImageNet ILSVRC 2012
            [net, labels, blobOpts] = VGGNet();
        case 'inception'
            % ImageNet ILSVRC 2012
            [net, labels, blobOpts] = Inception();
        case 'googlenet'
            % ImageNet ILSVRC 2012
            [net, labels, blobOpts] = GoogLeNet();
        case 'resnet'
            % ImageNet ILSVRC 2012
            [net, labels, blobOpts] = ResNet();
        case 'squeezenet'
            % ImageNet ILSVRC 2012
            [net, labels, blobOpts] = SqueezeNet('v1.1');
        otherwise
            error('Unrecognized model %s', name)
    end
    toc;
    assert(~net.empty(), 'Failed to read network %s', name);

    % feed image to network
    if nargin < 3, crop = true; end
    blobOpts = ['Crop',crop, blobOpts];
    blob = cv.Net.blobFromImages(img, blobOpts{:});
    net.setInput(blob);

    % run forward pass
    fprintf('Forward pass... '); tic;
    prob = net.forward();  % 1-by-nclasses-by-1-by-1
    toc;

    % prepare output image
    out = flip(img, 3);  % BGR to RGB

    % prediction: image classification and top-5 predictions
    [~,ord] = sort(prob, 'descend');
    disp('Top-5 predictions:')
    for i=1:5
        fprintf('%6.2f%% = %s\n', prob(ord(i))*100, labels{ord(i)});
    end
    imshow(out), title('Image Classification')
    xlabel(labels{ord(1)})
end

% REPLACE_WITH_DASH_DASH- Helper functions REPLACE_WITH_DASH_DASH-

function dname = get_dnn_dir(dname)
    %GET_DNN_DIR  Path to model files, and show where to get them if missing

    dname = fullfile(mexopencv.root(), 'test', 'dnn', dname);
    b = isdir(dname);
    if ~b
        % display help of calling function
        % (assumed to be a local function in current file)
        st = dbstack(1);
        help([mfilename() filemarker() st(1).name])
    end
    assert(b, 'Missing model: %s', dname);
end

function labels = readLabels(labelsFile, skipFirstWord)
    if nargin < 2, skipFirstWord = false; end
    if ~mexopencv.isOctave()
        fid = fopen(labelsFile, 'rt');
        C = textscan(fid, '%s', 'Delimiter','\n');
        fclose(fid);
        labels = C{1};
    else
        %HACK: textscan is buggy and unreliable in Octave!
        labels = textread(labelsFile, '%s', 'Delimiter','\n');
    end
    if skipFirstWord
        labels = regexprep(labels, '^\w+\s*', '', 'once');
    end
end

% REPLACE_WITH_DASH_DASH- Pretrained models REPLACE_WITH_DASH_DASH-
% See also: https://github.com/opencv/opencv_extra/blob/3.3.1/testdata/dnn/download_models.py

function [net, labels, blobOpts] = AlexNet()
    %ALEXNET  BAIR/BVLC AlexNet Model [Caffe]
    %
    % homepage = https://github.com/BVLC/caffe/tree/master/models/bvlc_alexnet
    %
    % ## Model
    %
    % file = test/dnn/AlexNet/deploy.prototxt
    % url  = https://github.com/BVLC/caffe/raw/master/models/bvlc_alexnet/deploy.prototxt
    % hash = cb77655eb4db32c9c47699c6050926f9e0fc476a
    %
    % ## Weights
    %
    % file = test/dnn/AlexNet/bvlc_alexnet.caffemodel
    % url  = http://dl.caffe.berkeleyvision.org/bvlc_alexnet.caffemodel
    % hash = 9116a64c0fbe4459d18f4bb6b56d647b63920377
    % size = 232 MB
    %
    % ## Classes
    %
    % file = test/dnn/AlexNet/synset_words.txt
    % url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt
    %

    dname = get_dnn_dir('AlexNet');
    net = cv.Net('Caffe', ...
        fullfile(dname, 'deploy.prototxt'), ...
        fullfile(dname, 'bvlc_alexnet.caffemodel'));
    labels = readLabels(fullfile(dname, 'synset_words.txt'), true);
    blobOpts = {'SwapRB',false, 'Size',[227 227], 'Mean',[104 117 123]};
end

function [net, labels, blobOpts] = CaffeNet()
    %CAFFENET  BAIR/BVLC CaffeNet Model, a replication of AlexNet with some modification [Caffe]
    %
    % homepage = https://github.com/BVLC/caffe/tree/master/models/bvlc_reference_caffenet
    %
    % ## Model
    %
    % file = test/dnn/CaffeNet/deploy.prototxt
    % url  = https://github.com/BVLC/caffe/raw/master/models/bvlc_reference_caffenet/deploy.prototxt
    % hash = 6a40fd8b77233afee8fd525ce59bb4ccaae78d58
    %
    % ## Weights
    %
    % file = test/dnn/CaffeNet/bvlc_reference_caffenet.caffemodel
    % url  = http://dl.caffe.berkeleyvision.org/bvlc_reference_caffenet.caffemodel
    % hash = 4c8d77deb20ea792f84eb5e6d0a11ca0a8660a46
    % size = 232 MB
    %
    % ## Classes
    %
    % file = test/dnn/CaffeNet/synset_words.txt
    % url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt
    %

    dname = get_dnn_dir('CaffeNet');
    net = cv.Net('Caffe', ...
        fullfile(dname, 'deploy.prototxt'), ...
        fullfile(dname, 'bvlc_reference_caffenet.caffemodel'));
    labels = readLabels(fullfile(dname, 'synset_words.txt'), true);
    blobOpts = {'SwapRB',false, 'Size',[227 227], 'Mean',[104 117 123]};
end

function [net, labels, blobOpts] = VGGNet()
    %VGGNET  VGG team ILSVRC-2014 16-layer model [Caffe]
    %
    % homepage = http://www.robots.ox.ac.uk/~vgg/research/very_deep/
    %
    % ## Model
    %
    % file = test/dnn/VGGNet/VGG_ILSVRC_16_layers_deploy.prototxt
    % url  = https://gist.githubusercontent.com/ksimonyan/211839e770f7b538e2d8/raw/0067c9b32f60362c74f4c445a080beed06b07eb3/VGG_ILSVRC_16_layers_deploy.prototxt
    % hash = 2734e5500f1445bd7c9fee540c99f522485247bd
    %
    % ## Weights
    %
    % file = test/dnn/VGGNet/VGG_ILSVRC_16_layers.caffemodel
    % url  = http://www.robots.ox.ac.uk/~vgg/software/very_deep/caffe/VGG_ILSVRC_16_layers.caffemodel
    % hash = 9363e1f6d65f7dba68c4f27a1e62105cdf6c4e24
    % size = 527 MB
    %
    % ## Classes
    %
    % file = test/dnn/VGGNet/synset_words.txt
    % url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt
    %

    dname = get_dnn_dir('VGGNet');
    net = cv.Net('Caffe', ...
        fullfile(dname, 'VGG_ILSVRC_16_layers_deploy.prototxt'), ...
        fullfile(dname, 'VGG_ILSVRC_16_layers.caffemodel'));
    labels = readLabels(fullfile(dname, 'synset_words.txt'), true);
    blobOpts = {'SwapRB',false, 'Size',[224 224], 'Mean',[103.939 116.779 123.68]};
end

function [net, labels, blobOpts] = Inception()
    %INCEPTION  Google Inception V1 model [TensorFlow]
    %
    % homepage = https://github.com/tensorflow/tensorflow
    %
    % ## Model + Weights + Classes
    %
    % file = test/dnn/Inception/tensorflow_inception_graph.pb
    % file = test/dnn/Inception/imagenet_comp_graph_label_strings.txt
    % url  = https://storage.googleapis.com/download.tensorflow.org/models/inception5h.zip
    % hash = e3b84c7e240ce8025b30d868f5e840b4bba9761d
    % size = 47.6 MB
    %

    dname = get_dnn_dir('Inception');
    net = cv.Net('Tensorflow', ...
        fullfile(dname, 'tensorflow_inception_graph.pb'));
    labels = readLabels(fullfile(dname, 'imagenet_comp_graph_label_strings.txt'), false);
    blobOpts = {'SwapRB',true, 'Size',[224 224], 'Mean',[117 117 117]};
end

function [net, labels, blobOpts] = GoogLeNet()
    %GOOGLENET  BAIR/BVLC GoogleNet Model, a Caffe implementation of Inception model [Caffe]
    %
    % homepage = https://github.com/BVLC/caffe/tree/master/models/bvlc_googlenet
    %
    % ## Model
    %
    % file = test/dnn/GoogLeNet/deploy.prototxt
    % url  = https://github.com/BVLC/caffe/raw/master/models/bvlc_googlenet/deploy.prototxt
    % hash = 7060345c8012294baa60eeb5901d2d3fd89d75fc
    %
    % ## Weights
    %
    % file = test/dnn/GoogLeNet/bvlc_googlenet.caffemodel
    % url  = http://dl.caffe.berkeleyvision.org/bvlc_googlenet.caffemodel
    % hash = 405fc5acd08a3bb12de8ee5e23a96bec22f08204
    % size = 51 MB
    %
    % ## Classes
    %
    % file = test/dnn/GoogLeNet/synset_words.txt
    % url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt
    %

    dname = get_dnn_dir('GoogLeNet');
    net = cv.Net('Caffe', ...
        fullfile(dname, 'deploy.prototxt'), ...
        fullfile(dname, 'bvlc_googlenet.caffemodel'));
    labels = readLabels(fullfile(dname, 'synset_words.txt'), true);
    blobOpts = {'SwapRB',false, 'Size',[224 224], 'Mean',[104 117 123]};
end

function [net, labels, blobOpts] = ResNet()
    %RESNET  Deep Residual Networks, ResNet-50 [Caffe]
    %
    % homepage = https://github.com/KaimingHe/deep-residual-networks
    %
    % ## Model
    %
    % file = test/dnn/ResNet/ResNet-50-deploy.prototxt
    % url  = https://onedrive.live.com/?authkey=%21AAFW2-FVoxeVRck&id=4006CBB8476FF777%2117887&cid=4006CBB8476FF777
    % hash = 5d6fd5aeadd8d4684843c5028b4e5672b9e51638
    %
    % ## Weights
    %
    % file = test/dnn/ResNet/ResNet-50-model.caffemodel
    % url  = https://onedrive.live.com/?authkey=%21AAFW2-FVoxeVRck&id=4006CBB8476FF777%2117887&cid=4006CBB8476FF777
    % hash = b7c79ccc21ad0479cddc0dd78b1d20c4d722908d
    % size = 97.7 MB
    %
    % ## Classes
    %
    % file = test/dnn/ResNet/synset_words.txt
    % url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt
    %

    dname = get_dnn_dir('ResNet');
    net = cv.Net('Caffe', ...
        fullfile(dname, 'ResNet-50-deploy.prototxt'), ...
        fullfile(dname, 'ResNet-50-model.caffemodel'));
    labels = readLabels(fullfile(dname, 'synset_words.txt'), true);
    blobOpts = {'SwapRB',false, 'Size',[224 224], 'Mean',[104 117 123]};
    %TODO: mean image from ResNet_mean.binaryproto
end

function [net, labels, blobOpts] = SqueezeNet(v)
    %SQUEEZENET  SqueezeNet [Caffe]
    %
    % homepage = https://github.com/DeepScale/SqueezeNet
    %
    % # SqueezeNet v1.0
    %
    % ## Model
    %
    % file = test/dnn/SqueezeNet/v1.0/deploy.prototxt
    % url  = https://github.com/DeepScale/SqueezeNet/raw/master/SqueezeNet_v1.0/deploy.prototxt
    % hash = 733249be856b9cd28ce929cd7c41874cf817c3c6
    %
    % ## Weights
    %
    % file = test/dnn/SqueezeNet/v1.0/squeezenet_v1.0.caffemodel
    % url  = https://github.com/DeepScale/SqueezeNet/raw/master/SqueezeNet_v1.0/squeezenet_v1.0.caffemodel
    % hash = 579d0beb658e43c45937bf8bb5e4034fea4e1f69
    % size = 4.76 MB
    %
    % # SqueezeNet v1.1
    %
    % ## Model
    %
    % file = test/dnn/SqueezeNet/v1.1/deploy.prototxt
    % url  = https://github.com/DeepScale/SqueezeNet/raw/master/SqueezeNet_v1.1/deploy.prototxt
    % hash = c226bbaaa4d83e2a3d3727618091e897e5f2e3aa
    %
    % ## Weights
    %
    % file = test/dnn/SqueezeNet/v1.1/squeezenet_v1.1.caffemodel
    % url  = https://github.com/DeepScale/SqueezeNet/raw/master/SqueezeNet_v1.1/squeezenet_v1.1.caffemodel
    % hash = 3397f026368a45ae236403ccc81cfcbe8ebe1bd0
    % size = 4.72 MB
    %
    % # Classes
    %
    % file = test/dnn/SqueezeNet/v1.x/synset_words.txt
    % url  = https://github.com/opencv/opencv/raw/3.3.1/samples/data/dnn/synset_words.txt
    %

    v = validatestring(v, {'v1.1', 'v1.0'});
    dname = get_dnn_dir(fullfile('SqueezeNet', v));
    if strcmp(v, 'v1.1')
        net = cv.Net('Caffe', ...
            fullfile(dname, 'deploy.prototxt'), ...
            fullfile(dname, 'squeezenet_v1.1.caffemodel'));
    else
        net = cv.Net('Caffe', ...
            fullfile(dname, 'deploy.prototxt'), ...
            fullfile(dname, 'squeezenet_v1.0.caffemodel'));
    end
    labels = readLabels(fullfile(dname, 'synset_words.txt'), true);
    blobOpts = {'SwapRB',false, 'Size',[227 227], 'Mean',[104 117 123]};
end

##### SOURCE END #####
-->
   </body>
</html>