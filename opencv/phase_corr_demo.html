<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Phase Correlation</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="phase_corr_demo.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Phase Correlation</h1>
         <!--introduction-->
         <p>Demonstrates estimating translational shift between two successive frames using Phase Correlation.</p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://github.com/opencv/opencv/blob/3.1.0/samples/cpp/phase_corr.cpp">https://github.com/opencv/opencv/blob/3.1.0/samples/cpp/phase_corr.cpp</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <h2 id="toc">Contents</h2>
         <div>
            <ul>
               <li><a href="#2">Prepare video source</a></li>
               <li><a href="#3">Main loop</a></li>
            </ul>
         </div>
         <h2 id="2">Prepare video source</h2><pre class="codeinput">vid = createVideoCapture([], <span class="string">'book'</span>);
pause(1);
assert(vid.isOpened(), <span class="string">'Could not initialize capturing'</span>);

frame = vid.read();
assert(~isempty(frame), <span class="string">'Could not read data from the video source'</span>);
hImg = imshow(frame);
title(<span class="string">'phase shift'</span>)

<span class="comment">% window function to reduce edge effects</span>
[h,w,~] = size(frame);
center = round([w h]/2);
hannW = cv.createHanningWindow([w h]);</pre><img src="phase_corr_demo_01.png"><h2 id="3">Main loop</h2><pre class="codeinput">curr = cv.cvtColor(frame, <span class="string">'RGB2GRAY'</span>);
<span class="keyword">while</span> ishghandle(hImg)
    <span class="comment">% get frame</span>
    frame = vid.read();
    <span class="keyword">if</span> isempty(frame), <span class="keyword">break</span>; <span class="keyword">end</span>

    <span class="comment">% keep track of previous and current grayscale images</span>
    prev = curr;
    curr = cv.cvtColor(frame, <span class="string">'RGB2GRAY'</span>);

    <span class="comment">% estimate shift using phase correlation</span>
    shift = cv.phaseCorrelate(double(prev), double(curr), <span class="string">'Window'</span>,hannW);
    radius = hypot(shift(1), shift(2));

    <span class="keyword">if</span> radius &gt; 3
        <span class="comment">% draw a circle and line indicating the shift direction</span>
        frame = cv.circle(frame, center, round(radius), <span class="keyword">...</span>
            <span class="string">'Color'</span>,[0 255 0], <span class="string">'Thickness'</span>,3, <span class="string">'LineType'</span>,<span class="string">'AA'</span>);
        frame = cv.line(frame, center, center+round(shift), <span class="keyword">...</span>
            <span class="string">'Color'</span>,[0 255 0], <span class="string">'Thickness'</span>,3, <span class="string">'LineType'</span>,<span class="string">'AA'</span>);
    <span class="keyword">end</span>

    <span class="comment">% show result</span>
    set(hImg, <span class="string">'CData'</span>,frame);
    drawnow;
<span class="keyword">end</span>
vid.release();</pre><img src="phase_corr_demo_02.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Phase Correlation
% Demonstrates estimating translational shift between two successive frames
% using Phase Correlation.
%
% Sources:
%
% * <https://github.com/opencv/opencv/blob/3.1.0/samples/cpp/phase_corr.cpp>
%

%% Prepare video source
vid = createVideoCapture([], 'book');
pause(1);
assert(vid.isOpened(), 'Could not initialize capturing');

frame = vid.read();
assert(~isempty(frame), 'Could not read data from the video source');
hImg = imshow(frame);
title('phase shift')

% window function to reduce edge effects
[h,w,~] = size(frame);
center = round([w h]/2);
hannW = cv.createHanningWindow([w h]);

%% Main loop
curr = cv.cvtColor(frame, 'RGB2GRAY');
while ishghandle(hImg)
    % get frame
    frame = vid.read();
    if isempty(frame), break; end

    % keep track of previous and current grayscale images
    prev = curr;
    curr = cv.cvtColor(frame, 'RGB2GRAY');

    % estimate shift using phase correlation
    shift = cv.phaseCorrelate(double(prev), double(curr), 'Window',hannW);
    radius = hypot(shift(1), shift(2));

    if radius > 3
        % draw a circle and line indicating the shift direction
        frame = cv.circle(frame, center, round(radius), ...
            'Color',[0 255 0], 'Thickness',3, 'LineType','AA');
        frame = cv.line(frame, center, center+round(shift), ...
            'Color',[0 255 0], 'Thickness',3, 'LineType','AA');
    end

    % show result
    set(hImg, 'CData',frame);
    drawnow;
end
vid.release();

##### SOURCE END #####
-->
   </body>
</html>