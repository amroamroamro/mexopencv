<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Hough Lines Transform</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="hough_lines_demo.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Hough Lines Transform</h1>
         <!--introduction-->
         <p>An example using the Hough line detector.</p>
         <p>This program demonstrates line finding with the Hough transform. We show how to use the OpenCV functions <tt>cv.HoughLines</tt> and <tt>cv.HoughLinesP</tt> to detect lines in an image.
         </p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/houghlines.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/houghlines.cpp</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/python/houghlines.py">https://github.com/opencv/opencv/blob/3.2.0/samples/python/houghlines.py</a></li>
               <li><a href="https://docs.opencv.org/3.2.0/d9/db0/tutorial_hough_lines.html">https://docs.opencv.org/3.2.0/d9/db0/tutorial_hough_lines.html</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgTrans/HoughLines_Demo.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgTrans/HoughLines_Demo.cpp</a></li>
               <li><a href="https://docs.opencv.org/3.2.0/d6/d10/tutorial_py_houghlines.html">https://docs.opencv.org/3.2.0/d6/d10/tutorial_py_houghlines.html</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <h2 id="toc">Contents</h2>
         <div>
            <ul>
               <li><a href="#2">Theory</a></li>
               <li><a href="#3">Standard and Probabilistic Hough Line Transform</a></li>
               <li><a href="#4">Code</a></li>
            </ul>
         </div>
         <h2 id="2">Theory</h2>
         <p>The explanation below belongs to the book <b>Learning OpenCV</b> by Bradski and Kaehler.
         </p>
         <p>The Hough Line Transform is a transform used to detect straight lines. To apply the Transform, first an edge detection pre-processing
            is desirable.
         </p>
         <p>As you know, a line in the image space can be expressed with two variables. For example:</p>
         <div>
            <ul>
               <li>In the <b>Cartesian coordinate system:</b> Parameters: <img src="hough_lines_demo_eq06510806714878719442.png" alt="$(m,b)$" class="equation" width="35" height="15">.
               </li>
               <li>In the <b>Polar coordinate system:</b> Parameters: <img src="hough_lines_demo_eq14890419415115900439.png" alt="$(r,\theta)$" class="equation" width="29" height="15"></li>
            </ul>
         </div>
         <p><img src="https://docs.opencv.org/3.2.0/Hough_Lines_Tutorial_Theory_0.jpg"></p>
         <p>For Hough Transforms, we will express lines in the <i>Polar system</i>. Hence, a line equation can be written as:
         </p>
         <p><img src="hough_lines_demo_eq16534772293048987943.png" alt="$$y = \left ( -\frac{\cos \theta}{\sin \theta} \right ) x +&#xA;      \left ( \frac{r}{\sin \theta} \right )$$" class="equation" width="169" height="36"></p>
         <p>Arranging the terms: <img src="hough_lines_demo_eq01597400298928084380.png" alt="$r = x \cos \theta + y \sin \theta$" class="equation" width="123" height="14"></p>
         <p>In general for each point <img src="hough_lines_demo_eq15807261426452954823.png" alt="$(x_{0}, y_{0})$" class="equation" width="43" height="15">, we can define the family of lines that goes through that point as:
         </p>
         <p><img src="hough_lines_demo_eq12767611242380499502.png" alt="$$r_{\theta} = x_{0} \cdot \cos \theta + y_{0} \cdot \sin \theta$$" class="equation" width="156" height="14"></p>
         <p>Meaning that each pair <img src="hough_lines_demo_eq09158662583328349990.png" alt="$(r_{\theta},\theta)$" class="equation" width="36" height="15"> represents each line that passes by <img src="hough_lines_demo_eq15807261426452954823.png" alt="$(x_{0}, y_{0})$" class="equation" width="43" height="15">.
         </p>
         <p>If for a given <img src="hough_lines_demo_eq15807261426452954823.png" alt="$(x_{0}, y_{0})$" class="equation" width="43" height="15"> we plot the family of lines that goes through it, we get a sinusoid. For instance, for <img src="hough_lines_demo_eq01949636286227400194.png" alt="$x_{0} = 8$" class="equation" width="41" height="13"> and <img src="hough_lines_demo_eq16695751471153586772.png" alt="$y_{0} = 6$" class="equation" width="40" height="13"> we get the following plot (in a plane <img src="hough_lines_demo_eq08288499342375314727.png" alt="$\theta$" class="equation" width="7" height="11"> - <img src="hough_lines_demo_eq04958265083611378313.png" alt="$r$" class="equation" width="7" height="7">):
         </p>
         <p><img src="https://docs.opencv.org/3.2.0/Hough_Lines_Tutorial_Theory_1.jpg"></p>
         <p>We consider only points such that <img src="hough_lines_demo_eq12873121530036831148.png" alt="$r &gt; 0$" class="equation" width="34" height="11"> and <img src="hough_lines_demo_eq13664681391553555216.png" alt="$0< \theta < 2 \pi$" class="equation" width="69" height="12">.
         </p>
         <p>We can do the same operation above for all the points in an image. If the curves of two different points intersect in the
            plane <img src="hough_lines_demo_eq08288499342375314727.png" alt="$\theta$" class="equation" width="7" height="11"> - <img src="hough_lines_demo_eq04958265083611378313.png" alt="$r$" class="equation" width="7" height="7">, that means that both points belong to a same line. For instance, following with the example above and drawing the plot for
            two more points: <img src="hough_lines_demo_eq03428498497218194732.png" alt="$x_{1} = 4$" class="equation" width="41" height="12">, <img src="hough_lines_demo_eq00552631489938289885.png" alt="$y_{1} = 9$" class="equation" width="40" height="13"> and <img src="hough_lines_demo_eq17482667048486225782.png" alt="$x_{2} = 12$" class="equation" width="48" height="12">, <img src="hough_lines_demo_eq09664101142733500497.png" alt="$y_{2} = 3$" class="equation" width="40" height="13">, we get:
         </p>
         <p><img src="https://docs.opencv.org/3.2.0/Hough_Lines_Tutorial_Theory_2.jpg"></p>
         <p>The three plots intersect in one single point <img src="hough_lines_demo_eq08158434065732735555.png" alt="$(0.925, 9.6)$" class="equation" width="68" height="15">, these coordinates are the parameters (<img src="hough_lines_demo_eq05172173962201390834.png" alt="$\theta, r$" class="equation" width="20" height="14">) or the line in which <img src="hough_lines_demo_eq15807261426452954823.png" alt="$(x_{0}, y_{0})$" class="equation" width="43" height="15">, <img src="hough_lines_demo_eq01962604463593739213.png" alt="$(x_{1}, y_{1})$" class="equation" width="43" height="15"> and <img src="hough_lines_demo_eq10637667552253296335.png" alt="$(x_{2}, y_{2})$" class="equation" width="43" height="15"> lay.
         </p>
         <p>What does all the stuff above mean? It means that in general, a line can be <i>detected</i> by finding the number of intersections between curves. The more curves intersecting means that the line represented by that
            intersection have more points. In general, we can define a <i>threshold</i> of the minimum number of intersections needed to <i>detect</i> a line.
         </p>
         <p>This is what the Hough Line Transform does. It keeps track of the intersection between curves of every point in the image.
            If the number of intersections is above some <i>threshold</i>, then it declares it as a line with the parameters <img src="hough_lines_demo_eq12448610621556626870.png" alt="$(\theta, r_{\theta})$" class="equation" width="36" height="15"> of the intersection point.
         </p>
         <h2 id="3">Standard and Probabilistic Hough Line Transform</h2>
         <p>OpenCV implements two kind of Hough Line Transforms:</p>
         <p>1) <b>The Standard Hough Transform</b></p>
         <div>
            <ul>
               <li>It consists in pretty much what we just explained in the previous section.   It gives you as result a vector of couples <img src="hough_lines_demo_eq12448610621556626870.png" alt="$(\theta, r_{\theta})$" class="equation" width="36" height="15"></li>
               <li>In OpenCV it is implemented with the function <tt>cv.HoughLines</tt></li>
            </ul>
         </div>
         <p>2) <b>The Probabilistic Hough Line Transform</b></p>
         <div>
            <ul>
               <li>A more efficient implementation of the Hough Line Transform. It gives as   output the extremes of the detected lines <img src="hough_lines_demo_eq14577569345227891262.png" alt="$(x_{0}, y_{0}, x_{1}, y_{1})$" class="equation" width="84" height="15"></li>
               <li>In OpenCV it is implemented with the function <tt>cv.HoughLinesP</tt></li>
            </ul>
         </div>
         <h2 id="4">Code</h2>
         <p>This program:</p>
         <div>
            <ul>
               <li>Loads an image</li>
               <li>Applies either a <i>Standard Hough Line Transform</i> or a   <i>Probabilistic Line Transform</i>.
               </li>
               <li>Display the original image and the detected line in two windows.</li>
            </ul>
         </div>
         <p>You may observe that the number of lines detected vary while you change the <i>threshold</i>. The explanation is sort of evident: If you establish a higher threshold, fewer lines will be detected (since you will need
            more points to declare a line detected).
         </p>
         <p>Input image</p><pre class="codeinput"><span class="keyword">if</span> true
    fname = fullfile(mexopencv.root(), <span class="string">'test'</span>, <span class="string">'sudoku.jpg'</span>);
    thresh = 200;
    threshP = 100;
    minlen = 100;
<span class="keyword">else</span>
    fname = fullfile(mexopencv.root(), <span class="string">'test'</span>, <span class="string">'pic1.png'</span>);
    thresh = 85;
    threshP = 50;
    minlen = 50;
<span class="keyword">end</span>
src = cv.imread(fname, <span class="string">'Color'</span>,true);</pre><p>Edge Detection</p><pre class="codeinput">gray = cv.cvtColor(src, <span class="string">'RGB2GRAY'</span>);
edges = cv.Canny(gray, [50, 150], <span class="string">'ApertureSize'</span>,3);
imshow(edges), title(<span class="string">'Edges'</span>)</pre><img src="hough_lines_demo_01.png"><p>HoughLines: Standard Hough Line Transform</p><pre class="codeinput">tic
lines = cv.HoughLines(edges, <span class="string">'Rho'</span>,1, <span class="string">'Theta'</span>,pi/180, <span class="string">'Threshold'</span>,thresh);
toc</pre><pre class="codeoutput">Elapsed time is 0.040363 seconds.
</pre><p>draw the lines, and display the result</p><pre class="codeinput">lines = cat(1, lines{:});
rho = lines(:,1);
theta = lines(:,2);
a = cos(theta); b = sin(theta);
x0 = a.*rho; y0 = b.*rho;
pt1 = round([x0 + 1000*(-b), y0 + 1000*(a)]);
pt2 = round([x0 - 1000*(-b), y0 - 1000*(a)]);
out = cv.line(src, pt1, pt2, <span class="keyword">...</span>
    <span class="string">'Color'</span>,[0 255 0], <span class="string">'Thickness'</span>,2, <span class="string">'LineType'</span>,<span class="string">'AA'</span>);
figure, imshow(out), title(<span class="string">'Detected Lines'</span>)</pre><img src="hough_lines_demo_02.png"><p>HoughLinesP: Probabilistic Hough Line Transform</p><pre class="codeinput">tic
linesP = cv.HoughLinesP(edges, <span class="string">'Rho'</span>,1, <span class="string">'Theta'</span>,pi/180, <span class="keyword">...</span>
    <span class="string">'Threshold'</span>,threshP, <span class="string">'MinLineLength'</span>,minlen, <span class="string">'MaxLineGap'</span>,10);
toc</pre><pre class="codeoutput">Elapsed time is 0.048381 seconds.
</pre><p>draw the line segments, and display the result</p><pre class="codeinput">linesP = cat(1, linesP{:});
outP = cv.line(src, linesP(:,1:2), linesP(:,3:4), <span class="keyword">...</span>
    <span class="string">'Color'</span>,[0 255 0], <span class="string">'Thickness'</span>,2, <span class="string">'LineType'</span>,<span class="string">'AA'</span>);
figure, imshow(outP), title(<span class="string">'Detected Line Segments'</span>)</pre><img src="hough_lines_demo_03.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div><script type="text/x-mathjax-config">
  // https://stackoverflow.com/a/14631703/97160
  MathJax.Extension.myImg2jax = {
    version: "1.0",
    PreProcess: function (element) {
      var images = element.getElementsByTagName("img");
      for (var i = images.length - 1; i >= 0; i--) {
        var img = images[i];
        if (img.className === "equation") {
          var match = img.alt.match(/^(\$\$?)([\s\S]*)\1$/m);
          if (!match) continue;
          var script = document.createElement("script");
          script.type = "math/tex";
          if (match[1] === "$$") {script.type += ";mode=display"}
          MathJax.HTML.setScript(script, match[2]);
          img.parentNode.replaceChild(script, img);
        }
      }
    }
  };
  MathJax.Hub.Register.PreProcessor(["PreProcess", MathJax.Extension.myImg2jax]);
  </script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML"></script>
      <!--
##### SOURCE BEGIN #####
%% Hough Lines Transform
% An example using the Hough line detector.
%
% This program demonstrates line finding with the Hough transform.
% We show how to use the OpenCV functions |cv.HoughLines| and |cv.HoughLinesP|
% to detect lines in an image.
%
% Sources:
%
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/houghlines.cpp>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/python/houghlines.py>
% * <https://docs.opencv.org/3.2.0/d9/db0/tutorial_hough_lines.html>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgTrans/HoughLines_Demo.cpp>
% * <https://docs.opencv.org/3.2.0/d6/d10/tutorial_py_houghlines.html>
%

%% Theory
%
% The explanation below belongs to the book *Learning OpenCV* by
% Bradski and Kaehler.
%
% The Hough Line Transform is a transform used to detect straight lines. To
% apply the Transform, first an edge detection pre-processing is desirable.
%
% As you know, a line in the image space can be expressed with two variables.
% For example:
%
% * In the *Cartesian coordinate system:* Parameters: $(m,b)$.
% * In the *Polar coordinate system:* Parameters: $(r,\theta)$
%
% <<https://docs.opencv.org/3.2.0/Hough_Lines_Tutorial_Theory_0.jpg>>
%
% For Hough Transforms, we will express lines in the _Polar system_. Hence, a
% line equation can be written as:
%
% $$y = \left ( -\frac{\cos \theta}{\sin \theta} \right ) x +
%       \left ( \frac{r}{\sin \theta} \right )$$
%
% Arranging the terms: $r = x \cos \theta + y \sin \theta$
%
% In general for each point $(x_{0}, y_{0})$, we can define the family of
% lines that goes through that point as:
%
% $$r_{\theta} = x_{0} \cdot \cos \theta + y_{0} \cdot \sin \theta$$
%
% Meaning that each pair $(r_{\theta},\theta)$ represents each line that
% passes by $(x_{0}, y_{0})$.
%
% If for a given $(x_{0}, y_{0})$ we plot the family of lines that goes
% through it, we get a sinusoid. For instance, for $x_{0} = 8$ and $y_{0} = 6$
% we get the following plot (in a plane $\theta$ - $r$):
%
% <<https://docs.opencv.org/3.2.0/Hough_Lines_Tutorial_Theory_1.jpg>>
%
% We consider only points such that $r > 0$ and $0< \theta < 2 \pi$.
%
% We can do the same operation above for all the points in an image. If the
% curves of two different points intersect in the plane $\theta$ - $r$, that
% means that both points belong to a same line. For instance, following with
% the example above and drawing the plot for two more points:
% $x_{1} = 4$, $y_{1} = 9$ and $x_{2} = 12$, $y_{2} = 3$, we get:
%
% <<https://docs.opencv.org/3.2.0/Hough_Lines_Tutorial_Theory_2.jpg>>
%
% The three plots intersect in one single point $(0.925, 9.6)$, these
% coordinates are the parameters ($\theta, r$) or the line in which
% $(x_{0}, y_{0})$, $(x_{1}, y_{1})$ and $(x_{2}, y_{2})$ lay.
%
% What does all the stuff above mean? It means that in general, a line can be
% _detected_ by finding the number of intersections between curves. The more
% curves intersecting means that the line represented by that intersection
% have more points. In general, we can define a _threshold_ of the minimum
% number of intersections needed to _detect_ a line.
%
% This is what the Hough Line Transform does. It keeps track of the
% intersection between curves of every point in the image. If the number of
% intersections is above some _threshold_, then it declares it as a line with
% the parameters $(\theta, r_{\theta})$ of the intersection point.
%
%% Standard and Probabilistic Hough Line Transform
%
% OpenCV implements two kind of Hough Line Transforms:
%
% 1) *The Standard Hough Transform*
%
% * It consists in pretty much what we just explained in the previous section.
%   It gives you as result a vector of couples $(\theta, r_{\theta})$
% * In OpenCV it is implemented with the function |cv.HoughLines|
%
% 2) *The Probabilistic Hough Line Transform*
%
% * A more efficient implementation of the Hough Line Transform. It gives as
%   output the extremes of the detected lines $(x_{0}, y_{0}, x_{1}, y_{1})$
% * In OpenCV it is implemented with the function |cv.HoughLinesP|
%

%% Code
%
% This program:
%
% * Loads an image
% * Applies either a _Standard Hough Line Transform_ or a
%   _Probabilistic Line Transform_.
% * Display the original image and the detected line in two windows.
%
% You may observe that the number of lines detected vary while you change the
% _threshold_. The explanation is sort of evident: If you establish a higher
% threshold, fewer lines will be detected (since you will need more points to
% declare a line detected).
%

%%
% Input image
if true
    fname = fullfile(mexopencv.root(), 'test', 'sudoku.jpg');
    thresh = 200;
    threshP = 100;
    minlen = 100;
else
    fname = fullfile(mexopencv.root(), 'test', 'pic1.png');
    thresh = 85;
    threshP = 50;
    minlen = 50;
end
src = cv.imread(fname, 'Color',true);

%%
% Edge Detection
gray = cv.cvtColor(src, 'RGB2GRAY');
edges = cv.Canny(gray, [50, 150], 'ApertureSize',3);
imshow(edges), title('Edges')

%%
% HoughLines: Standard Hough Line Transform
tic
lines = cv.HoughLines(edges, 'Rho',1, 'Theta',pi/180, 'Threshold',thresh);
toc

%%
% draw the lines, and display the result
lines = cat(1, lines{:});
rho = lines(:,1);
theta = lines(:,2);
a = cos(theta); b = sin(theta);
x0 = a.*rho; y0 = b.*rho;
pt1 = round([x0 + 1000*(-b), y0 + 1000*(a)]);
pt2 = round([x0 - 1000*(-b), y0 - 1000*(a)]);
out = cv.line(src, pt1, pt2, ...
    'Color',[0 255 0], 'Thickness',2, 'LineType','AA');
figure, imshow(out), title('Detected Lines')

%%
% HoughLinesP: Probabilistic Hough Line Transform
tic
linesP = cv.HoughLinesP(edges, 'Rho',1, 'Theta',pi/180, ...
    'Threshold',threshP, 'MinLineLength',minlen, 'MaxLineGap',10);
toc

%%
% draw the line segments, and display the result
linesP = cat(1, linesP{:});
outP = cv.line(src, linesP(:,1:2), linesP(:,3:4), ...
    'Color',[0 255 0], 'Thickness',2, 'LineType','AA');
figure, imshow(outP), title('Detected Line Segments')

##### SOURCE END #####
--></body>
</html>