<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>inRange Thresholding Operations</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="threshold_inrange_demo_gui.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">inRange Thresholding Operations</h1>
         <p>In this demo, we show how to:</p>
         <div>
            <ul>
               <li>Perform basic thresholding operations using OpenCV function <tt>cv.inRange</tt></li>
               <li>Detect an object based on the range of pixel values it has</li>
            </ul>
         </div>
         <p>For improving detection by color, it is common to perform thresholding in other colorspaces like HSV or LAB, where luma and
            chroma are represented separately.
         </p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://docs.opencv.org/3.2.0/da/d97/tutorial_threshold_inRange.html">https://docs.opencv.org/3.2.0/da/d97/tutorial_threshold_inRange.html</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgProc/Threshold_inRange.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgProc/Threshold_inRange.cpp</a></li>
            </ul>
         </div><pre class="codeinput"><span class="keyword">function</span> varargout = threshold_inrange_demo_gui(im)
    <span class="comment">% load source image</span>
    <span class="keyword">if</span> nargin &lt; 1
        src = cv.imread(fullfile(mexopencv.root(),<span class="string">'test'</span>,<span class="string">'monster.jpg'</span>));
    <span class="keyword">elseif</span> ischar(im)
        src = cv.imread(im);
    <span class="keyword">else</span>
        src = im;
    <span class="keyword">end</span>
    validateattributes(src, {<span class="string">'uint8'</span>}, {<span class="string">'size'</span>,[NaN NaN 3]});

    <span class="comment">% create the UI</span>
    h = buildGUI(src);
    <span class="keyword">if</span> nargout &gt; 0, varargout{1} = h; <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> onType(~,e,h)
    <span class="comment">%ONTYPE  Event handler for key press on figure</span>

    <span class="comment">% handle keys</span>
    <span class="keyword">switch</span> e.Key
        <span class="keyword">case</span> <span class="string">'h'</span>
            helpdlg({
                <span class="string">'Hot keys:'</span>
                <span class="string">'h - this help dialog'</span>
                <span class="string">'q - quit the program'</span>
                <span class="string">'s - save thresholded image'</span>
            });

        <span class="keyword">case</span> {<span class="string">'q'</span>, <span class="string">'escape'</span>}
            close(h.fig);

        <span class="keyword">case</span> {<span class="string">'s'</span>, <span class="string">'space'</span>}
            <span class="comment">% save image</span>
            img = get(h.img(2), <span class="string">'CData'</span>);
            fname = fullfile(tempdir(), <span class="keyword">...</span>
                sprintf(<span class="string">'out_%s.png'</span>, datestr(now(),<span class="string">'yyyymmddTHHMMSS'</span>)));
            cv.imwrite(fname, img);
            disp([<span class="string">'Saved '</span> fname]);
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> onChange(~,~,h)
    <span class="comment">%ONCHANGE  Event handler for UI controls</span>

    <span class="comment">% retrieve current values from UI controls</span>
    rlo = round(get(h.slid(1), <span class="string">'Value'</span>));
    rhi = round(get(h.slid(2), <span class="string">'Value'</span>));
    glo = round(get(h.slid(3), <span class="string">'Value'</span>));
    ghi = round(get(h.slid(4), <span class="string">'Value'</span>));
    blo = round(get(h.slid(5), <span class="string">'Value'</span>));
    bhi = round(get(h.slid(6), <span class="string">'Value'</span>));

    <span class="comment">% permform thresholding</span>
    lowerb = min([rlo glo blo], [rhi ghi bhi]);
    upperb = max([rlo glo blo], [rhi ghi bhi]);
    mask = cv.inRange(h.src, lowerb, upperb);

    <span class="comment">% apply mask</span>
    out = cv.copyTo(h.src, <span class="string">'Mask'</span>,mask);

    <span class="comment">% update UI and show result</span>
    set(h.txt(1), <span class="string">'String'</span>,sprintf(<span class="string">' Low R: %3d'</span>,rlo));
    set(h.txt(2), <span class="string">'String'</span>,sprintf(<span class="string">'High R: %3d'</span>,rhi));
    set(h.txt(3), <span class="string">'String'</span>,sprintf(<span class="string">' Low G: %3d'</span>,glo));
    set(h.txt(4), <span class="string">'String'</span>,sprintf(<span class="string">'High G: %3d'</span>,ghi));
    set(h.txt(5), <span class="string">'String'</span>,sprintf(<span class="string">' Low B: %3d'</span>,blo));
    set(h.txt(6), <span class="string">'String'</span>,sprintf(<span class="string">'High B: %3d'</span>,bhi));
    set(h.img(2), <span class="string">'CData'</span>,out);
    drawnow;
<span class="keyword">end</span>

<span class="keyword">function</span> h = buildGUI(img)
    <span class="comment">%BUILDGUI  Creates the UI</span>

    <span class="comment">% parameters</span>
    sz = size(img);
    rlo = 100; rhi = 255;
    glo = 0; ghi = 100;
    blo = 0; bhi = 100;

    <span class="comment">% build the user interface (no resizing to keep it simple)</span>
    h = struct();
    h.src = img;
    h.fig = figure(<span class="string">'Name'</span>,<span class="string">'Threshold Demo'</span>, <span class="keyword">...</span>
        <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>, <span class="string">'Menubar'</span>,<span class="string">'none'</span>, <span class="string">'Resize'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[200 200 sz(2)*2 sz(1)+155-1]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        <span class="comment">%HACK: not implemented in Octave</span>
        movegui(h.fig, <span class="string">'center'</span>);
    <span class="keyword">end</span>
    imgs = {img, false(sz(1:2))};
    <span class="keyword">for</span> i=1:numel(imgs)
        h.ax(i) = axes(<span class="string">'Parent'</span>,h.fig, <span class="string">'Units'</span>,<span class="string">'pixels'</span>, <span class="keyword">...</span>
            <span class="string">'Position'</span>,[1+sz(2)*(i-1) 155 sz(2) sz(1)]);
        <span class="keyword">if</span> ~mexopencv.isOctave()
            h.img(i) = imshow(imgs{i}, <span class="string">'Parent'</span>,h.ax(i));
        <span class="keyword">else</span>
            <span class="comment">%HACK: https://savannah.gnu.org/bugs/index.php?45473</span>
            axes(h.ax(i));
            h.img(i) = imshow(imgs{i});
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    h.txt(1) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 5 130 20], <span class="string">'FontSize'</span>,11, <span class="string">'ForegroundColor'</span>,<span class="string">'r'</span>, <span class="keyword">...</span>
        <span class="string">'String'</span>,sprintf(<span class="string">' Low R: %3d'</span>,rlo));
    h.txt(2) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 30 130 20], <span class="string">'FontSize'</span>,11, <span class="string">'ForegroundColor'</span>,<span class="string">'r'</span>, <span class="keyword">...</span>
        <span class="string">'String'</span>,sprintf(<span class="string">'High R: %3d'</span>,rhi));
    h.txt(3) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 55 130 20], <span class="string">'FontSize'</span>,11, <span class="string">'ForegroundColor'</span>,<span class="string">'g'</span>, <span class="keyword">...</span>
        <span class="string">'String'</span>,sprintf(<span class="string">' Low G: %3d'</span>,glo));
    h.txt(4) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 80 130 20], <span class="string">'FontSize'</span>,11, <span class="string">'ForegroundColor'</span>,<span class="string">'g'</span>, <span class="keyword">...</span>
        <span class="string">'String'</span>,sprintf(<span class="string">'High G: %3d'</span>,ghi));
    h.txt(5) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 105 130 20], <span class="string">'FontSize'</span>,11, <span class="string">'ForegroundColor'</span>,<span class="string">'b'</span>, <span class="keyword">...</span>
        <span class="string">'String'</span>,sprintf(<span class="string">' Low B: %3d'</span>,blo));
    h.txt(6) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 130 130 20], <span class="string">'FontSize'</span>,11, <span class="string">'ForegroundColor'</span>,<span class="string">'b'</span>, <span class="keyword">...</span>
        <span class="string">'String'</span>,sprintf(<span class="string">'High B: %3d'</span>,bhi));
    h.slid(1) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[135 5 sz(2)-135-5 20], <span class="string">'Value'</span>,rlo, <span class="keyword">...</span>
        <span class="string">'Min'</span>,0, <span class="string">'Max'</span>,255, <span class="string">'SliderStep'</span>,[1 20]./(255-0));
    h.slid(2) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[135 30 sz(2)-135-5 20], <span class="string">'Value'</span>,rhi, <span class="keyword">...</span>
        <span class="string">'Min'</span>,0, <span class="string">'Max'</span>,255, <span class="string">'SliderStep'</span>,[1 20]./(255-0));
    h.slid(3) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[135 55 sz(2)-135-5 20], <span class="string">'Value'</span>,glo, <span class="keyword">...</span>
        <span class="string">'Min'</span>,0, <span class="string">'Max'</span>,255, <span class="string">'SliderStep'</span>,[1 20]./(255-0));
    h.slid(4) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[135 80 sz(2)-135-5 20], <span class="string">'Value'</span>,ghi, <span class="keyword">...</span>
        <span class="string">'Min'</span>,0, <span class="string">'Max'</span>,255, <span class="string">'SliderStep'</span>,[1 20]./(255-0));
    h.slid(5) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[135 105 sz(2)-135-5 20], <span class="string">'Value'</span>,blo, <span class="keyword">...</span>
        <span class="string">'Min'</span>,0, <span class="string">'Max'</span>,255, <span class="string">'SliderStep'</span>,[1 20]./(255-0));
    h.slid(6) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[135 130 sz(2)-135-5 20], <span class="string">'Value'</span>,bhi, <span class="keyword">...</span>
        <span class="string">'Min'</span>,0, <span class="string">'Max'</span>,255, <span class="string">'SliderStep'</span>,[1 20]./(255-0));

    <span class="comment">% hook event handlers, and trigger default start</span>
    opts = {<span class="string">'Interruptible'</span>,<span class="string">'off'</span>, <span class="string">'BusyAction'</span>,<span class="string">'cancel'</span>};
    set(h.slid, <span class="string">'Callback'</span>,{@onChange,h}, opts{:});
    set(h.fig, <span class="string">'WindowKeyPressFcn'</span>,{@onType,h}, opts{:});
    onChange([],[],h);
<span class="keyword">end</span></pre><img src="threshold_inrange_demo_gui_01.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% inRange Thresholding Operations
%
% In this demo, we show how to:
%
% * Perform basic thresholding operations using OpenCV function |cv.inRange|
% * Detect an object based on the range of pixel values it has
%
% For improving detection by color, it is common to perform thresholding in
% other colorspaces like HSV or LAB, where luma and chroma are represented
% separately.
%
% Sources:
%
% * <https://docs.opencv.org/3.2.0/da/d97/tutorial_threshold_inRange.html>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgProc/Threshold_inRange.cpp>
%

function varargout = threshold_inrange_demo_gui(im)
    % load source image
    if nargin < 1
        src = cv.imread(fullfile(mexopencv.root(),'test','monster.jpg'));
    elseif ischar(im)
        src = cv.imread(im);
    else
        src = im;
    end
    validateattributes(src, {'uint8'}, {'size',[NaN NaN 3]});

    % create the UI
    h = buildGUI(src);
    if nargout > 0, varargout{1} = h; end
end

function onType(~,e,h)
    %ONTYPE  Event handler for key press on figure

    % handle keys
    switch e.Key
        case 'h'
            helpdlg({
                'Hot keys:'
                'h - this help dialog'
                'q - quit the program'
                's - save thresholded image'
            });

        case {'q', 'escape'}
            close(h.fig);

        case {'s', 'space'}
            % save image
            img = get(h.img(2), 'CData');
            fname = fullfile(tempdir(), ...
                sprintf('out_%s.png', datestr(now(),'yyyymmddTHHMMSS')));
            cv.imwrite(fname, img);
            disp(['Saved ' fname]);
    end
end

function onChange(~,~,h)
    %ONCHANGE  Event handler for UI controls

    % retrieve current values from UI controls
    rlo = round(get(h.slid(1), 'Value'));
    rhi = round(get(h.slid(2), 'Value'));
    glo = round(get(h.slid(3), 'Value'));
    ghi = round(get(h.slid(4), 'Value'));
    blo = round(get(h.slid(5), 'Value'));
    bhi = round(get(h.slid(6), 'Value'));

    % permform thresholding
    lowerb = min([rlo glo blo], [rhi ghi bhi]);
    upperb = max([rlo glo blo], [rhi ghi bhi]);
    mask = cv.inRange(h.src, lowerb, upperb);

    % apply mask
    out = cv.copyTo(h.src, 'Mask',mask);

    % update UI and show result
    set(h.txt(1), 'String',sprintf(' Low R: %3d',rlo));
    set(h.txt(2), 'String',sprintf('High R: %3d',rhi));
    set(h.txt(3), 'String',sprintf(' Low G: %3d',glo));
    set(h.txt(4), 'String',sprintf('High G: %3d',ghi));
    set(h.txt(5), 'String',sprintf(' Low B: %3d',blo));
    set(h.txt(6), 'String',sprintf('High B: %3d',bhi));
    set(h.img(2), 'CData',out);
    drawnow;
end

function h = buildGUI(img)
    %BUILDGUI  Creates the UI

    % parameters
    sz = size(img);
    rlo = 100; rhi = 255;
    glo = 0; ghi = 100;
    blo = 0; bhi = 100;

    % build the user interface (no resizing to keep it simple)
    h = struct();
    h.src = img;
    h.fig = figure('Name','Threshold Demo', ...
        'NumberTitle','off', 'Menubar','none', 'Resize','off', ...
        'Position',[200 200 sz(2)*2 sz(1)+155-1]);
    if ~mexopencv.isOctave()
        %HACK: not implemented in Octave
        movegui(h.fig, 'center');
    end
    imgs = {img, false(sz(1:2))};
    for i=1:numel(imgs)
        h.ax(i) = axes('Parent',h.fig, 'Units','pixels', ...
            'Position',[1+sz(2)*(i-1) 155 sz(2) sz(1)]);
        if ~mexopencv.isOctave()
            h.img(i) = imshow(imgs{i}, 'Parent',h.ax(i));
        else
            %HACK: https://savannah.gnu.org/bugs/index.php?45473
            axes(h.ax(i));
            h.img(i) = imshow(imgs{i});
        end
    end
    h.txt(1) = uicontrol('Parent',h.fig, 'Style','text', ...
        'Position',[5 5 130 20], 'FontSize',11, 'ForegroundColor','r', ...
        'String',sprintf(' Low R: %3d',rlo));
    h.txt(2) = uicontrol('Parent',h.fig, 'Style','text', ...
        'Position',[5 30 130 20], 'FontSize',11, 'ForegroundColor','r', ...
        'String',sprintf('High R: %3d',rhi));
    h.txt(3) = uicontrol('Parent',h.fig, 'Style','text', ...
        'Position',[5 55 130 20], 'FontSize',11, 'ForegroundColor','g', ...
        'String',sprintf(' Low G: %3d',glo));
    h.txt(4) = uicontrol('Parent',h.fig, 'Style','text', ...
        'Position',[5 80 130 20], 'FontSize',11, 'ForegroundColor','g', ...
        'String',sprintf('High G: %3d',ghi));
    h.txt(5) = uicontrol('Parent',h.fig, 'Style','text', ...
        'Position',[5 105 130 20], 'FontSize',11, 'ForegroundColor','b', ...
        'String',sprintf(' Low B: %3d',blo));
    h.txt(6) = uicontrol('Parent',h.fig, 'Style','text', ...
        'Position',[5 130 130 20], 'FontSize',11, 'ForegroundColor','b', ...
        'String',sprintf('High B: %3d',bhi));
    h.slid(1) = uicontrol('Parent',h.fig, 'Style','slider', ...
        'Position',[135 5 sz(2)-135-5 20], 'Value',rlo, ...
        'Min',0, 'Max',255, 'SliderStep',[1 20]./(255-0));
    h.slid(2) = uicontrol('Parent',h.fig, 'Style','slider', ...
        'Position',[135 30 sz(2)-135-5 20], 'Value',rhi, ...
        'Min',0, 'Max',255, 'SliderStep',[1 20]./(255-0));
    h.slid(3) = uicontrol('Parent',h.fig, 'Style','slider', ...
        'Position',[135 55 sz(2)-135-5 20], 'Value',glo, ...
        'Min',0, 'Max',255, 'SliderStep',[1 20]./(255-0));
    h.slid(4) = uicontrol('Parent',h.fig, 'Style','slider', ...
        'Position',[135 80 sz(2)-135-5 20], 'Value',ghi, ...
        'Min',0, 'Max',255, 'SliderStep',[1 20]./(255-0));
    h.slid(5) = uicontrol('Parent',h.fig, 'Style','slider', ...
        'Position',[135 105 sz(2)-135-5 20], 'Value',blo, ...
        'Min',0, 'Max',255, 'SliderStep',[1 20]./(255-0));
    h.slid(6) = uicontrol('Parent',h.fig, 'Style','slider', ...
        'Position',[135 130 sz(2)-135-5 20], 'Value',bhi, ...
        'Min',0, 'Max',255, 'SliderStep',[1 20]./(255-0));

    % hook event handlers, and trigger default start
    opts = {'Interruptible','off', 'BusyAction','cancel'};
    set(h.slid, 'Callback',{@onChange,h}, opts{:});
    set(h.fig, 'WindowKeyPressFcn',{@onType,h}, opts{:});
    onChange([],[],h);
end

##### SOURCE END #####
-->
   </body>
</html>