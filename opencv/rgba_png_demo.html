<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Create PNG image with alpha transparency</title>
      <meta name="generator" content="MATLAB 9.4">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2018-10-05">
      <meta name="DC.source" content="rgba_png_demo.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Create PNG image with alpha transparency</h1>
         <!--introduction-->
         <p>The sample shows how to create an RGBA image and store it as a PNG file. It also demonstrates how to set custom PNG compression
            parameters.
         </p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://github.com/opencv/opencv/blob/3.4.1/samples/cpp/tutorial_code/snippets/imgcodecs_imwrite.cpp">https://github.com/opencv/opencv/blob/3.4.1/samples/cpp/tutorial_code/snippets/imgcodecs_imwrite.cpp</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <p>create image with alpha channel</p><pre class="codeinput">sz = [480 640];
img = create_rgba_image(sz);
whos <span class="string">img</span></pre><p>write to PNG file with alpha data</p><pre class="codeinput">fname = fullfile(tempdir(), <span class="string">'alpha.png'</span>);
<span class="keyword">if</span> true
    cv.imwrite(fname, img, <span class="string">'PngCompression'</span>,9, <span class="string">'PngStrategy'</span>,<span class="string">'RLE'</span>);
<span class="keyword">else</span>
    imwrite(img(:,:,1:3), fname, <span class="string">'Alpha'</span>,img(:,:,4))
<span class="keyword">end</span>
imfinfo(fname)</pre><pre class="codeoutput">ans = 
  struct with fields:

                  Filename: 'C:\Users\Amro\AppData\Local\Temp\alpha.png'
               FileModDate: '05-Oct-2018 00:59:56'
                  FileSize: 41853
                    Format: 'png'
             FormatVersion: []
                     Width: 640
                    Height: 480
                  BitDepth: 24
                 ColorType: 'truecolor'
           FormatSignature: [137 80 78 71 13 10 26 10]
                  Colormap: []
                 Histogram: []
             InterlaceType: 'none'
              Transparency: 'alpha'
    SimpleTransparencyData: []
           BackgroundColor: []
           RenderingIntent: []
            Chromaticities: []
                     Gamma: []
               XResolution: []
               YResolution: []
            ResolutionUnit: []
                   XOffset: []
                   YOffset: []
                OffsetUnit: []
           SignificantBits: []
              ImageModTime: []
                     Title: []
                    Author: []
               Description: []
                 Copyright: []
              CreationTime: []
                  Software: []
                Disclaimer: []
                   Warning: []
                    Source: []
                   Comment: []
                 OtherText: []
</pre><p>show image (over checkerboard image as background to better see transparency)</p><pre class="codeinput">bg = create_checkerboard_image(sz);
figure(<span class="string">'Menubar'</span>,<span class="string">'none'</span>, <span class="string">'Color'</span>,<span class="string">'k'</span>, <span class="string">'Name'</span>,<span class="string">'RGBA'</span>)
<span class="keyword">if</span> ~mexopencv.isOctave()
    imshow(bg, <span class="string">'InitialMagnification'</span>,100, <span class="string">'Border'</span>,<span class="string">'tight'</span>)
<span class="keyword">else</span>
    image(bg), axis <span class="string">image</span> <span class="string">off</span>
    set(gca, <span class="string">'Units'</span>,<span class="string">'normalized'</span>, <span class="string">'Position'</span>,[0 0 1 1])
<span class="keyword">end</span>
image(<span class="string">'CData'</span>,img(:,:,1:3), <span class="string">'AlphaData'</span>,img(:,:,4))</pre><img src="rgba_png_demo_01.png"><p>Helper functions</p><pre class="codeinput"><span class="keyword">function</span> img = create_rgba_image(sz)
    <span class="comment">%CREATE_RGBA_IMAGE  Create image with transparency, with a gradient effect</span>

    nrows = sz(1);
    ncols = sz(2);
    img = zeros(nrows, ncols, 4, <span class="string">'uint8'</span>);
    [I,J] = ndgrid(1:nrows, 1:ncols);
    img(:,:,1) = uint8(255 * (nrows-I+1)/nrows);     <span class="comment">% red</span>
    img(:,:,2) = uint8(255 * (ncols-J+1)/ncols);     <span class="comment">% green</span>
    img(:,:,3) = uint8(255);                         <span class="comment">% blue</span>
    img(:,:,4) = uint8(0.8 * sum(img(:,:,[1 2]),3)); <span class="comment">% alpha</span>
<span class="keyword">end</span>

<span class="keyword">function</span> img = create_checkerboard_image(sz)
    <span class="comment">%CREATE_CHECKERBOARD_IMAGE  Create checkerboard image</span>

    <span class="comment">% n should evenly divide both width and height</span>
    <span class="keyword">if</span> true
        n = 40;  <span class="comment">%HACK: hardcoded for 640x480</span>
    <span class="keyword">else</span>
        n = gcd(sz(1), sz(2));
    <span class="keyword">end</span>
    s = sz / n;
    assert(isequal(s, fix(s)));
    img = kron(bsxfun(@xor, mod(1:s(1),2).', mod(1:s(2),2)), ones(n));
    img = repmat(max(img, 0.75), [1 1 3]);
    img = uint8(255 * img);
<span class="keyword">end</span></pre><pre class="codeoutput">  Name        Size                 Bytes  Class    Attributes

  img       480x640x4            1228800  uint8              

</pre><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2018a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Create PNG image with alpha transparency
%
% The sample shows how to create an RGBA image and store it as a PNG file.
% It also demonstrates how to set custom PNG compression parameters.
%
% Sources:
%
% * <https://github.com/opencv/opencv/blob/3.4.1/samples/cpp/tutorial_code/snippets/imgcodecs_imwrite.cpp>
%

%%
% create image with alpha channel
sz = [480 640];
img = create_rgba_image(sz);
whos img

%%
% write to PNG file with alpha data
fname = fullfile(tempdir(), 'alpha.png');
if true
    cv.imwrite(fname, img, 'PngCompression',9, 'PngStrategy','RLE');
else
    imwrite(img(:,:,1:3), fname, 'Alpha',img(:,:,4))
end
imfinfo(fname)

%%
% show image (over checkerboard image as background to better see transparency)
bg = create_checkerboard_image(sz);
figure('Menubar','none', 'Color','k', 'Name','RGBA')
if ~mexopencv.isOctave()
    imshow(bg, 'InitialMagnification',100, 'Border','tight')
else
    image(bg), axis image off
    set(gca, 'Units','normalized', 'Position',[0 0 1 1])
end
image('CData',img(:,:,1:3), 'AlphaData',img(:,:,4))

%%
% Helper functions

function img = create_rgba_image(sz)
    %CREATE_RGBA_IMAGE  Create image with transparency, with a gradient effect

    nrows = sz(1);
    ncols = sz(2);
    img = zeros(nrows, ncols, 4, 'uint8');
    [I,J] = ndgrid(1:nrows, 1:ncols);
    img(:,:,1) = uint8(255 * (nrows-I+1)/nrows);     % red
    img(:,:,2) = uint8(255 * (ncols-J+1)/ncols);     % green
    img(:,:,3) = uint8(255);                         % blue
    img(:,:,4) = uint8(0.8 * sum(img(:,:,[1 2]),3)); % alpha
end

function img = create_checkerboard_image(sz)
    %CREATE_CHECKERBOARD_IMAGE  Create checkerboard image

    % n should evenly divide both width and height
    if true
        n = 40;  %HACK: hardcoded for 640x480
    else
        n = gcd(sz(1), sz(2));
    end
    s = sz / n;
    assert(isequal(s, fix(s)));
    img = kron(bsxfun(@xor, mod(1:s(1),2).', mod(1:s(2),2)), ones(n));
    img = repmat(max(img, 0.75), [1 1 3]);
    img = uint8(255 * img);
end

##### SOURCE END #####
-->
   </body>
</html>