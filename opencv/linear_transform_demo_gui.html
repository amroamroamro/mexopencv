<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Brightness and contrast adjustments</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="linear_transform_demo_gui.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Brightness and contrast adjustments</h1>
         <!--introduction-->
         <p>In this demo we show how to perform the operation <img src="linear_transform_demo_gui_eq08144811498147481904.png" alt="$g(i,j) = \alpha \cdot f(i,j) + \beta$" class="equation" width="143" height="15">.
         </p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://docs.opencv.org/3.3.0/d3/dc1/tutorial_basic_linear_transform.html">https://docs.opencv.org/3.3.0/d3/dc1/tutorial_basic_linear_transform.html</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgProc/BasicLinearTransforms.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgProc/BasicLinearTransforms.cpp</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/HighGUI/BasicLinearTransformsTrackbar.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/HighGUI/BasicLinearTransformsTrackbar.cpp</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.3.0/samples/cpp/tutorial_code/ImgProc/changing_contrast_brightness_image/changing_contrast_brightness_image.cpp">https://github.com/opencv/opencv/blob/3.3.0/samples/cpp/tutorial_code/ImgProc/changing_contrast_brightness_image/changing_contrast_brightness_image.cpp</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <h2 id="toc">Contents</h2>
         <div>
            <ul>
               <li><a href="#2">Theory</a></li>
               <li><a href="#3">Example</a></li>
               <li><a href="#4">Brightness and contrast adjustments</a></li>
               <li><a href="#5">Gamma correction</a></li>
               <li><a href="#6">Additional resources</a></li>
               <li><a href="#7">Code</a></li>
            </ul>
         </div>
         <h2 id="2">Theory</h2>
         <p>A general image processing operator is a function that takes one or more input images and produces an output image. Image
            transforms can be seen as:
         </p>
         <div>
            <ul>
               <li>Point operators (pixel transforms)</li>
               <li>Neighborhood (area-based) operators</li>
            </ul>
         </div>
         <p>In pixel transforms, each output pixel's value depends on only the corresponding input pixel value (plus, potentially, some
            globally collected information or parameters). Examples of such operators include <b>brightness and contrast adjustments</b> as well as color correction and transformations.
         </p>
         <p>For brightness and contrast adjustments, two commonly used point processes are <b>multiplication</b> and <b>addition</b> with a constant:
         </p>
         <p><img src="linear_transform_demo_gui_eq10377950630148504395.png" alt="$$g(x) = \alpha f(x) + \beta$$" class="equation" width="112" height="15"></p>
         <p>The parameters <img src="linear_transform_demo_gui_eq12739008793223724802.png" alt="$\alpha &gt; 0$" class="equation" width="36" height="11"> and <img src="linear_transform_demo_gui_eq17331442575217596290.png" alt="$\beta$" class="equation" width="9" height="14"> are often called the <b>gain</b> and <b>bias</b> parameters; sometimes these parameters are said to control <b>contrast</b> and <b>brightness</b> respectively. You can think of <img src="linear_transform_demo_gui_eq17663307419741296505.png" alt="$f(x)$" class="equation" width="27" height="15"> as the source image pixels and <img src="linear_transform_demo_gui_eq11695215030516304895.png" alt="$g(x)$" class="equation" width="26" height="15"> as the output image pixels. Then, more conveniently we can write the expression as:
         </p>
         <p><img src="linear_transform_demo_gui_eq05914946840866134629.png" alt="$$g(i,j) = \alpha \cdot f(i,j) + \beta$$" class="equation" width="143" height="15"></p>
         <p>where <img src="linear_transform_demo_gui_eq05671228016298599287.png" alt="$i$" class="equation" width="5" height="11"> and <img src="linear_transform_demo_gui_eq07225361342133155126.png" alt="$j$" class="equation" width="6" height="13"> indicates that the pixel is located in the <b>i-th</b> row and <b>j-th</b> column.
         </p>
         <p>In the implementation below, instead of using a for-loop to access each pixel, we simply use the function <tt>cv.convertTo</tt> which effectively performs <b>new_image = saturate(a*image + beta)</b>. This is more optimized than accessing each pixel and works a lot faster. Also notice that the operation can give values
            out of range or not integers (if <img src="linear_transform_demo_gui_eq14221827199139923399.png" alt="$\alpha$" class="equation" width="9" height="7"> is float), in which case <tt>cv.convertTo</tt> makes sure the values are valid.
         </p>
         <h2 id="3">Example</h2>
         <p>We will put into practice what we have learned to correct an underexposed image by adjusting the brightness and the contrast
            of the image. We will also see another technique to correct the brightness of an image called gamma correction.
         </p>
         <h2 id="4">Brightness and contrast adjustments</h2>
         <p>Increasing/decreasing the <img src="linear_transform_demo_gui_eq17331442575217596290.png" alt="$\beta$" class="equation" width="9" height="14"> value will add/subtract a constant value to every pixel. Pixel values outside of the <tt>[0 ; 255]</tt> range will be saturated (i.e. a pixel value higher/lesser than 255/0 will be clamp to 255/0).
         </p>
         <p><img src="https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_hist_beta.png"></p>
         <p><i>In light gray, histogram of the original image, in dark gray when <tt>brightness = 80</tt> in Gimp</i></p>
         <p>The histogram represents for each color level the number of pixels with that color level. A dark image will have many pixels
            with low color value and thus the histogram will present a peak in his left part. When adding a constant bias, the histogram
            is shifted to the right as we have added a constant bias to all the pixels.
         </p>
         <p>The <img src="linear_transform_demo_gui_eq14221827199139923399.png" alt="$\alpha$" class="equation" width="9" height="7"> parameter will modify how the levels spread. If <img src="linear_transform_demo_gui_eq11406958556464860172.png" alt="$\alpha < 1$" class="equation" width="35" height="11">, the color levels will be compressed and the result will be an image with less contrast.
         </p>
         <p><img src="https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_hist_alpha.png"></p>
         <p><i>In light gray, histogram of the original image, in dark gray when <tt>contrast &lt; 0</tt> in Gimp</i></p>
         <p>Note that these histograms have been obtained using the Brightness-Contrast tool in the Gimp software. The brightness tool
            should be identical to the <img src="linear_transform_demo_gui_eq17331442575217596290.png" alt="$\beta$" class="equation" width="9" height="14"> bias parameters but the contrast tool seems to differ to the <img src="linear_transform_demo_gui_eq14221827199139923399.png" alt="$\alpha$" class="equation" width="9" height="7"> gain where the output range seems to be centered with Gimp (as you can notice in the previous histogram).
         </p>
         <p>It can occur that playing with the <img src="linear_transform_demo_gui_eq17331442575217596290.png" alt="$\beta$" class="equation" width="9" height="14"> bias will improve the brightness but in the same time the image will appear with a slight veil as the contrast will be reduced.
            The <img src="linear_transform_demo_gui_eq14221827199139923399.png" alt="$\alpha$" class="equation" width="9" height="7"> gain can be used to diminue this effect but due to the saturation, we will lose some details in the original bright regions.
         </p>
         <h2 id="5">Gamma correction</h2>
         <p><a href="https://en.wikipedia.org/wiki/Gamma_correction">Gamma correction</a> can be used to correct the brightness of an image by using a non linear transformation between the input values and the mapped
            output values:
         </p>
         <p><img src="linear_transform_demo_gui_eq05921701731586814288.png" alt="$$O = \left( \frac{I}{255} \right)^{\gamma} \times 255$$" class="equation" width="124" height="36"></p>
         <p>As this relation is non linear, the effect will not be the same for all the pixels and will depend to their original value.</p>
         <p><img src="https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_gamma.png"></p>
         <p>When <img src="linear_transform_demo_gui_eq06168210814155657659.png" alt="$\gamma < 1$" class="equation" width="35" height="14">, the original dark regions will be brighter and the histogram will be shifted to the right whereas it will be the opposite
            with $ gamma &gt; 1$.
         </p>
         <p>For the gamma correction, a look-up table can be used to improve the performance of the computation as only 256 values needs
            to be calculated once.
         </p>
         <p>Let's an example of how to correct an underexposed image.</p>
         <p>The following image has been corrected with: <img src="linear_transform_demo_gui_eq00029824158541375002.png" alt="$\alpha = 1.3$" class="equation" width="47" height="11"> and <img src="linear_transform_demo_gui_eq03458771427828856677.png" alt="$\beta = 40$" class="equation" width="43" height="14">.
         </p>
         <p><img src="https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_linear_transform_correction.jpg"></p>
         <p>The overall brightness has been improved but you can notice that the clouds are now greatly saturated due to the numerical
            saturation of the implementation used (<a href="https://en.wikipedia.org/wiki/Clipping_(photography)">highlight clipping</a> in photography).
         </p>
         <p>The following image has been corrected with: <img src="linear_transform_demo_gui_eq13036361476345015487.png" alt="$\gamma = 0.4$" class="equation" width="47" height="14">.
         </p>
         <p><img src="https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_gamma_correction.jpg"></p>
         <p>The gamma correction should tend to add less saturation effect as the mapping is non linear and there is no numerical saturation
            possible as in the previous method.
         </p>
         <p><img src="https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_histogram_compare.png"></p>
         <div>
            <ul>
               <li>Left: histogram after alpha, beta correction</li>
               <li>Center: histogram of the original image</li>
               <li>Right: histogram after the gamma correction</li>
            </ul>
         </div>
         <p>The previous figure compares the histograms for the three images (the y-ranges are not the same between the three histograms).
            You can notice that most of the pixel values are in the lower part of the histogram for the original image. After <img src="linear_transform_demo_gui_eq14221827199139923399.png" alt="$\alpha$" class="equation" width="9" height="7">, <img src="linear_transform_demo_gui_eq17331442575217596290.png" alt="$\beta$" class="equation" width="9" height="14"> correction, we can observe a big peak at 255 due to the saturation as well as a shift in the right. After gamma correction,
            the histogram is shifted to the right but the pixels in the dark regions are more shifted (see the gamma curves figure) than
            those in the bright regions.
         </p>
         <p>In this tutorial, you have seen two simple methods to adjust the contrast and the brightness of an image. They are basic techniques
            and are not intended to be used as a replacement of a raster graphics editor!
         </p>
         <h2 id="6">Additional resources</h2>
         <div>
            <ul>
               <li><a href="https://learnopengl.com/#!Advanced-Lighting/Gamma-Correction">Gamma correction in graphics rendering</a></li>
               <li><a href="http://web.archive.org/web/20170106081601/http://www.graphics.cornell.edu/~westin/gamma/gamma.html">Gamma correction and images displayed on CRT monitors</a></li>
               <li><a href="http://www.cambridgeincolour.com/tutorials/digital-exposure-techniques.htm">Digital exposure techniques</a></li>
            </ul>
         </div>
         <h2 id="7">Code</h2><pre class="codeinput"><span class="keyword">function</span> varargout = linear_transform_demo_gui(im)
    <span class="comment">% load source image</span>
    <span class="keyword">if</span> nargin &lt; 1
        im = fullfile(mexopencv.root(),<span class="string">'test'</span>,<span class="string">'lena.jpg'</span>);
        img = cv.imread(im);
    <span class="keyword">elseif</span> ischar(im)
        img = cv.imread(im, <span class="string">'Color'</span>,true);
    <span class="keyword">else</span>
        img = im;
    <span class="keyword">end</span>

    <span class="comment">% create the UI</span>
    h = buildGUI(img);
    <span class="keyword">if</span> nargout &gt; 0, varargout{1} = h; <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> onLinearTransform(~,~,h)
    <span class="comment">%ONLINEARTRANSFORM  Event handler for UI controls</span>

    <span class="comment">% retrieve current values from UI controls</span>
    a = get(h.slid(1), <span class="string">'Value'</span>);
    b = round(get(h.slid(2), <span class="string">'Value'</span>));
    set(h.txt(1), <span class="string">'String'</span>,sprintf(<span class="string">'Contrast: %.2f'</span>,a));
    set(h.txt(2), <span class="string">'String'</span>,sprintf(<span class="string">'Brightness: %2d'</span>,b));

    <span class="comment">% linear transformation</span>
    out = cv.convertTo(h.src, <span class="string">'Alpha'</span>,a, <span class="string">'Beta'</span>,b);

    <span class="comment">% show result</span>
    out = cv.putText(out, <span class="string">'Brightness/Contrast Adjustment'</span>, [10 20], <span class="keyword">...</span>
        <span class="string">'FontScale'</span>,0.5, <span class="string">'Color'</span>,[0 255 0], <span class="string">'LineType'</span>,<span class="string">'AA'</span>);
    set(h.img(1), <span class="string">'CData'</span>,out);
    drawnow;
<span class="keyword">end</span>

<span class="keyword">function</span> onGammaCorrection(~,~,h)
    <span class="comment">%ONGAMMACORRECTION  Event handler for UI controls</span>

    <span class="comment">% retrieve current values from UI controls</span>
    g = get(h.slid(3), <span class="string">'Value'</span>);
    set(h.txt(3), <span class="string">'String'</span>,sprintf(<span class="string">'Gamma: %.2f'</span>,g));

    <span class="comment">% gamma correction</span>
    lookUpTable = uint8((((0:255)/255) .^ g) * 255);
    <span class="keyword">if</span> true
        out = cv.LUT(h.src, lookUpTable);
    <span class="keyword">elseif</span> mexopencv.require(<span class="string">'images'</span>)
        out = intlut(h.src, lookUpTable);
    <span class="keyword">else</span>
        out = lookUpTable(double(h.src) + 1);
    <span class="keyword">end</span>

    <span class="comment">% show result</span>
    out = cv.putText(out, <span class="string">'Gamma Correction'</span>, [10 20], <span class="keyword">...</span>
        <span class="string">'FontScale'</span>,0.5, <span class="string">'Color'</span>,[0 255 0], <span class="string">'LineType'</span>,<span class="string">'AA'</span>);
    set(h.img(2), <span class="string">'CData'</span>,out);
    drawnow;
<span class="keyword">end</span>

<span class="keyword">function</span> h = buildGUI(img)
    <span class="comment">%BUILDGUI  Creates the UI</span>

    <span class="comment">% parameters</span>
    a = 1.0;  <span class="comment">% alpha gain (contrast)</span>
    b = 0;    <span class="comment">% beta bias (brightness)</span>
    g = 1.0;  <span class="comment">% gamma correction</span>
    sz = size(img);
    sz(2) = max(sz(2), 300);  <span class="comment">% minimum figure width</span>

    <span class="comment">% build the user interface (no resizing to keep it simple)</span>
    h = struct();
    h.src = img;
    h.fig = figure(<span class="string">'Name'</span>,<span class="string">'Linear Transform Demo'</span>, <span class="keyword">...</span>
        <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>, <span class="string">'Menubar'</span>,<span class="string">'none'</span>, <span class="string">'Resize'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[200 200 sz(2)*2 sz(1)+80-1]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        <span class="comment">%HACK: not implemented in Octave</span>
        movegui(h.fig, <span class="string">'center'</span>);
    <span class="keyword">end</span>
    h.ax(1) = axes(<span class="string">'Parent'</span>,h.fig, <span class="string">'Units'</span>,<span class="string">'pixels'</span>, <span class="string">'Position'</span>,[1 80 sz(2) sz(1)]);
    h.ax(2) = axes(<span class="string">'Parent'</span>,h.fig, <span class="string">'Units'</span>,<span class="string">'pixels'</span>, <span class="string">'Position'</span>,[sz(2)+1 80 sz(2) sz(1)]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        h.img(1) = imshow(img, <span class="string">'Parent'</span>,h.ax(1));
        h.img(2) = imshow(img, <span class="string">'Parent'</span>,h.ax(2));
    <span class="keyword">else</span>
        <span class="comment">%HACK: https://savannah.gnu.org/bugs/index.php?45473</span>
        axes(h.ax(1)); h.img(1) = imshow(img);
        axes(h.ax(2)); h.img(2) = imshow(img);
    <span class="keyword">end</span>
    h.txt(1) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="string">'FontSize'</span>,11, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 5 130 20], <span class="string">'String'</span>,sprintf(<span class="string">'Contrast: %.2f'</span>,a));
    h.txt(2) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="string">'FontSize'</span>,11, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 30 130 20], <span class="string">'String'</span>,sprintf(<span class="string">'Brightness: %2d'</span>,b));
    h.txt(3) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="string">'FontSize'</span>,11, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 55 130 20], <span class="string">'String'</span>,sprintf(<span class="string">'Gamma: %.2f'</span>,g));
    h.slid(1) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="string">'Value'</span>,a, <span class="keyword">...</span>
        <span class="string">'Min'</span>,0.1, <span class="string">'Max'</span>,3, <span class="string">'SliderStep'</span>,[0.01 0.2]./(3-0.1), <span class="keyword">...</span>
        <span class="string">'Position'</span>,[135 5 sz(2)-135-5 20]);
    h.slid(2) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="string">'Value'</span>,b, <span class="keyword">...</span>
        <span class="string">'Min'</span>,-100, <span class="string">'Max'</span>,100, <span class="string">'SliderStep'</span>,[1 20]./(100+100), <span class="keyword">...</span>
        <span class="string">'Position'</span>,[135 30 sz(2)-135-5 20]);
    h.slid(3) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="string">'Value'</span>,g, <span class="keyword">...</span>
        <span class="string">'Min'</span>,0.1, <span class="string">'Max'</span>,3, <span class="string">'SliderStep'</span>,[0.01 0.2]./(3-0.1), <span class="keyword">...</span>
        <span class="string">'Position'</span>,[135 55 sz(2)-135-5 20]);

    <span class="comment">% hook event handlers, and trigger default start</span>
    opts = {<span class="string">'Interruptible'</span>,<span class="string">'off'</span>, <span class="string">'BusyAction'</span>,<span class="string">'cancel'</span>};
    set(h.slid(1:2), <span class="string">'Callback'</span>,{@onLinearTransform,h}, opts{:});
    set(h.slid(3), <span class="string">'Callback'</span>,{@onGammaCorrection,h}, opts{:});
    onLinearTransform([],[],h);
    onGammaCorrection([],[],h);
<span class="keyword">end</span></pre><img src="linear_transform_demo_gui_01.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div><script type="text/x-mathjax-config">
  // https://stackoverflow.com/a/14631703/97160
  MathJax.Extension.myImg2jax = {
    version: "1.0",
    PreProcess: function (element) {
      var images = element.getElementsByTagName("img");
      for (var i = images.length - 1; i >= 0; i--) {
        var img = images[i];
        if (img.className === "equation") {
          var match = img.alt.match(/^(\$\$?)([\s\S]*)\1$/m);
          if (!match) continue;
          var script = document.createElement("script");
          script.type = "math/tex";
          if (match[1] === "$$") {script.type += ";mode=display"}
          MathJax.HTML.setScript(script, match[2]);
          img.parentNode.replaceChild(script, img);
        }
      }
    }
  };
  MathJax.Hub.Register.PreProcessor(["PreProcess", MathJax.Extension.myImg2jax]);
  </script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML"></script>
      <!--
##### SOURCE BEGIN #####
%% Brightness and contrast adjustments
%
% In this demo we show how to perform the operation
% $g(i,j) = \alpha \cdot f(i,j) + \beta$.
%
% Sources:
%
% * <https://docs.opencv.org/3.3.0/d3/dc1/tutorial_basic_linear_transform.html>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ImgProc/BasicLinearTransforms.cpp>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/HighGUI/BasicLinearTransformsTrackbar.cpp>
% * <https://github.com/opencv/opencv/blob/3.3.0/samples/cpp/tutorial_code/ImgProc/changing_contrast_brightness_image/changing_contrast_brightness_image.cpp>
%

%% Theory
%
% A general image processing operator is a function that takes one or more
% input images and produces an output image. Image transforms can be seen as:
%
% * Point operators (pixel transforms)
% * Neighborhood (area-based) operators
%
% In pixel transforms, each output pixel's value depends on only the
% corresponding input pixel value (plus, potentially, some globally collected
% information or parameters). Examples of such operators include
% *brightness and contrast adjustments* as well as color correction and
% transformations.
%
% For brightness and contrast adjustments, two commonly used point processes
% are *multiplication* and *addition* with a constant:
%
% $$g(x) = \alpha f(x) + \beta$$
%
% The parameters $\alpha > 0$ and $\beta$ are often called the *gain* and
% *bias* parameters; sometimes these parameters are said to control *contrast*
% and *brightness* respectively. You can think of $f(x)$ as the source image
% pixels and $g(x)$ as the output image pixels. Then, more conveniently we can
% write the expression as:
%
% $$g(i,j) = \alpha \cdot f(i,j) + \beta$$
%
% where $i$ and $j$ indicates that the pixel is located in the *i-th* row and
% *j-th* column.
%
% In the implementation below, instead of using a for-loop to access each
% pixel, we simply use the function |cv.convertTo| which effectively performs
% *new_image = saturate(a*image + beta)*. This is more optimized than
% accessing each pixel and works a lot faster. Also notice that the operation
% can give values out of range or not integers (if $\alpha$ is float), in
% which case |cv.convertTo| makes sure the values are valid.
%

%% Example
%
% We will put into practice what we have learned to correct an underexposed
% image by adjusting the brightness and the contrast of the image. We will
% also see another technique to correct the brightness of an image called
% gamma correction.
%
%% Brightness and contrast adjustments
%
% Increasing/decreasing the $\beta$ value will add/subtract a constant value
% to every pixel. Pixel values outside of the |[0 ; 255]| range will be
% saturated (i.e. a pixel value higher/lesser than 255/0 will be clamp to
% 255/0).
%
% <<https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_hist_beta.png>>
%
% _In light gray, histogram of the original image, in dark gray when
% |brightness = 80| in Gimp_
%
% The histogram represents for each color level the number of pixels with that
% color level. A dark image will have many pixels with low color value and
% thus the histogram will present a peak in his left part. When adding a
% constant bias, the histogram is shifted to the right as we have added a
% constant bias to all the pixels.
%
% The $\alpha$ parameter will modify how the levels spread. If $\alpha < 1$,
% the color levels will be compressed and the result will be an image with
% less contrast.
%
% <<https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_hist_alpha.png>>
%
% _In light gray, histogram of the original image, in dark gray when
% |contrast < 0| in Gimp_
%
% Note that these histograms have been obtained using the Brightness-Contrast
% tool in the Gimp software. The brightness tool should be identical to the
% $\beta$ bias parameters but the contrast tool seems to differ to the
% $\alpha$ gain where the output range seems to be centered with Gimp (as you
% can notice in the previous histogram).
%
% It can occur that playing with the $\beta$ bias will improve the brightness
% but in the same time the image will appear with a slight veil as the
% contrast will be reduced. The $\alpha$ gain can be used to diminue this
% effect but due to the saturation, we will lose some details in the original
% bright regions.
%
%% Gamma correction
%
% <https://en.wikipedia.org/wiki/Gamma_correction Gamma correction> can be
% used to correct the brightness of an image by using a non linear
% transformation between the input values and the mapped output values:
%
% $$O = \left( \frac{I}{255} \right)^{\gamma} \times 255$$
%
% As this relation is non linear, the effect will not be the same for all the
% pixels and will depend to their original value.
%
% <<https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_gamma.png>>
%
% When $\gamma < 1$, the original dark regions will be brighter and the
% histogram will be shifted to the right whereas it will be the opposite with
% $ gamma > 1$.
%
% For the gamma correction, a look-up table can be used to improve the
% performance of the computation as only 256 values needs to be calculated
% once.
%
% Let's an example of how to correct an underexposed image.
%
% The following image has been corrected with: $\alpha = 1.3$ and $\beta = 40$.
%
% <<https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_linear_transform_correction.jpg>>
%
% The overall brightness has been improved but you can notice that the clouds
% are now greatly saturated due to the numerical saturation of the
% implementation used
% (<https://en.wikipedia.org/wiki/Clipping_(photography) highlight clipping>
% in photography).
%
% The following image has been corrected with: $\gamma = 0.4$.
%
% <<https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_gamma_correction.jpg>>
%
% The gamma correction should tend to add less saturation effect as the
% mapping is non linear and there is no numerical saturation possible as in
% the previous method.
%
% <<https://docs.opencv.org/3.3.0/Basic_Linear_Transform_Tutorial_histogram_compare.png>>
%
% * Left: histogram after alpha, beta correction
% * Center: histogram of the original image
% * Right: histogram after the gamma correction
%
% The previous figure compares the histograms for the three images (the
% y-ranges are not the same between the three histograms). You can notice that
% most of the pixel values are in the lower part of the histogram for the
% original image. After $\alpha$, $\beta$ correction, we can observe a big
% peak at 255 due to the saturation as well as a shift in the right. After
% gamma correction, the histogram is shifted to the right but the pixels in
% the dark regions are more shifted (see the gamma curves figure) than those
% in the bright regions.
%
% In this tutorial, you have seen two simple methods to adjust the contrast
% and the brightness of an image. They are basic techniques and are not
% intended to be used as a replacement of a raster graphics editor!
%
%% Additional resources
%
% * <https://learnopengl.com/#!Advanced-Lighting/Gamma-Correction
%   Gamma correction in graphics rendering>
% * <http://web.archive.org/web/20170106081601/http://www.graphics.cornell.edu/~westin/gamma/gamma.html
%   Gamma correction and images displayed on CRT monitors>
% * <http://www.cambridgeincolour.com/tutorials/digital-exposure-techniques.htm
%   Digital exposure techniques>
%

%% Code

function varargout = linear_transform_demo_gui(im)
    % load source image
    if nargin < 1
        im = fullfile(mexopencv.root(),'test','lena.jpg');
        img = cv.imread(im);
    elseif ischar(im)
        img = cv.imread(im, 'Color',true);
    else
        img = im;
    end

    % create the UI
    h = buildGUI(img);
    if nargout > 0, varargout{1} = h; end
end

function onLinearTransform(~,~,h)
    %ONLINEARTRANSFORM  Event handler for UI controls

    % retrieve current values from UI controls
    a = get(h.slid(1), 'Value');
    b = round(get(h.slid(2), 'Value'));
    set(h.txt(1), 'String',sprintf('Contrast: %.2f',a));
    set(h.txt(2), 'String',sprintf('Brightness: %2d',b));

    % linear transformation
    out = cv.convertTo(h.src, 'Alpha',a, 'Beta',b);

    % show result
    out = cv.putText(out, 'Brightness/Contrast Adjustment', [10 20], ...
        'FontScale',0.5, 'Color',[0 255 0], 'LineType','AA');
    set(h.img(1), 'CData',out);
    drawnow;
end

function onGammaCorrection(~,~,h)
    %ONGAMMACORRECTION  Event handler for UI controls

    % retrieve current values from UI controls
    g = get(h.slid(3), 'Value');
    set(h.txt(3), 'String',sprintf('Gamma: %.2f',g));

    % gamma correction
    lookUpTable = uint8((((0:255)/255) .^ g) * 255);
    if true
        out = cv.LUT(h.src, lookUpTable);
    elseif mexopencv.require('images')
        out = intlut(h.src, lookUpTable);
    else
        out = lookUpTable(double(h.src) + 1);
    end

    % show result
    out = cv.putText(out, 'Gamma Correction', [10 20], ...
        'FontScale',0.5, 'Color',[0 255 0], 'LineType','AA');
    set(h.img(2), 'CData',out);
    drawnow;
end

function h = buildGUI(img)
    %BUILDGUI  Creates the UI

    % parameters
    a = 1.0;  % alpha gain (contrast)
    b = 0;    % beta bias (brightness)
    g = 1.0;  % gamma correction
    sz = size(img);
    sz(2) = max(sz(2), 300);  % minimum figure width

    % build the user interface (no resizing to keep it simple)
    h = struct();
    h.src = img;
    h.fig = figure('Name','Linear Transform Demo', ...
        'NumberTitle','off', 'Menubar','none', 'Resize','off', ...
        'Position',[200 200 sz(2)*2 sz(1)+80-1]);
    if ~mexopencv.isOctave()
        %HACK: not implemented in Octave
        movegui(h.fig, 'center');
    end
    h.ax(1) = axes('Parent',h.fig, 'Units','pixels', 'Position',[1 80 sz(2) sz(1)]);
    h.ax(2) = axes('Parent',h.fig, 'Units','pixels', 'Position',[sz(2)+1 80 sz(2) sz(1)]);
    if ~mexopencv.isOctave()
        h.img(1) = imshow(img, 'Parent',h.ax(1));
        h.img(2) = imshow(img, 'Parent',h.ax(2));
    else
        %HACK: https://savannah.gnu.org/bugs/index.php?45473
        axes(h.ax(1)); h.img(1) = imshow(img);
        axes(h.ax(2)); h.img(2) = imshow(img);
    end
    h.txt(1) = uicontrol('Parent',h.fig, 'Style','text', 'FontSize',11, ...
        'Position',[5 5 130 20], 'String',sprintf('Contrast: %.2f',a));
    h.txt(2) = uicontrol('Parent',h.fig, 'Style','text', 'FontSize',11, ...
        'Position',[5 30 130 20], 'String',sprintf('Brightness: %2d',b));
    h.txt(3) = uicontrol('Parent',h.fig, 'Style','text', 'FontSize',11, ...
        'Position',[5 55 130 20], 'String',sprintf('Gamma: %.2f',g));
    h.slid(1) = uicontrol('Parent',h.fig, 'Style','slider', 'Value',a, ...
        'Min',0.1, 'Max',3, 'SliderStep',[0.01 0.2]./(3-0.1), ...
        'Position',[135 5 sz(2)-135-5 20]);
    h.slid(2) = uicontrol('Parent',h.fig, 'Style','slider', 'Value',b, ...
        'Min',-100, 'Max',100, 'SliderStep',[1 20]./(100+100), ...
        'Position',[135 30 sz(2)-135-5 20]);
    h.slid(3) = uicontrol('Parent',h.fig, 'Style','slider', 'Value',g, ...
        'Min',0.1, 'Max',3, 'SliderStep',[0.01 0.2]./(3-0.1), ...
        'Position',[135 55 sz(2)-135-5 20]);

    % hook event handlers, and trigger default start
    opts = {'Interruptible','off', 'BusyAction','cancel'};
    set(h.slid(1:2), 'Callback',{@onLinearTransform,h}, opts{:});
    set(h.slid(3), 'Callback',{@onGammaCorrection,h}, opts{:});
    onLinearTransform([],[],h);
    onGammaCorrection([],[],h);
end

##### SOURCE END #####
--></body>
</html>