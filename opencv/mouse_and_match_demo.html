<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Interactive Rectangle Selection</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="mouse_and_match_demo.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Interactive Rectangle Selection</h1>
         <!--introduction-->
         <p>Demonstrate using a mouse to interact with an image. Allows the user to select parts of an image with a mouse. When they let
            go of the mouse, it correlates (using <tt>cv.matchTemplate</tt>) that patch with the image.
         </p>
         <p>The sample uses the <tt>RectSelector</tt> class.
         </p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://github.com/opencv/opencv/blob/3.3.1/samples/python/mouse_and_match.py">https://github.com/opencv/opencv/blob/3.3.1/samples/python/mouse_and_match.py</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <p>load and show image</p><pre class="codeinput">fname = fullfile(mexopencv.root(), <span class="string">'test'</span>, <span class="string">'fruits.jpg'</span>);
img = cv.imread(fname, <span class="string">'Color'</span>,true);
gray = cv.cvtColor(img, <span class="string">'RGB2GRAY'</span>);
hImg = imshow(gray);</pre><img src="mouse_and_match_demo_01.png"><p>prompt user to select ROI rectangle</p><pre class="codeinput">disp(<span class="string">'Select part of the image using the mouse'</span>);
<span class="keyword">if</span> true
    roi = RectSelector(hImg);
    roi.clip = true;
    setLineProps(roi, <span class="string">'Color'</span>,<span class="string">'g'</span>, <span class="string">'LineWidth'</span>,2);
    rect = wait(roi);
    delete(roi);
<span class="keyword">else</span>
    roi = imrect(ancestor(hImg,<span class="string">'axes'</span>));
    setColor(roi, <span class="string">'g'</span>);
    rect = wait(roi);
    delete(roi);
<span class="keyword">end</span>
assert(~isempty(rect), <span class="string">'No selection'</span>);
rectangle(<span class="string">'Position'</span>,rect, <span class="string">'EdgeColor'</span>,<span class="string">'g'</span>, <span class="string">'LineWidth'</span>,2)</pre><pre class="codeoutput">Select part of the image using the mouse
</pre><img src="mouse_and_match_demo_02.png"><p>extract patch and perform template matching against image</p><pre class="codeinput">tmpl = cv.Rect.crop(gray, rect);
res = cv.matchTemplate(gray, tmpl, <span class="string">'Method'</span>,<span class="string">'CCoeffNormed'</span>);
res = abs(res).^3;
res = cv.threshold(res, 0.01, <span class="string">'Type'</span>,<span class="string">'ToZero'</span>);
res8 = cv.normalize(res, <span class="string">'Alpha'</span>,0, <span class="string">'Beta'</span>,255, <span class="keyword">...</span>
    <span class="string">'NormType'</span>,<span class="string">'MinMax'</span>, <span class="string">'DType'</span>,<span class="string">'uint8'</span>);
figure, imshow(res8)</pre><img src="mouse_and_match_demo_03.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Interactive Rectangle Selection
%
% Demonstrate using a mouse to interact with an image.
% Allows the user to select parts of an image with a mouse.
% When they let go of the mouse, it correlates (using |cv.matchTemplate|)
% that patch with the image.
%
% The sample uses the |RectSelector| class.
%
% Sources:
%
% * <https://github.com/opencv/opencv/blob/3.3.1/samples/python/mouse_and_match.py>
%

%%
% load and show image
fname = fullfile(mexopencv.root(), 'test', 'fruits.jpg');
img = cv.imread(fname, 'Color',true);
gray = cv.cvtColor(img, 'RGB2GRAY');
hImg = imshow(gray);

%%
% prompt user to select ROI rectangle
disp('Select part of the image using the mouse');
if true
    roi = RectSelector(hImg);
    roi.clip = true;
    setLineProps(roi, 'Color','g', 'LineWidth',2);
    rect = wait(roi);
    delete(roi);
else
    roi = imrect(ancestor(hImg,'axes'));
    setColor(roi, 'g');
    rect = wait(roi);
    delete(roi);
end
assert(~isempty(rect), 'No selection');
rectangle('Position',rect, 'EdgeColor','g', 'LineWidth',2)

%%
% extract patch and perform template matching against image
tmpl = cv.Rect.crop(gray, rect);
res = cv.matchTemplate(gray, tmpl, 'Method','CCoeffNormed');
res = abs(res).^3;
res = cv.threshold(res, 0.01, 'Type','ToZero');
res8 = cv.normalize(res, 'Alpha',0, 'Beta',255, ...
    'NormType','MinMax', 'DType','uint8');
figure, imshow(res8)

##### SOURCE END #####
-->
   </body>
</html>