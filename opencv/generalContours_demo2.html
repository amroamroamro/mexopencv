<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Creating Bounding rotated boxes and ellipses for contours</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="generalContours_demo2.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Creating Bounding rotated boxes and ellipses for contours</h1>
         <!--introduction-->
         <p>Demo code to obtain ellipses and rotated rectangles that contain detected contours.</p>
         <p>In this sample you will learn how to:</p>
         <div>
            <ul>
               <li>use the OpenCV function <a href="matlab:doc('cv.minAreaRect')">cv.minAreaRect</a></li>
               <li>use the OpenCV function <a href="matlab:doc('cv.fitEllipse')">cv.fitEllipse</a></li>
            </ul>
         </div>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://docs.opencv.org/3.2.0/de/d62/tutorial_bounding_rotated_ellipses.html">https://docs.opencv.org/3.2.0/de/d62/tutorial_bounding_rotated_ellipses.html</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ShapeDescriptors/generalContours_demo2.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ShapeDescriptors/generalContours_demo2.cpp</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <h2 id="toc">Contents</h2>
         <div>
            <ul>
               <li><a href="#2">Input</a></li>
               <li><a href="#3">Edges + Contours</a></li>
               <li><a href="#4">Fit rectangles and ellipses</a></li>
               <li><a href="#5">Draw</a></li>
            </ul>
         </div>
         <h2 id="2">Input</h2><pre class="codeinput"><span class="comment">% Load source image</span>
src = imread(fullfile(mexopencv.root(),<span class="string">'test'</span>,<span class="string">'balloon.jpg'</span>));

<span class="comment">% Convert image to gray and blur it</span>
src_gray = cv.cvtColor(src, <span class="string">'RGB2GRAY'</span>);
src_gray = cv.blur(src_gray, <span class="string">'KSize'</span>,[3 3]);

<span class="comment">% Create figure</span>
imshow(src), title(<span class="string">'Source'</span>)</pre><img src="generalContours_demo2_01.png"><h2 id="3">Edges + Contours</h2><pre class="codeinput"><span class="comment">% Detect edges using Threshold</span>
thresh = 134;
threshold_output = cv.threshold(src_gray, thresh, <span class="keyword">...</span>
    <span class="string">'MaxValue'</span>,255, <span class="string">'Type'</span>,<span class="string">'Binary'</span>);
imshow(threshold_output), title(<span class="string">'Edges'</span>)

<span class="comment">% Find contours</span>
[contours, hierarchy] = cv.findContours(threshold_output, <span class="keyword">...</span>
    <span class="string">'Mode'</span>,<span class="string">'Tree'</span>, <span class="string">'Method'</span>,<span class="string">'Simple'</span>);</pre><img src="generalContours_demo2_02.png"><h2 id="4">Fit rectangles and ellipses</h2>
         <p>Find the rotated rectangles and ellipses for each contour</p><pre class="codeinput">minRect = cell(size(contours));
minEllipse = cell(size(contours));
<span class="keyword">for</span> i=1:numel(contours)
    minRect{i} = cv.minAreaRect(contours{i});
    <span class="keyword">if</span> numel(contours{i}) &gt; 5
        minEllipse{i} = cv.fitEllipse(contours{i});
    <span class="keyword">end</span>
<span class="keyword">end</span></pre><h2 id="5">Draw</h2>
         <p>Draw contours + rotated rects + ellipses</p><pre class="codeinput">drawing = zeros([size(threshold_output) 3], <span class="string">'uint8'</span>);
<span class="keyword">for</span> i=1:numel(contours)
    color = randi([0 255], [1 3]);
    <span class="comment">% contour</span>
    drawing = cv.drawContours(drawing, contours, <span class="keyword">...</span>
        <span class="string">'ContourIdx'</span>,i-1, <span class="string">'MaxLevel'</span>,0, <span class="string">'Hierarchy'</span>,hierarchy, <span class="keyword">...</span>
        <span class="string">'Color'</span>,color, <span class="string">'Thickness'</span>,1, <span class="string">'LineType'</span>,8);
    <span class="comment">% ellipse</span>
    <span class="keyword">if</span> ~isempty(minEllipse{i})
        drawing = cv.ellipse(drawing, minEllipse{i}, <span class="keyword">...</span>
            <span class="string">'Color'</span>,color, <span class="string">'Thickness'</span>,2, <span class="string">'LineType'</span>,8);
    <span class="keyword">end</span>
    <span class="comment">% rotated rectangle</span>
    rect_points = cv.RotatedRect.points(minRect{i});
    <span class="keyword">for</span> j=1:4
        drawing = cv.line(drawing, <span class="keyword">...</span>
            rect_points(j,:), rect_points(mod(j,4)+1,:), <span class="keyword">...</span>
            <span class="string">'Color'</span>,color, <span class="string">'Thickness'</span>,1, <span class="string">'LineType'</span>,8);
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">% Show in a figure</span>
imshow(drawing), title(<span class="string">'Contours'</span>)</pre><img src="generalContours_demo2_03.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Creating Bounding rotated boxes and ellipses for contours
% Demo code to obtain ellipses and rotated rectangles that contain detected
% contours.
%
% In this sample you will learn how to:
%
% * use the OpenCV function <matlab:doc('cv.minAreaRect') cv.minAreaRect>
% * use the OpenCV function <matlab:doc('cv.fitEllipse') cv.fitEllipse>
%
% Sources:
%
% * <https://docs.opencv.org/3.2.0/de/d62/tutorial_bounding_rotated_ellipses.html>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ShapeDescriptors/generalContours_demo2.cpp>
%

%% Input

% Load source image
src = imread(fullfile(mexopencv.root(),'test','balloon.jpg'));

% Convert image to gray and blur it
src_gray = cv.cvtColor(src, 'RGB2GRAY');
src_gray = cv.blur(src_gray, 'KSize',[3 3]);

% Create figure
imshow(src), title('Source')

%% Edges + Contours

% Detect edges using Threshold
thresh = 134;
threshold_output = cv.threshold(src_gray, thresh, ...
    'MaxValue',255, 'Type','Binary');
imshow(threshold_output), title('Edges')

% Find contours
[contours, hierarchy] = cv.findContours(threshold_output, ...
    'Mode','Tree', 'Method','Simple');

%% Fit rectangles and ellipses
% Find the rotated rectangles and ellipses for each contour
minRect = cell(size(contours));
minEllipse = cell(size(contours));
for i=1:numel(contours)
    minRect{i} = cv.minAreaRect(contours{i});
    if numel(contours{i}) > 5
        minEllipse{i} = cv.fitEllipse(contours{i});
    end
end

%% Draw
% Draw contours + rotated rects + ellipses
drawing = zeros([size(threshold_output) 3], 'uint8');
for i=1:numel(contours)
    color = randi([0 255], [1 3]);
    % contour
    drawing = cv.drawContours(drawing, contours, ...
        'ContourIdx',i-1, 'MaxLevel',0, 'Hierarchy',hierarchy, ...
        'Color',color, 'Thickness',1, 'LineType',8);
    % ellipse
    if ~isempty(minEllipse{i})
        drawing = cv.ellipse(drawing, minEllipse{i}, ...
            'Color',color, 'Thickness',2, 'LineType',8);
    end
    % rotated rectangle
    rect_points = cv.RotatedRect.points(minRect{i});
    for j=1:4
        drawing = cv.line(drawing, ...
            rect_points(j,:), rect_points(mod(j,4)+1,:), ...
            'Color',color, 'Thickness',1, 'LineType',8);
    end
end

% Show in a figure
imshow(drawing), title('Contours')

##### SOURCE END #####
-->
   </body>
</html>