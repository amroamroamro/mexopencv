<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Multi-target planar tracking</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="plane_tracker_demo.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Multi-target planar tracking</h1>
         <p>Example of using features2d framework for multiple planar targets tracking in a video using homography matching. This sample
            uses the <tt>PlaneTracker</tt> class.
         </p>
         <p>Sample video: <a href="http://www.youtube.com/watch?v=pzVbhxx6aog">http://www.youtube.com/watch?v=pzVbhxx6aog</a>.
         </p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://github.com/opencv/opencv/blob/3.3.1/samples/python/plane_tracker.py">https://github.com/opencv/opencv/blob/3.3.1/samples/python/plane_tracker.py</a></li>
            </ul>
         </div><pre class="codeinput"><span class="comment">% video file, and multiple targets to track [x,y,w,h]</span>
vid = fullfile(mexopencv.root(), <span class="string">'test'</span>, <span class="string">'blais.mp4'</span>);
assert(exist(vid, <span class="string">'file'</span>) == 2, <span class="string">'Missing video file'</span>);
win = [
    136 0 366 433;   <span class="comment">% book</span>
    135 165 285 175  <span class="comment">% face</span>
];
N = size(win,1);

<span class="comment">% open video feed, and get firs frame</span>
cap = cv.VideoCapture(vid);
pause(1);
assert(cap.isOpened(), <span class="string">'Failed to open video'</span>);
frame = cap.read();
assert(~isempty(frame), <span class="string">'Failed to read frames'</span>);

<span class="comment">% create and initialize tracker</span>
tracker = PlaneTracker();
<span class="keyword">for</span> i=1:N
    tracker.addTarget(frame, win(i,:));
<span class="keyword">end</span>

<span class="comment">% prepare plot</span>
hImg = imshow(frame);
clr = lines(N);
<span class="keyword">for</span> i=1:N
    <span class="comment">% keypoints and bounding box for each tracked target</span>
    hPts(i) = line(NaN, NaN, <span class="string">'Color'</span>,clr(i,:), <span class="string">'LineStyle'</span>,<span class="string">'none'</span>, <span class="string">'Marker'</span>,<span class="string">'o'</span>);
    hLin(i) = line(NaN, NaN, <span class="string">'Color'</span>,clr(i,:), <span class="string">'LineWidth'</span>,3);
<span class="keyword">end</span>

<span class="comment">% main loop</span>
<span class="keyword">while</span> ishghandle(hImg)
    <span class="comment">% read new frame</span>
    frame = cap.read();
    <span class="keyword">if</span> isempty(frame), <span class="keyword">break</span>; <span class="keyword">end</span>

    <span class="comment">% track and update keypoints/boundaries of matched targets</span>
    tracked = tracker.track(frame);
    <span class="keyword">for</span> i=1:numel(tracked)
        tr = tracked(i);
        set(hPts(tr.index), <span class="string">'XData'</span>,tr.pt1(:,1), <span class="string">'YData'</span>,tr.pt1(:,2));
        set(hLin(tr.index), <span class="keyword">...</span>
            <span class="string">'XData'</span>,tr.quad([1:end 1],1), <span class="string">'YData'</span>,tr.quad([1:end 1],2));
    <span class="keyword">end</span>

    <span class="comment">% update tracked objects which were not found in current frame</span>
    idx = setdiff(1:N, [tracked.index]);
    <span class="keyword">if</span> ~isempty(idx)
        set(hPts(idx), <span class="string">'XData'</span>,NaN, <span class="string">'YData'</span>,NaN);
        set(hLin(idx), <span class="string">'XData'</span>,NaN, <span class="string">'YData'</span>,NaN);
    <span class="keyword">end</span>

    <span class="comment">% display result</span>
    set(hImg, <span class="string">'CData'</span>,frame);
    drawnow;
<span class="keyword">end</span>
cap.release();</pre><img src="plane_tracker_demo_01.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Multi-target planar tracking
%
% Example of using features2d framework for multiple planar targets tracking
% in a video using homography matching. This sample uses the |PlaneTracker|
% class.
%
% Sample video: <http://www.youtube.com/watch?v=pzVbhxx6aog>.
%
% Sources:
%
% * <https://github.com/opencv/opencv/blob/3.3.1/samples/python/plane_tracker.py>
%

% video file, and multiple targets to track [x,y,w,h]
vid = fullfile(mexopencv.root(), 'test', 'blais.mp4');
assert(exist(vid, 'file') == 2, 'Missing video file');
win = [
    136 0 366 433;   % book
    135 165 285 175  % face
];
N = size(win,1);

% open video feed, and get firs frame
cap = cv.VideoCapture(vid);
pause(1);
assert(cap.isOpened(), 'Failed to open video');
frame = cap.read();
assert(~isempty(frame), 'Failed to read frames');

% create and initialize tracker
tracker = PlaneTracker();
for i=1:N
    tracker.addTarget(frame, win(i,:));
end

% prepare plot
hImg = imshow(frame);
clr = lines(N);
for i=1:N
    % keypoints and bounding box for each tracked target
    hPts(i) = line(NaN, NaN, 'Color',clr(i,:), 'LineStyle','none', 'Marker','o');
    hLin(i) = line(NaN, NaN, 'Color',clr(i,:), 'LineWidth',3);
end

% main loop
while ishghandle(hImg)
    % read new frame
    frame = cap.read();
    if isempty(frame), break; end

    % track and update keypoints/boundaries of matched targets
    tracked = tracker.track(frame);
    for i=1:numel(tracked)
        tr = tracked(i);
        set(hPts(tr.index), 'XData',tr.pt1(:,1), 'YData',tr.pt1(:,2));
        set(hLin(tr.index), ...
            'XData',tr.quad([1:end 1],1), 'YData',tr.quad([1:end 1],2));
    end

    % update tracked objects which were not found in current frame
    idx = setdiff(1:N, [tracked.index]);
    if ~isempty(idx)
        set(hPts(idx), 'XData',NaN, 'YData',NaN);
        set(hLin(idx), 'XData',NaN, 'YData',NaN);
    end

    % display result
    set(hImg, 'CData',frame);
    drawnow;
end
cap.release();

##### SOURCE END #####
-->
   </body>
</html>