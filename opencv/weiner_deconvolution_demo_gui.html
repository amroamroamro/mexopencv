<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Wiener Deconvolution for Image Deblurring</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="weiner_deconvolution_demo_gui.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Wiener Deconvolution for Image Deblurring</h1>
         <p>Sample shows how DFT can be used to perform <a href="https://en.wikipedia.org/wiki/Wiener_deconvolution">Weiner deconvolution</a> of an image with user-defined point spread function (PSF).
         </p>
         <p>Use controls to adjust PSF parameters, and swtich between linear/cirular PSF.</p>
         <p>See also: <tt>deconvwnr</tt>, <a href="https://www.mathworks.com/help/images/image-restoration-deblurring.html">https://www.mathworks.com/help/images/image-restoration-deblurring.html</a></p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/python/deconvolution.py">https://github.com/opencv/opencv/blob/3.2.0/samples/python/deconvolution.py</a></li>
            </ul>
         </div><pre class="codeinput"><span class="keyword">function</span> varargout = weiner_deconvolution_demo_gui(im)
    <span class="comment">% load grayscale image</span>
    <span class="keyword">if</span> nargin &lt; 1
        im = fullfile(mexopencv.root(), <span class="string">'test'</span>, <span class="string">'licenseplate_motion.jpg'</span>);
        <span class="keyword">if</span> exist(im, <span class="string">'file'</span>) ~= 2
            disp(<span class="string">'Downloading image...'</span>)
            url = <span class="string">'https://cdn.rawgit.com/opencv/opencv/3.2.0/samples/data/licenseplate_motion.jpg'</span>;
            urlwrite(url, im);
        <span class="keyword">end</span>
        img = cv.imread(im, <span class="string">'Grayscale'</span>,true);
    <span class="keyword">elseif</span> ischar(im)
        img = cv.imread(im, <span class="string">'Grayscale'</span>,true);
    <span class="keyword">else</span>
        img = im;
    <span class="keyword">end</span>
    img = single(img) / 255;  <span class="comment">% convert 8-bit to floating-point precision</span>

    <span class="comment">% create the UI</span>
    app = initApp(img);
    h = buildGUI(app);
    <span class="keyword">if</span> nargout &gt; 0, varargout{1} = h; <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> app = initApp(img)
    <span class="comment">%INIT_APP  Initialize options and state structure</span>

    app = struct();

    <span class="comment">% options</span>
    app.snr = 25;       <span class="comment">% signal/noise ratio in dB</span>
    app.angle = 135;    <span class="comment">% blur angle in degrees [0,180]</span>
    app.d = 22;         <span class="comment">% blur diameter [1,ksz]</span>
    app.ksz = 65;       <span class="comment">% kernel size</span>

    <span class="comment">% process image and compute its DFT</span>
    app.img0 = img;
    app.img = blur_edge(img);
    app.IMG = cv.dft(app.img, <span class="string">'ComplexOutput'</span>,true);
<span class="keyword">end</span>

<span class="keyword">function</span> img = blur_edge(img, d)
    <span class="comment">%BLUR_EDGE  Blur image edges to reduce ringing effect in deblurred image</span>
    <span class="comment">%</span>
    <span class="comment">%     img = blur_edge(img)</span>
    <span class="comment">%     img = blur_edge(img, d)</span>
    <span class="comment">%</span>
    <span class="comment">% ## Input</span>
    <span class="comment">% * __img__ input image</span>
    <span class="comment">% * __d__ gaussian size, default 31</span>
    <span class="comment">%</span>
    <span class="comment">% ## Output</span>
    <span class="comment">% * __img__ output image</span>
    <span class="comment">%</span>
    <span class="comment">% See also: edgetaper</span>
    <span class="comment">%</span>

    <span class="keyword">if</span> nargin &lt; 2, d = 31; <span class="keyword">end</span>
    img_blur = cv.copyMakeBorder(img, [d d d d], <span class="string">'BorderType'</span>,<span class="string">'Wrap'</span>);
    img_blur = cv.GaussianBlur(img_blur, <span class="string">'KSize'</span>,[d d]*2+1, <span class="string">'SigmaX'</span>,-1);
    img_blur = img_blur(d+1:end-d, d+1:end-d);

    [h,w] = size(img);
    [y,x] = ndgrid(1:h, 1:w);
    D = min(cat(3, x, w-x+1, y, h-y+1), [], 3);
    a = min(single(D)/d, 1);

    img = img.*a + img_blur.*(1-a);
<span class="keyword">end</span>

<span class="keyword">function</span> kern = motion_kernel(ang, d, sz)
    <span class="comment">%MOTION_KERNEL  Create linear motion filter</span>
    <span class="comment">%</span>
    <span class="comment">%     kern = motion_kernel(ang, d)</span>
    <span class="comment">%     kern = motion_kernel(ang, d, sz)</span>
    <span class="comment">%</span>
    <span class="comment">% ## Input</span>
    <span class="comment">% * __ang__ linear motion angle</span>
    <span class="comment">% * __d__ linear motion length</span>
    <span class="comment">% * __sz__ kernel size, default 65</span>
    <span class="comment">%</span>
    <span class="comment">% ## Output</span>
    <span class="comment">% * __kern__ kernel</span>
    <span class="comment">%</span>
    <span class="comment">% See also: fspecial (motion)</span>
    <span class="comment">%</span>

    <span class="keyword">if</span> nargin &lt; 3, sz = 65; <span class="keyword">end</span>
    sz2 = floor(sz / 2);
    A = [cos(ang) -sin(ang); sin(ang) cos(ang)];
    A(:,3) = [sz2; sz2] - A*[(d-1)*0.5; 0];
    kern = ones(1,d,<span class="string">'single'</span>);
    kern = cv.warpAffine(kern, A, <span class="string">'DSize'</span>,[sz sz], <span class="string">'Interpolation'</span>,<span class="string">'Cubic'</span>);
<span class="keyword">end</span>

<span class="keyword">function</span> kern = defocus_kernel(d, sz)
    <span class="comment">%DEFOCUS_KERNEL  Create circular defocus kernel</span>
    <span class="comment">%</span>
    <span class="comment">%     kern = defocus_kernel(d)</span>
    <span class="comment">%     kern = defocus_kernel(d, sz)</span>
    <span class="comment">%</span>
    <span class="comment">% ## Input</span>
    <span class="comment">% * __d__ circular motion diameter</span>
    <span class="comment">% * __sz__ kernel size, default 65</span>
    <span class="comment">%</span>
    <span class="comment">% ## Output</span>
    <span class="comment">% * __kern__ kernel</span>
    <span class="comment">%</span>
    <span class="comment">% See also: fspecial (gaussian)</span>
    <span class="comment">%</span>

    <span class="keyword">if</span> nargin &lt; 2, sz = 65; <span class="keyword">end</span>
    kern = zeros(sz,sz,<span class="string">'uint8'</span>);
    kern = cv.circle(kern, [sz sz], d, <span class="keyword">...</span>
        <span class="string">'Color'</span>,255, <span class="string">'Thickness'</span>,<span class="string">'Filled'</span>, <span class="string">'LineType'</span>,<span class="string">'AA'</span>, <span class="string">'Shift'</span>,1);
    kern = single(kern) / 255;
<span class="keyword">end</span>

<span class="keyword">function</span> onChange(~,~,h,app)
    <span class="comment">%ONCHANGE  Event handler for UI controls</span>

    <span class="comment">% retrieve current values from UI controls</span>
    psf_type = get(h.pop, <span class="string">'Value'</span>);
    psf_viz = get(h.cbox, <span class="string">'Value'</span>) == get(h.cbox, <span class="string">'Max'</span>);
    app.snr = round(get(h.slid(1), <span class="string">'Value'</span>));
    app.d = round(get(h.slid(2), <span class="string">'Value'</span>));
    app.angle = round(get(h.slid(3), <span class="string">'Value'</span>));
    set(h.txt(1), <span class="string">'String'</span>,sprintf(<span class="string">'SNR (dB): %d'</span>, app.snr));
    set(h.txt(2), <span class="string">'String'</span>,sprintf(<span class="string">'Diameter: %d'</span>, app.d));
    set(h.txt(3), <span class="string">'String'</span>,sprintf(<span class="string">'Angle: %d'</span>, app.angle));

    <span class="keyword">if</span> psf_type == 3
        <span class="comment">% show original blurred image</span>
        res = app.img0;
    <span class="keyword">else</span>
        <span class="comment">% linear/cirular PSF</span>
        <span class="keyword">if</span> psf_type == 1
            psf = motion_kernel(deg2rad(app.angle), app.d, app.ksz);
        <span class="keyword">else</span>
            psf = defocus_kernel(app.d, app.ksz);
        <span class="keyword">end</span>

        <span class="comment">% deconvolution</span>
        noise = 10^(-0.1 * app.snr);
        [kh,kw] = size(psf);
        PSF = zeros(size(app.img), class(app.img));
        PSF(1:kh, 1:kw) = psf / sum(psf(:));
        PSF = cv.dft(PSF, <span class="string">'ComplexOutput'</span>,true, <span class="string">'NonzeroRows'</span>,kh);
        PSF = bsxfun(@rdivide, PSF, sum(PSF.^2, 3) + noise);
        res = cv.mulSpectrums(app.IMG, PSF);
        res = cv.dft(res, <span class="string">'Inverse'</span>,true, <span class="string">'Scale'</span>,true, <span class="string">'RealOutput'</span>,true);
        res = circshift(res, floor(-[kh kw]/2));

        <span class="comment">% visualize PSF kernel (overlaid on top of output image)</span>
        <span class="keyword">if</span> psf_viz
            res(1:kh,1:kw) = psf;
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% show result</span>
    set(h.img, <span class="string">'CData'</span>,res);
    drawnow;
<span class="keyword">end</span>

<span class="keyword">function</span> h = buildGUI(app)
    <span class="comment">%BUILDGUI  Creates the UI</span>

    <span class="comment">% parameters</span>
    sz = size(app.img0);
    sz(2) = max(sz(2), 300);  <span class="comment">% minimum figure width</span>

    <span class="comment">% build the user interface (no resizing to keep it simple)</span>
    h = struct();
    h.fig = figure(<span class="string">'Name'</span>,<span class="string">'Deconvolution'</span>, <span class="keyword">...</span>
        <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>, <span class="string">'Menubar'</span>,<span class="string">'none'</span>, <span class="string">'Resize'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[200 200 sz(2) sz(1)+105-1]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        <span class="comment">%HACK: not implemented in Octave</span>
        movegui(h.fig, <span class="string">'center'</span>);
    <span class="keyword">end</span>
    h.ax = axes(<span class="string">'Parent'</span>,h.fig, <span class="string">'Units'</span>,<span class="string">'pixels'</span>, <span class="string">'Position'</span>,[1 105 sz(2) sz(1)]);
    <span class="keyword">if</span> ~mexopencv.isOctave()
        h.img = imshow(app.img0, <span class="string">'Parent'</span>,h.ax);
    <span class="keyword">else</span>
        <span class="comment">%HACK: https://savannah.gnu.org/bugs/index.php?45473</span>
        axes(h.ax);
        h.img = imshow(app.img0);
    <span class="keyword">end</span>
    h.txt(1) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>,11, <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 5 100 20], <span class="string">'String'</span>,<span class="string">'SNR (dB):'</span>);
    h.txt(2) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>,11, <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 30 100 20], <span class="string">'String'</span>,<span class="string">'Diameter:'</span>);
    h.txt(3) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>,11, <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 55 100 20], <span class="string">'String'</span>,<span class="string">'Angle:'</span>);
    h.txt(4) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'text'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>,11, <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[5 80 100 20], <span class="string">'String'</span>,<span class="string">'PSF:'</span>);
    h.slid(1) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="keyword">...</span>
        <span class="string">'Value'</span>,app.snr, <span class="string">'Min'</span>,0, <span class="string">'Max'</span>,50, <span class="string">'SliderStep'</span>,[1 5]./(50-0), <span class="keyword">...</span>
        <span class="string">'Position'</span>,[105 5 sz(2)-105-5 20]);
    h.slid(2) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="keyword">...</span>
        <span class="string">'Value'</span>,app.d, <span class="string">'Min'</span>,1, <span class="string">'Max'</span>,50, <span class="string">'SliderStep'</span>,[1 5]./(50-1), <span class="keyword">...</span>
        <span class="string">'Position'</span>,[105 30 sz(2)-105-5 20]);
    h.slid(3) = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'slider'</span>, <span class="keyword">...</span>
        <span class="string">'Value'</span>,app.angle, <span class="string">'Min'</span>,0, <span class="string">'Max'</span>,180, <span class="string">'SliderStep'</span>,[1 10]./(180-0), <span class="keyword">...</span>
        <span class="string">'Position'</span>,[105 55 sz(2)-105-5 20]);
    h.pop = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'popupmenu'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[105 80 100 20], <span class="string">'String'</span>,{<span class="string">'Linear'</span>,<span class="string">'Circular'</span>,<span class="string">'-None-'</span>});
    h.cbox = uicontrol(<span class="string">'Parent'</span>,h.fig, <span class="string">'Style'</span>,<span class="string">'checkbox'</span>, <span class="keyword">...</span>
        <span class="string">'Position'</span>,[210 80 100 20], <span class="string">'Value'</span>,1, <span class="string">'String'</span>,<span class="string">'Show PSF'</span>);

    <span class="comment">% hook event handlers, and trigger default start</span>
    set([h.slid, h.pop, h.cbox], <span class="string">'Callback'</span>,{@onChange,h,app}, <span class="keyword">...</span>
        <span class="string">'Interruptible'</span>,<span class="string">'off'</span>, <span class="string">'BusyAction'</span>,<span class="string">'cancel'</span>);
    onChange([],[],h,app);
<span class="keyword">end</span></pre><img src="weiner_deconvolution_demo_gui_01.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Wiener Deconvolution for Image Deblurring
%
% Sample shows how DFT can be used to perform
% <https://en.wikipedia.org/wiki/Wiener_deconvolution Weiner deconvolution>
% of an image with user-defined point spread function (PSF).
%
% Use controls to adjust PSF parameters, and swtich between linear/cirular PSF.
%
% See also: |deconvwnr|,
% <https://www.mathworks.com/help/images/image-restoration-deblurring.html>
%
% Sources:
%
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/python/deconvolution.py>
%

function varargout = weiner_deconvolution_demo_gui(im)
    % load grayscale image
    if nargin < 1
        im = fullfile(mexopencv.root(), 'test', 'licenseplate_motion.jpg');
        if exist(im, 'file') ~= 2
            disp('Downloading image...')
            url = 'https://cdn.rawgit.com/opencv/opencv/3.2.0/samples/data/licenseplate_motion.jpg';
            urlwrite(url, im);
        end
        img = cv.imread(im, 'Grayscale',true);
    elseif ischar(im)
        img = cv.imread(im, 'Grayscale',true);
    else
        img = im;
    end
    img = single(img) / 255;  % convert 8-bit to floating-point precision

    % create the UI
    app = initApp(img);
    h = buildGUI(app);
    if nargout > 0, varargout{1} = h; end
end

function app = initApp(img)
    %INIT_APP  Initialize options and state structure

    app = struct();

    % options
    app.snr = 25;       % signal/noise ratio in dB
    app.angle = 135;    % blur angle in degrees [0,180]
    app.d = 22;         % blur diameter [1,ksz]
    app.ksz = 65;       % kernel size

    % process image and compute its DFT
    app.img0 = img;
    app.img = blur_edge(img);
    app.IMG = cv.dft(app.img, 'ComplexOutput',true);
end

function img = blur_edge(img, d)
    %BLUR_EDGE  Blur image edges to reduce ringing effect in deblurred image
    %
    %     img = blur_edge(img)
    %     img = blur_edge(img, d)
    %
    % ## Input
    % * __img__ input image
    % * __d__ gaussian size, default 31
    %
    % ## Output
    % * __img__ output image
    %
    % See also: edgetaper
    %

    if nargin < 2, d = 31; end
    img_blur = cv.copyMakeBorder(img, [d d d d], 'BorderType','Wrap');
    img_blur = cv.GaussianBlur(img_blur, 'KSize',[d d]*2+1, 'SigmaX',-1);
    img_blur = img_blur(d+1:end-d, d+1:end-d);

    [h,w] = size(img);
    [y,x] = ndgrid(1:h, 1:w);
    D = min(cat(3, x, w-x+1, y, h-y+1), [], 3);
    a = min(single(D)/d, 1);

    img = img.*a + img_blur.*(1-a);
end

function kern = motion_kernel(ang, d, sz)
    %MOTION_KERNEL  Create linear motion filter
    %
    %     kern = motion_kernel(ang, d)
    %     kern = motion_kernel(ang, d, sz)
    %
    % ## Input
    % * __ang__ linear motion angle
    % * __d__ linear motion length
    % * __sz__ kernel size, default 65
    %
    % ## Output
    % * __kern__ kernel
    %
    % See also: fspecial (motion)
    %

    if nargin < 3, sz = 65; end
    sz2 = floor(sz / 2);
    A = [cos(ang) -sin(ang); sin(ang) cos(ang)];
    A(:,3) = [sz2; sz2] - A*[(d-1)*0.5; 0];
    kern = ones(1,d,'single');
    kern = cv.warpAffine(kern, A, 'DSize',[sz sz], 'Interpolation','Cubic');
end

function kern = defocus_kernel(d, sz)
    %DEFOCUS_KERNEL  Create circular defocus kernel
    %
    %     kern = defocus_kernel(d)
    %     kern = defocus_kernel(d, sz)
    %
    % ## Input
    % * __d__ circular motion diameter
    % * __sz__ kernel size, default 65
    %
    % ## Output
    % * __kern__ kernel
    %
    % See also: fspecial (gaussian)
    %

    if nargin < 2, sz = 65; end
    kern = zeros(sz,sz,'uint8');
    kern = cv.circle(kern, [sz sz], d, ...
        'Color',255, 'Thickness','Filled', 'LineType','AA', 'Shift',1);
    kern = single(kern) / 255;
end

function onChange(~,~,h,app)
    %ONCHANGE  Event handler for UI controls

    % retrieve current values from UI controls
    psf_type = get(h.pop, 'Value');
    psf_viz = get(h.cbox, 'Value') == get(h.cbox, 'Max');
    app.snr = round(get(h.slid(1), 'Value'));
    app.d = round(get(h.slid(2), 'Value'));
    app.angle = round(get(h.slid(3), 'Value'));
    set(h.txt(1), 'String',sprintf('SNR (dB): %d', app.snr));
    set(h.txt(2), 'String',sprintf('Diameter: %d', app.d));
    set(h.txt(3), 'String',sprintf('Angle: %d', app.angle));

    if psf_type == 3
        % show original blurred image
        res = app.img0;
    else
        % linear/cirular PSF
        if psf_type == 1
            psf = motion_kernel(deg2rad(app.angle), app.d, app.ksz);
        else
            psf = defocus_kernel(app.d, app.ksz);
        end

        % deconvolution
        noise = 10^(-0.1 * app.snr);
        [kh,kw] = size(psf);
        PSF = zeros(size(app.img), class(app.img));
        PSF(1:kh, 1:kw) = psf / sum(psf(:));
        PSF = cv.dft(PSF, 'ComplexOutput',true, 'NonzeroRows',kh);
        PSF = bsxfun(@rdivide, PSF, sum(PSF.^2, 3) + noise);
        res = cv.mulSpectrums(app.IMG, PSF);
        res = cv.dft(res, 'Inverse',true, 'Scale',true, 'RealOutput',true);
        res = circshift(res, floor(-[kh kw]/2));

        % visualize PSF kernel (overlaid on top of output image)
        if psf_viz
            res(1:kh,1:kw) = psf;
        end
    end

    % show result
    set(h.img, 'CData',res);
    drawnow;
end

function h = buildGUI(app)
    %BUILDGUI  Creates the UI

    % parameters
    sz = size(app.img0);
    sz(2) = max(sz(2), 300);  % minimum figure width

    % build the user interface (no resizing to keep it simple)
    h = struct();
    h.fig = figure('Name','Deconvolution', ...
        'NumberTitle','off', 'Menubar','none', 'Resize','off', ...
        'Position',[200 200 sz(2) sz(1)+105-1]);
    if ~mexopencv.isOctave()
        %HACK: not implemented in Octave
        movegui(h.fig, 'center');
    end
    h.ax = axes('Parent',h.fig, 'Units','pixels', 'Position',[1 105 sz(2) sz(1)]);
    if ~mexopencv.isOctave()
        h.img = imshow(app.img0, 'Parent',h.ax);
    else
        %HACK: https://savannah.gnu.org/bugs/index.php?45473
        axes(h.ax);
        h.img = imshow(app.img0);
    end
    h.txt(1) = uicontrol('Parent',h.fig, 'Style','text', ...
        'FontSize',11, 'HorizontalAlignment','left', ...
        'Position',[5 5 100 20], 'String','SNR (dB):');
    h.txt(2) = uicontrol('Parent',h.fig, 'Style','text', ...
        'FontSize',11, 'HorizontalAlignment','left', ...
        'Position',[5 30 100 20], 'String','Diameter:');
    h.txt(3) = uicontrol('Parent',h.fig, 'Style','text', ...
        'FontSize',11, 'HorizontalAlignment','left', ...
        'Position',[5 55 100 20], 'String','Angle:');
    h.txt(4) = uicontrol('Parent',h.fig, 'Style','text', ...
        'FontSize',11, 'HorizontalAlignment','left', ...
        'Position',[5 80 100 20], 'String','PSF:');
    h.slid(1) = uicontrol('Parent',h.fig, 'Style','slider', ...
        'Value',app.snr, 'Min',0, 'Max',50, 'SliderStep',[1 5]./(50-0), ...
        'Position',[105 5 sz(2)-105-5 20]);
    h.slid(2) = uicontrol('Parent',h.fig, 'Style','slider', ...
        'Value',app.d, 'Min',1, 'Max',50, 'SliderStep',[1 5]./(50-1), ...
        'Position',[105 30 sz(2)-105-5 20]);
    h.slid(3) = uicontrol('Parent',h.fig, 'Style','slider', ...
        'Value',app.angle, 'Min',0, 'Max',180, 'SliderStep',[1 10]./(180-0), ...
        'Position',[105 55 sz(2)-105-5 20]);
    h.pop = uicontrol('Parent',h.fig, 'Style','popupmenu', ...
        'Position',[105 80 100 20], 'String',{'Linear','Circular','-None-'});
    h.cbox = uicontrol('Parent',h.fig, 'Style','checkbox', ...
        'Position',[210 80 100 20], 'Value',1, 'String','Show PSF');

    % hook event handlers, and trigger default start
    set([h.slid, h.pop, h.cbox], 'Callback',{@onChange,h,app}, ...
        'Interruptible','off', 'BusyAction','cancel');
    onChange([],[],h,app);
end

##### SOURCE END #####
-->
   </body>
</html>