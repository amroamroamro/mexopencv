<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Face Detection</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="facedetect.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Face Detection</h1>
         <!--introduction-->
         <p>Here is an example that illustrates how to detect faces in a live video stream.</p>
         <!--/introduction-->
         <p>Load cascade file</p><pre class="codeinput">xml_file = fullfile(mexopencv.root(),<span class="string">'test'</span>,<span class="string">'haarcascade_frontalface_alt2.xml'</span>);
classifier = cv.CascadeClassifier(xml_file);</pre><p>Set up camera</p><pre class="codeinput">camera = createVideoCapture([], <span class="string">'lena'</span>);
pause(2); <span class="comment">% Necessary in some environment. See help cv.VideoCapture</span>
assert(camera.isOpened(), <span class="string">'Camera failed to initialize'</span>);

disp(<span class="string">'Face detection demo. Press any key when done.'</span>);</pre><pre class="codeoutput">Face detection demo. Press any key when done.
</pre><p>Set up display window, and start the main loop</p><pre class="codeinput">window = figure(<span class="string">'KeyPressFcn'</span>,@(o,e) setappdata(o,<span class="string">'flag'</span>,true));
setappdata(window, <span class="string">'flag'</span>,false);

<span class="comment">% Start main loop</span>
<span class="keyword">while</span> ishghandle(window)
    <span class="comment">% Grab and preprocess an image</span>
    im = camera.read();
    <span class="keyword">if</span> isempty(im), <span class="keyword">break</span>; <span class="keyword">end</span>
    im = cv.resize(im, 0.5, 0.5);
    gr = cv.cvtColor(im, <span class="string">'RGB2GRAY'</span>);
    gr = cv.equalizeHist(gr);

    <span class="comment">% Detect faces</span>
    boxes = classifier.detect(gr, <span class="string">'ScaleFactor'</span>,1.3,<span class="keyword">...</span>
        <span class="string">'MinNeighbors'</span>,2, <span class="string">'MinSize'</span>,[30,30]);

    <span class="comment">% Draw results</span>
    imshow(im);
    <span class="keyword">for</span> i = 1:numel(boxes)
        rectangle(<span class="string">'Position'</span>,boxes{i}, <span class="string">'EdgeColor'</span>,<span class="string">'g'</span>, <span class="string">'LineWidth'</span>,2);
    <span class="keyword">end</span>

    <span class="comment">% Terminate if any user input</span>
    flag = getappdata(window, <span class="string">'flag'</span>);
    <span class="keyword">if</span> isempty(flag) || flag, <span class="keyword">break</span>; <span class="keyword">end</span>
    pause(0.1);
<span class="keyword">end</span>

<span class="comment">% Close</span>
camera.release();</pre><img src="facedetect_01.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Face Detection
% Here is an example that illustrates how to detect faces
% in a live video stream.
%

%%
% Load cascade file
xml_file = fullfile(mexopencv.root(),'test','haarcascade_frontalface_alt2.xml');
classifier = cv.CascadeClassifier(xml_file);

%%
% Set up camera
camera = createVideoCapture([], 'lena');
pause(2); % Necessary in some environment. See help cv.VideoCapture
assert(camera.isOpened(), 'Camera failed to initialize');

disp('Face detection demo. Press any key when done.');

%%
% Set up display window, and start the main loop

window = figure('KeyPressFcn',@(o,e) setappdata(o,'flag',true));
setappdata(window, 'flag',false);

% Start main loop
while ishghandle(window)
    % Grab and preprocess an image
    im = camera.read();
    if isempty(im), break; end
    im = cv.resize(im, 0.5, 0.5);
    gr = cv.cvtColor(im, 'RGB2GRAY');
    gr = cv.equalizeHist(gr);

    % Detect faces
    boxes = classifier.detect(gr, 'ScaleFactor',1.3,...
        'MinNeighbors',2, 'MinSize',[30,30]);

    % Draw results
    imshow(im);
    for i = 1:numel(boxes)
        rectangle('Position',boxes{i}, 'EdgeColor','g', 'LineWidth',2);
    end

    % Terminate if any user input
    flag = getappdata(window, 'flag');
    if isempty(flag) || flag, break; end
    pause(0.1);
end

% Close
camera.release();

##### SOURCE END #####
-->
   </body>
</html>