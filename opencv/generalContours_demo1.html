<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Creating Bounding boxes and circles for contours</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="generalContours_demo1.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Creating Bounding boxes and circles for contours</h1>
         <!--introduction-->
         <p>Demo code to find contours in an image.</p>
         <p>In this sample you will learn how to:</p>
         <div>
            <ul>
               <li>use the OpenCV function <a href="matlab:doc('cv.boundingRect')">cv.boundingRect</a></li>
               <li>use the OpenCV function <a href="matlab:doc('cv.minEnclosingCircle')">cv.minEnclosingCircle</a></li>
            </ul>
         </div>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://docs.opencv.org/3.2.0/da/d0c/tutorial_bounding_rects_circles.html">https://docs.opencv.org/3.2.0/da/d0c/tutorial_bounding_rects_circles.html</a></li>
               <li><a href="https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ShapeDescriptors/generalContours_demo1.cpp">https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ShapeDescriptors/generalContours_demo1.cpp</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <h2 id="toc">Contents</h2>
         <div>
            <ul>
               <li><a href="#2">Input</a></li>
               <li><a href="#3">Edges + Contours</a></li>
               <li><a href="#4">Bounding rectangles and enclosing circles</a></li>
               <li><a href="#5">Draw</a></li>
            </ul>
         </div>
         <h2 id="2">Input</h2><pre class="codeinput"><span class="comment">% Load source image</span>
src = imread(fullfile(mexopencv.root(),<span class="string">'test'</span>,<span class="string">'balloon.jpg'</span>));

<span class="comment">% Convert image to gray and blur it to get rid of the noise</span>
src_gray = cv.cvtColor(src, <span class="string">'RGB2GRAY'</span>);
src_gray = cv.blur(src_gray, <span class="string">'KSize'</span>,[3 3]);

<span class="comment">% Create figure</span>
imshow(src), title(<span class="string">'Source'</span>)</pre><img src="generalContours_demo1_01.png"><h2 id="3">Edges + Contours</h2><pre class="codeinput"><span class="comment">% Detect edges using Threshold</span>
thresh = 134;
threshold_output = cv.threshold(src_gray, thresh, <span class="keyword">...</span>
    <span class="string">'MaxValue'</span>,255, <span class="string">'Type'</span>,<span class="string">'Binary'</span>);
imshow(threshold_output), title(<span class="string">'Edges'</span>)

<span class="comment">% Find contours</span>
[contours, hierarchy] = cv.findContours(threshold_output, <span class="keyword">...</span>
    <span class="string">'Mode'</span>,<span class="string">'Tree'</span>, <span class="string">'Method'</span>,<span class="string">'Simple'</span>);</pre><img src="generalContours_demo1_02.png"><h2 id="4">Bounding rectangles and enclosing circles</h2>
         <p>Approximate contours to polygons + get bounding rects and circles</p><pre class="codeinput">contours_poly = cell(size(contours));
boundRect = cell(size(contours));
center = cell(size(contours));
radius = zeros(size(contours));
<span class="keyword">for</span> i=1:numel(contours)
    <span class="comment">% approximate to polygon with accuracy +/- 3 where curve must me closed</span>
    contours_poly{i} = cv.approxPolyDP(contours{i}, <span class="keyword">...</span>
        <span class="string">'Epsilon'</span>,3, <span class="string">'Closed'</span>,true);
    <span class="comment">% find a bounding rect for polygon</span>
    boundRect{i} = cv.boundingRect(contours{i});
    <span class="comment">% find a minimum enclosing circle for polygon</span>
    [center{i}, radius(i)] = cv.minEnclosingCircle(contours{i});
<span class="keyword">end</span></pre><h2 id="5">Draw</h2>
         <p>Draw polygonal contour + bonding rects + circles</p><pre class="codeinput">drawing = zeros([size(threshold_output) 3], <span class="string">'uint8'</span>);
<span class="keyword">for</span> i=1:numel(contours)
    <span class="comment">% pick a random color</span>
    color = randi([0 255], [1 3]);
    <span class="comment">% draw the contour</span>
    drawing = cv.drawContours(drawing, contours_poly, <span class="keyword">...</span>
        <span class="string">'ContourIdx'</span>,i-1, <span class="string">'MaxLevel'</span>,0, <span class="string">'Hierarchy'</span>,hierarchy, <span class="keyword">...</span>
        <span class="string">'Color'</span>,color, <span class="string">'Thickness'</span>,1, <span class="string">'LineType'</span>,8);
    <span class="comment">% draw the bounding rectangle</span>
    drawing = cv.rectangle(drawing, boundRect{i}, <span class="keyword">...</span>
        <span class="string">'Color'</span>,color, <span class="string">'Thickness'</span>,2, <span class="string">'LineType'</span>,8);
    <span class="comment">% draw the minimal enclosing circle</span>
    drawing = cv.circle(drawing, center{i}, radius(i), <span class="keyword">...</span>
        <span class="string">'Color'</span>,color, <span class="string">'Thickness'</span>,2, <span class="string">'LineType'</span>,8);
<span class="keyword">end</span>

<span class="comment">% Show in a figure</span>
imshow(drawing), title(<span class="string">'Contours'</span>)</pre><img src="generalContours_demo1_03.png"><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Creating Bounding boxes and circles for contours
% Demo code to find contours in an image.
%
% In this sample you will learn how to:
%
% * use the OpenCV function <matlab:doc('cv.boundingRect') cv.boundingRect>
% * use the OpenCV function <matlab:doc('cv.minEnclosingCircle') cv.minEnclosingCircle>
%
% Sources:
%
% * <https://docs.opencv.org/3.2.0/da/d0c/tutorial_bounding_rects_circles.html>
% * <https://github.com/opencv/opencv/blob/3.2.0/samples/cpp/tutorial_code/ShapeDescriptors/generalContours_demo1.cpp>
%

%% Input

% Load source image
src = imread(fullfile(mexopencv.root(),'test','balloon.jpg'));

% Convert image to gray and blur it to get rid of the noise
src_gray = cv.cvtColor(src, 'RGB2GRAY');
src_gray = cv.blur(src_gray, 'KSize',[3 3]);

% Create figure
imshow(src), title('Source')

%% Edges + Contours

% Detect edges using Threshold
thresh = 134;
threshold_output = cv.threshold(src_gray, thresh, ...
    'MaxValue',255, 'Type','Binary');
imshow(threshold_output), title('Edges')

% Find contours
[contours, hierarchy] = cv.findContours(threshold_output, ...
    'Mode','Tree', 'Method','Simple');

%% Bounding rectangles and enclosing circles
% Approximate contours to polygons + get bounding rects and circles
contours_poly = cell(size(contours));
boundRect = cell(size(contours));
center = cell(size(contours));
radius = zeros(size(contours));
for i=1:numel(contours)
    % approximate to polygon with accuracy +/- 3 where curve must me closed
    contours_poly{i} = cv.approxPolyDP(contours{i}, ...
        'Epsilon',3, 'Closed',true);
    % find a bounding rect for polygon
    boundRect{i} = cv.boundingRect(contours{i});
    % find a minimum enclosing circle for polygon
    [center{i}, radius(i)] = cv.minEnclosingCircle(contours{i});
end

%% Draw
% Draw polygonal contour + bonding rects + circles
drawing = zeros([size(threshold_output) 3], 'uint8');
for i=1:numel(contours)
    % pick a random color
    color = randi([0 255], [1 3]);
    % draw the contour
    drawing = cv.drawContours(drawing, contours_poly, ...
        'ContourIdx',i-1, 'MaxLevel',0, 'Hierarchy',hierarchy, ...
        'Color',color, 'Thickness',1, 'LineType',8);
    % draw the bounding rectangle
    drawing = cv.rectangle(drawing, boundRect{i}, ...
        'Color',color, 'Thickness',2, 'LineType',8);
    % draw the minimal enclosing circle
    drawing = cv.circle(drawing, center{i}, radius(i), ...
        'Color',color, 'Thickness',2, 'LineType',8);
end

% Show in a figure
imshow(drawing), title('Contours')

##### SOURCE END #####
-->
   </body>
</html>