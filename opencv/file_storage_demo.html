<!DOCTYPE html>
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--This HTML was auto-generated from published MATLAB code.-->
      <title>Serialization Functionality</title>
      <meta name="generator" content="MATLAB 9.2">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2017-11-27">
      <meta name="DC.source" content="file_storage_demo.m">
      <link rel="stylesheet" type="text/css" href="publish_custom.css">
   </head>
   <body>
      <div class="content">
         <h1 id="1">Serialization Functionality</h1>
         <!--introduction-->
         <p>Demonstrate the usage of OpenCV serialization functionality.</p>
         <p>This program demonstrates the use of <tt>cv.FileStorage</tt> for serialization in OpenCV. FileStorage allows you to serialize to various formats specified by the file end type. You should
            try using different file extensions (e.g. <tt>.yaml</tt>, <tt>.yml</tt>, <tt>.xml</tt>, <tt>.xml.gz</tt>, <tt>.yaml.gz</tt>, etc.)
         </p>
         <p>Sources:</p>
         <div>
            <ul>
               <li><a href="https://github.com/opencv/opencv/blob/3.1.0/samples/cpp/filestorage.cpp">https://github.com/opencv/opencv/blob/3.1.0/samples/cpp/filestorage.cpp</a></li>
            </ul>
         </div>
         <!--/introduction-->
         <h2 id="toc">Contents</h2>
         <div>
            <ul>
               <li><a href="#2">Data</a></li>
               <li><a href="#3">Write</a></li>
               <li><a href="#7">Read</a></li>
               <li><a href="#8">Read from string</a></li>
               <li><a href="#10">Write to string</a></li>
            </ul>
         </div>
         <h2 id="2">Data</h2>
         <p>collect variables inside a struct (including cell array of strings, matrices/vectors, structs, scalar numerics, and strings)</p><pre class="codeinput">S = struct();
S.images = {<span class="string">'image1.jpg'</span>, <span class="string">'myfi.png'</span>, <span class="string">'../data/baboon.jpg'</span>};
S.R = eye(3);
S.T = zeros(3,1);
S.mdata.A = int32(97);
S.mdata.X = pi;
S.mdata.id = <span class="string">'mydata1234'</span>;
display(S)</pre><pre class="codeoutput">S = 
  struct with fields:

    images: {'image1.jpg'  'myfi.png'  '../data/baboon.jpg'}
         R: [3&times;3 double]
         T: [3&times;1 double]
     mdata: [1&times;1 struct]
</pre><h2 id="3">Write</h2>
         <p>save data as YAML file</p><pre class="codeinput">fname = fullfile(tempdir(), <span class="string">'out.yml'</span>);
cv.FileStorage(fname, S);</pre><p>show contents of YAML file</p><pre class="codeinput">type(fname)</pre><pre class="codeoutput">
%YAML:1.0
---
images:
   - "image1.jpg"
   - "myfi.png"
   - "../data/baboon.jpg"
R: !!opencv-matrix
   rows: 3
   cols: 3
   dt: d
   data: [ 1., 0., 0., 0., 1., 0., 0., 0., 1. ]
T: !!opencv-matrix
   rows: 3
   cols: 1
   dt: d
   data: [ 0., 0., 0. ]
mdata:
   A: 97
   X: 3.1415926535897931e+00
   id: mydata1234
</pre><p>we can also save as GZIP-compressed file</p><pre class="codeinput">fnameGZ = fullfile(tempdir(), <span class="string">'out.xml.gz'</span>);
cv.FileStorage(fnameGZ, S);</pre><p>extract and show contents of XML file</p><pre class="codeinput">f = gunzip(fnameGZ);
type(f{1})</pre><pre class="codeoutput">
&lt;?xml version="1.0"?&gt;
&lt;opencv_storage&gt;
&lt;images&gt;
  image1.jpg myfi.png "../data/baboon.jpg"&lt;/images&gt;
&lt;R type_id="opencv-matrix"&gt;
  &lt;rows&gt;3&lt;/rows&gt;
  &lt;cols&gt;3&lt;/cols&gt;
  &lt;dt&gt;d&lt;/dt&gt;
  &lt;data&gt;
    1. 0. 0. 0. 1. 0. 0. 0. 1.&lt;/data&gt;&lt;/R&gt;
&lt;T type_id="opencv-matrix"&gt;
  &lt;rows&gt;3&lt;/rows&gt;
  &lt;cols&gt;1&lt;/cols&gt;
  &lt;dt&gt;d&lt;/dt&gt;
  &lt;data&gt;
    0. 0. 0.&lt;/data&gt;&lt;/T&gt;
&lt;mdata&gt;
  &lt;A&gt;97&lt;/A&gt;
  &lt;X&gt;3.1415926535897931e+00&lt;/X&gt;
  &lt;id&gt;mydata1234&lt;/id&gt;&lt;/mdata&gt;
&lt;/opencv_storage&gt;
</pre><h2 id="7">Read</h2>
         <p>load data from YAML file</p><pre class="codeinput">SS = cv.FileStorage(fname);
display(SS)
<span class="comment">%assert(isequal(S,SS))</span></pre><pre class="codeoutput">SS = 
  struct with fields:

    images: {'image1.jpg'  'myfi.png'  '../data/baboon.jpg'}
         R: [3&times;3 double]
         T: [3&times;1 double]
     mdata: [1&times;1 struct]
</pre><h2 id="8">Read from string</h2>
         <p>a serialized string</p><pre class="codeinput">str = {
    <span class="string">'%YAML:1.0'</span>
    <span class="string">'# some comment'</span>
    <span class="string">'mdata:'</span>
    <span class="string">'  A: 97'</span>
    <span class="string">'  X: 3.1415926535897931e+00'</span>
    <span class="string">'  id: mydata1234'</span>
    <span class="string">'  seq: [1, 2, 3]'</span>
    <span class="string">'  map: {name: John Smith, age: 11}'</span>
};
str = sprintf(<span class="string">'%s\n'</span>, str{:});
display(str)</pre><pre class="codeoutput">str =
    '%YAML:1.0
     # some comment
     mdata:
       A: 97
       X: 3.1415926535897931e+00
       id: mydata1234
       seq: [1, 2, 3]
       map: {name: John Smith, age: 11}
     '
</pre><p>load data from string</p><pre class="codeinput">[M,~] = cv.FileStorage(str);
display(M.mdata)</pre><pre class="codeoutput">      A: 97
      X: 3.1416
     id: 'mydata1234'
    seq: {[1]  [2]  [3]}
    map: [1&times;1 struct]
</pre><h2 id="10">Write to string</h2>
         <p>encode data as a YAML string</p><pre class="codeinput">str2 = cv.FileStorage(<span class="string">'.yml'</span>, M);
display(str2)</pre><pre class="codeoutput">str2 =
    '%YAML:1.0
     ---
     mdata:
        A: 97.
        X: 3.1415926535897931e+00
        id: mydata1234
        seq:
           - 1.
           - 2.
           - 3.
        map:
           name: John Smith
           age: 11.
     '
</pre><div class="footer">
            <p><a href="https://www.mathworks.com/products/matlab.html">Published with MATLAB&reg; R2017a</a></p>
         </div>
      </div>
      <!--
##### SOURCE BEGIN #####
%% Serialization Functionality
% Demonstrate the usage of OpenCV serialization functionality.
%
% This program demonstrates the use of |cv.FileStorage| for serialization in
% OpenCV. FileStorage allows you to serialize to various formats specified by
% the file end type. You should try using different file extensions
% (e.g. |.yaml|, |.yml|, |.xml|, |.xml.gz|, |.yaml.gz|, etc.)
%
% Sources:
%
% * <https://github.com/opencv/opencv/blob/3.1.0/samples/cpp/filestorage.cpp>
%

%% Data
% collect variables inside a struct (including cell array of strings,
% matrices/vectors, structs, scalar numerics, and strings)
S = struct();
S.images = {'image1.jpg', 'myfi.png', '../data/baboon.jpg'};
S.R = eye(3);
S.T = zeros(3,1);
S.mdata.A = int32(97);
S.mdata.X = pi;
S.mdata.id = 'mydata1234';
display(S)

%% Write
% save data as YAML file
fname = fullfile(tempdir(), 'out.yml');
cv.FileStorage(fname, S);

%%
% show contents of YAML file
type(fname)

%%
% we can also save as GZIP-compressed file
fnameGZ = fullfile(tempdir(), 'out.xml.gz');
cv.FileStorage(fnameGZ, S);

%%
% extract and show contents of XML file
f = gunzip(fnameGZ);
type(f{1})

%% Read
% load data from YAML file
SS = cv.FileStorage(fname);
display(SS)
%assert(isequal(S,SS))

%% Read from string
% a serialized string
str = {
    '%YAML:1.0'
    '# some comment'
    'mdata:'
    '  A: 97'
    '  X: 3.1415926535897931e+00'
    '  id: mydata1234'
    '  seq: [1, 2, 3]'
    '  map: {name: John Smith, age: 11}'
};
str = sprintf('%s\n', str{:});
display(str)

%%
% load data from string
[M,~] = cv.FileStorage(str);
display(M.mdata)

%% Write to string
% encode data as a YAML string
str2 = cv.FileStorage('.yml', M);
display(str2)

##### SOURCE END #####
-->
   </body>
</html>